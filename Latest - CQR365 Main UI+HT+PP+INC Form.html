<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CQR365 - SafePark.PRO Safety & Compliance System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-orange: #CC5500;
            --dark-orange: #B8460C;
            --light-orange: #E6672E;
            --black: #000000;
            --white: #FFFFFF;
            --light-gray: #F8F9FA;
            --medium-gray: #6C757D;
            --dark-gray: #343A40;
            --border-color: #DEE2E6;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 40px rgba(0,0,0,0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--light-gray) 0%, #E8ECEF 100%);
            color: var(--dark-gray);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, var(--black) 0%, var(--dark-gray) 100%);
            color: var(--white);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-heavy);
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 2px solid var(--primary-orange);
            background: var(--black);
        }

        .sidebar-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary-orange);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .sidebar-header .brand-line {
            font-size: 1.1rem;
            color: var(--white);
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: 0.3px;
        }

        .sidebar-header p {
            font-size: 0.8rem;
            color: var(--medium-gray);
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .sidebar-nav {
            padding: 20px 15px;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-section-title {
            font-size: 0.75rem;
            color: var(--medium-gray);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding: 0 15px;
        }

        .nav-btn, .custom-nav-btn {
            display: flex;
            align-items: center;
            width: 100%;
            background: transparent;
            border: none;
            color: #B8C5D6;
            padding: 15px 20px;
            margin-bottom: 5px;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }

        .nav-btn:before, .custom-nav-btn:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-orange);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .nav-btn:hover, .custom-nav-btn:hover {
            background: rgba(204, 85, 0, 0.1);
            color: var(--white);
            transform: translateX(5px);
        }

        .nav-btn:hover:before, .custom-nav-btn:hover:before {
            transform: scaleY(1);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--dark-orange) 100%);
            color: var(--white);
            font-weight: 600;
            box-shadow: var(--shadow-medium);
        }

        .nav-btn.active:before {
            transform: scaleY(1);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        /* Main Content Area */
        .main-content {
            margin-left: 320px;
            flex: 1;
            padding: 30px;
            background: var(--light-gray);
            min-height: 100vh;
        }

        .content-section {
            background: var(--white);
            border-radius: 15px;
            padding: 40px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            display: none;
            min-height: calc(100vh - 100px);
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-stats {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }

        .header-stats .stat-item {
            text-align: center;
            min-width: 80px;
        }

        .header-stats .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-orange);
            display: block;
            margin-bottom: 4px;
        }

        .header-stats .stat-label {
            font-size: 0.8rem;
            color: var(--medium-gray);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .section-title {
            color: var(--black);
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .section-subtitle {
            color: var(--medium-gray);
            font-size: 1rem;
            margin-top: 5px;
            font-weight: 400;
        }

        /* Play Park Specific Styles */
        .playpark-container {
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
            padding: 40px;
            border-radius: 15px;
            min-height: calc(100vh - 200px);
        }

        .playpark-navigation {
            background: var(--black);
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid var(--primary-orange);
        }

        .playpark-nav-button {
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            border-right: 1px solid var(--primary-orange);
            transition: background-color 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        .playpark-nav-button:hover,
        .playpark-nav-button.active {
            background-color: var(--primary-orange);
        }

        .playpark-nav-button:last-child {
            border-right: none;
        }

        .playpark-step {
            display: none;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .playpark-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(24px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .form-section {
            background: linear-gradient(135deg, #2A2D35 0%, var(--dark-gray) 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .form-section h3 {
            color: var(--primary-orange);
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group-full {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .required {
            color: var(--primary-orange);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            color: var(--white);
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(204, 85, 0, 0.3);
            background: rgba(255,255,255,0.15);
        }

        .form-input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        select.form-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        select.form-input option {
            background: var(--dark-gray);
            color: var(--white);
        }

        textarea.form-input {
            min-height: 120px;
            resize: vertical;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .checkbox-item:hover {
            background: rgba(204, 85, 0, 0.1);
            border-color: rgba(204, 85, 0, 0.3);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
            accent-color: var(--primary-orange);
        }

        .checkbox-item label {
            color: var(--white);
            font-weight: 500;
            cursor: pointer;
            margin: 0;
        }

        .risk-matrix {
            display: grid;
            grid-template-columns: auto repeat(5, 1fr);
            gap: 1px;
            background-color: var(--black);
            border: 2px solid var(--black);
            margin: 20px 0;
        }

        .risk-cell {
            background-color: var(--white);
            padding: 10px;
            text-align: center;
            font-weight: bold;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
        }

        .risk-header {
            background-color: var(--primary-orange);
            color: var(--white);
        }

        .risk-low { background-color: #90EE90; }
        .risk-medium { background-color: #FFD700; }
        .risk-high { background-color: #FFA500; }
        .risk-very-high { background-color: #FF4500; }

        .inspection-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .inspection-table th,
        .inspection-table td {
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px;
            text-align: left;
            font-size: 13px;
            color: var(--white);
        }

        .inspection-table th {
            background-color: var(--primary-orange);
            color: var(--white);
            font-weight: bold;
        }

        .inspection-table tr:nth-child(even) {
            background-color: rgba(255,255,255,0.05);
        }

        .inspection-table input[type="text"],
        .inspection-table input[type="checkbox"],
        .inspection-table input[type="radio"] {
            margin: 0;
        }

        .inspection-table input[type="text"] {
            width: 100%;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--white);
            border-radius: 4px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-orange);
            color: var(--white);
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: var(--dark-orange);
        }

        .btn-secondary {
            background: transparent;
            color: var(--white);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary-orange);
            color: var(--primary-orange);
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--primary-orange), var(--dark-orange));
            padding: 15px 40px;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 20px;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, var(--dark-orange), var(--primary-orange));
        }

        .alert {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 28px;
            border-left: 4px solid;
            box-shadow: var(--shadow-md);
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.2);
            border-color: var(--success);
            color: var(--success);
        }

        .alert-info {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.3);
            color: #B8C5D6;
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            border-color: var(--warning);
            color: var(--warning);
        }

        .auto-generated {
            background-color: rgba(14, 165, 233, 0.1);
            border: 1px solid var(--primary-orange);
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }

        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            font-size: 12px;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            border-bottom: 3px solid rgba(255,255,255,0.2);
            color: #B8C5D6;
        }

        .progress-step.active {
            border-bottom-color: var(--primary-orange);
            color: var(--primary-orange);
            font-weight: bold;
        }

        .progress-step.completed {
            border-bottom-color: var(--success);
            color: var(--success);
        }

        .rpii-stage {
            background-color: rgba(255,255,255,0.05);
            border: 2px solid var(--primary-orange);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .rpii-title {
            background-color: var(--primary-orange);
            color: var(--white);
            padding: 10px;
            margin: -20px -20px 15px -20px;
            font-weight: bold;
            font-size: 16px;
        }

        .legislation-ref {
            font-size: 12px;
            color: #B8C5D6;
            font-style: italic;
            margin-top: 5px;
        }

        .procedure-step {
            background-color: rgba(255,255,255,0.05);
            border-left: 4px solid var(--primary-orange);
            padding: 15px;
            margin: 10px 0;
        }

        .procedure-step h4 {
            color: var(--primary-orange);
            margin-bottom: 10px;
        }

        .procedure-step ul {
            color: var(--white);
            margin-left: 20px;
        }

        /* Mobile Navigation */
        .mobile-nav-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2001;
            background: var(--black);
            color: var(--primary-orange);
            border: 2px solid var(--primary-orange);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: var(--shadow-medium);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            .mobile-nav-toggle {
                display: block;
            }

            .content-section {
                padding: 20px;
            }

            .section-header {
                flex-direction: column;
                text-align: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .playpark-navigation {
                flex-direction: column;
            }

            .playpark-nav-button {
                border-right: none;
                border-bottom: 1px solid var(--primary-orange);
            }
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="mobile-nav-toggle" onclick="toggleMobileNav()">☰</button>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeMobileNav()"></div>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>CQR 365</h1>
                <div class="brand-line">SafePark.PRO</div>
                <p>Safety & Compliance System</p>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <button class="nav-btn active" onclick="showSection('welcome')">
                        Welcome Home
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Core Modules</div>
                    <button class="nav-btn" onclick="showSection('property-passports')">
                        Property Passports
                    </button>
                    <button class="nav-btn" onclick="showSection('incidents-actions')">
                        Incidents & Actions
                    </button>
                    <button class="nav-btn" onclick="showSection('hot-tubs')">
                        Hot Tubs
                    </button>
                    <button class="nav-btn" onclick="showSection('accommodation')">
                        Accommodation
                    </button>
                    <button class="nav-btn" onclick="showSection('grounds-maintenance')">
                        Grounds & Maintenance
                    </button>
                    <button class="nav-btn" onclick="showSection('food-beverage')">
                        Food & Beverage
                    </button>
                    <button class="nav-btn" onclick="showSection('vehicles')">
                        Vehicles
                    </button>
                    <button class="nav-btn" onclick="showSection('library')">
                        Library
                    </button>
                    <button class="nav-btn" onclick="showSection('all-water')">
                        All Water
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    <button class="nav-btn" onclick="showSection('management')">
                        Management
                    </button>
                    <button class="nav-btn" onclick="showSection('team')">
                        Team Management
                    </button>
                    <button class="nav-btn" onclick="showSection('training')">
                        Training
                    </button>
                    <button class="nav-btn" onclick="showSection('contractors')">
                        Contractors
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Safety & Compliance</div>
                    <button class="nav-btn" onclick="showSection('ai-near-miss')">
                        AI Near Miss System
                    </button>
                    <button class="nav-btn" onclick="showSection('risk-assessment')">
                        Risk Assessment
                    </button>
                    <button class="nav-btn" onclick="showSection('business-continuity')">
                        Risk & Business Continuity
                    </button>
                    <button class="nav-btn" onclick="showSection('coshh')">
                        COSHH
                    </button>
                    <button class="nav-btn" onclick="showSection('electric')">
                        Electric
                    </button>
                    <button class="nav-btn" onclick="showSection('gas')">
                        Gas
                    </button>
                    <button class="nav-btn" onclick="showSection('fire')">
                        Fire
                    </button>
                    <button class="nav-btn" onclick="showSection('play-parks')">
                        Play Parks
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Analytics</div>
                    <button class="nav-btn" onclick="showSection('dashboard')">
                        Executive Dashboard
                    </button>
                </div>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Welcome Section -->
            <div id="welcome" class="content-section active">
                <div class="playpark-container">
                    <div class="form-section" style="text-align: center; padding: 80px 40px;">
                        <h1 style="font-size: 3.5rem; font-weight: 700; color: var(--primary-orange); margin-bottom: 20px; letter-spacing: -1px;">SafePark.PRO</h1>
                        <p style="font-size: 1.2rem; color: #B8C5D6; margin-bottom: 40px; line-height: 1.6;">
                            Powered by CQR365 - Comprehensive safety management, compliance tracking, 
                            and operational excellence for holiday parks and leisure facilities.
                        </p>
                        <div style="margin-top: 50px;">
                            <button class="btn" onclick="showSection('dashboard')" style="margin: 10px;">Access Dashboard</button>
                            <button class="btn btn-secondary" onclick="showSection('incidents-actions')" style="margin: 10px;">Report Incident</button>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>System Features</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <div class="alert alert-info">
                                    <strong>Play Parks Management</strong><br>
                                    Complete RPII framework compliance with automated risk assessments
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="alert alert-info">
                                    <strong>Hot Tub Monitoring</strong><br>
                                    Daily water quality tracking and maintenance scheduling
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="alert alert-info">
                                    <strong>Incident Reporting</strong><br>
                                    Professional incident management and tracking system
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Play Parks Section - INTEGRATED -->
            <div id="play-parks" class="content-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Play Park Safety System</h2>
                        <p class="section-subtitle">Complete onboarding, inspection, and RPII compliance management</p>
                    </div>
                    <div class="header-stats">
                        <div class="stat-item">
                            <div class="stat-value">12</div>
                            <div class="stat-label">Parks Managed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">98%</div>
                            <div class="stat-label">Compliance Rate</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">3</div>
                            <div class="stat-label">Due This Week</div>
                        </div>
                    </div>
                </div>

                <div class="playpark-container">
                    <!-- Sub-navigation for Play Parks -->
                    <div class="playpark-navigation">
                        <button class="playpark-nav-button active" onclick="showPlayParkStep('onboarding')">Park Onboarding</button>
                        <button class="playpark-nav-button" onclick="showPlayParkStep('risk-assessment')">Risk Assessment</button>
                        <button class="playpark-nav-button" onclick="showPlayParkStep('inspection')">Inspection</button>
                        <button class="playpark-nav-button" onclick="showPlayParkStep('maintenance')">Maintenance</button>
                        <button class="playpark-nav-button" onclick="showPlayParkStep('rpii')">RPII Framework</button>
                    </div>

                    <!-- Form with Formspree integration -->
                    <form id="playParkForm" action="https://formspree.io/f/xgvnveoq" method="POST" enctype="multipart/form-data">
                        <!-- Hidden fields for form management -->
                        <input type="hidden" name="_subject" value="Play Park Safety System Submission">
                        <input type="hidden" name="submission_type" id="playParkSubmissionType" value="onboarding">

                        <!-- STEP 1: ONBOARDING -->
                        <div class="playpark-step active" id="pp-onboarding">
                            <div class="form-section">
                                <h3>Park Registration & Basic Information</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-park-name">Park/Facility Name <span class="required">*</span></label>
                                        <select id="pp-park-name" name="park_name" class="form-input" required onchange="updatePlayParkList()">
                                            <option value="">Select Facility</option>
                                            <option value="Sunshine Holiday Park">Sunshine Holiday Park</option>
                                            <option value="Riverside Resort">Riverside Resort</option>
                                            <option value="Lakeside Lodge">Lakeside Lodge</option>
                                            <option value="Coastal Retreat">Coastal Retreat</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-park-id">Play Park Area</label>
                                        <select id="pp-park-id" name="park_id" class="form-input">
                                            <option value="">Select Play Park Area</option>
                                            <!-- Dynamically populated based on facility -->
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Add/Remove Play Parks -->
                                <div class="form-row">
                                    <div class="form-group">
                                        <button type="button" class="btn btn-secondary" onclick="showAddPlayParkDialog()">+ Add New Play Park</button>
                                        <button type="button" class="btn btn-secondary" onclick="showRemovePlayParkDialog()">- Remove Play Park</button>
                                    </div>
                                </div>

                                <div class="form-group form-group-full">
                                    <label class="form-label" for="pp-address">Complete Address <span class="required">*</span></label>
                                    <input type="text" id="pp-address" name="park_address" class="form-input" required>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-park-type">Park Type <span class="required">*</span></label>
                                        <select id="pp-park-type" name="park_type" class="form-input" required>
                                            <option value="">Select...</option>
                                            <option value="public">Public Park</option>
                                            <option value="school">School Playground</option>
                                            <option value="nursery">Nursery/Childcare</option>
                                            <option value="holiday-park">Holiday Park</option>
                                            <option value="housing-estate">Housing Estate</option>
                                            <option value="community">Community Centre</option>
                                            <option value="private">Private Recreation</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-installation-date">Installation Date</label>
                                        <input type="date" id="pp-installation-date" name="installation_date" class="form-input">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-owner">Owner/Organization <span class="required">*</span></label>
                                        <input type="text" id="pp-owner" name="owner_organization" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-contact-name">Primary Contact <span class="required">*</span></label>
                                        <input type="text" id="pp-contact-name" name="contact_name" class="form-input" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-contact-email">Email Address <span class="required">*</span></label>
                                        <input type="email" id="pp-contact-email" name="contact_email" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-contact-phone">Phone Number</label>
                                        <input type="tel" id="pp-contact-phone" name="contact_phone" class="form-input">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Target Age Groups</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-age-toddler" name="age_groups" value="6-23-months">
                                            <label for="pp-age-toddler">6-23 months (Toddler)</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-age-preschool" name="age_groups" value="2-5-years">
                                            <label for="pp-age-preschool">2-5 years (Pre-school)</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-age-school" name="age_groups" value="5-12-years">
                                            <label for="pp-age-school">5-12 years (School age)</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-age-teen" name="age_groups" value="13-plus">
                                            <label for="pp-age-teen">13+ years (Teen/Adult)</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-surface-type">Primary Surface Type <span class="required">*</span></label>
                                        <select id="pp-surface-type" name="surface_type" class="form-input" required onchange="updatePlayParkRiskAssessment()">
                                            <option value="">Select...</option>
                                            <option value="rubber-mulch">Rubber Mulch</option>
                                            <option value="engineered-wood">Engineered Wood Fiber</option>
                                            <option value="rubber-tiles">Rubber Safety Tiles</option>
                                            <option value="pour-in-place">Pour-in-Place Rubber</option>
                                            <option value="sand">Sand</option>
                                            <option value="pea-gravel">Pea Gravel</option>
                                            <option value="artificial-turf">Artificial Turf</option>
                                            <option value="grass">Natural Grass</option>
                                            <option value="concrete">Concrete/Hard Surface</option>
                                            <option value="mixed">Mixed Surfaces</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-compliance">Safety Standards Compliance</label>
                                        <select id="pp-compliance" name="safety_standards" class="form-input">
                                            <option value="">Select...</option>
                                            <option value="bs-en-1176">BS EN 1176:2017 (European)</option>
                                            <option value="astm-f1487">ASTM F1487 (US)</option>
                                            <option value="csa-z614">CSA Z614 (Canadian)</option>
                                            <option value="as-4685">AS 4685 (Australian)</option>
                                            <option value="multiple">Multiple Standards</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Equipment Present</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-swings" name="equipment" value="swings" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-swings">Swings (All Types)</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-slides" name="equipment" value="slides" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-slides">Slides (All Heights)</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-climbing" name="equipment" value="climbing" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-climbing">Climbing Equipment</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-seesaws" name="equipment" value="seesaws" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-seesaws">See-saws/Rockers</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-roundabout" name="equipment" value="roundabout" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-roundabout">Roundabouts/Carousels</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-spring" name="equipment" value="spring" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-spring">Spring Riders</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-multiplay" name="equipment" value="multiplay" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-multiplay">Multi-Play Units</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-sandbox" name="equipment" value="sandbox" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-sandbox">Sand Play/Sandbox</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-water" name="equipment" value="water" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-water">Water Play Equipment</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-equip-fitness" name="equipment" value="fitness" onchange="updatePlayParkRiskAssessment()">
                                            <label for="pp-equip-fitness">Fitness Equipment</label>
                                        </div>
                                    </div>
                                </div>

                                <button type="button" class="btn" onclick="showPlayParkStep('risk-assessment')">Continue to Risk Assessment</button>
                            </div>
                        </div>

                        <!-- STEP 2: RISK ASSESSMENT -->
                        <div class="playpark-step" id="pp-risk-assessment">
                            <div class="progress-indicator">
                                <div class="progress-step completed">1. Site Setup</div>
                                <div class="progress-step active">2. Risk Evaluation</div>
                                <div class="progress-step">3. Control Measures</div>
                                <div class="progress-step">4. Documentation</div>
                            </div>

                            <div class="form-section">
                                <h3>Automated Risk Assessment Matrix</h3>
                                
                                <div class="alert alert-info">
                                    <strong>Automated Risk Assessment:</strong> This matrix is automatically populated based on your equipment selection, 
                                    surface type, and age groups. Additional risks can be manually added below.
                                </div>

                                <div class="risk-matrix">
                                    <div class="risk-cell risk-header">Likelihood →<br>Severity ↓</div>
                                    <div class="risk-cell risk-header">Very Low</div>
                                    <div class="risk-cell risk-header">Low</div>
                                    <div class="risk-cell risk-header">Medium</div>
                                    <div class="risk-cell risk-header">High</div>
                                    <div class="risk-cell risk-header">Very High</div>
                                    
                                    <div class="risk-cell risk-header">Very High</div>
                                    <div class="risk-cell risk-medium">Medium</div>
                                    <div class="risk-cell risk-high">High</div>
                                    <div class="risk-cell risk-very-high">Very High</div>
                                    <div class="risk-cell risk-very-high">Very High</div>
                                    <div class="risk-cell risk-very-high">Very High</div>
                                    
                                    <div class="risk-cell risk-header">High</div>
                                    <div class="risk-cell risk-low">Low</div>
                                    <div class="risk-cell risk-medium">Medium</div>
                                    <div class="risk-cell risk-high">High</div>
                                    <div class="risk-cell risk-very-high">Very High</div>
                                    <div class="risk-cell risk-very-high">Very High</div>
                                    
                                    <div class="risk-cell risk-header">Medium</div>
                                    <div class="risk-cell risk-low">Low</div>
                                    <div class="risk-cell risk-low">Low</div>
                                    <div class="risk-cell risk-medium">Medium</div>
                                    <div class="risk-cell risk-high">High</div>
                                    <div class="risk-cell risk-very-high">Very High</div>
                                    
                                    <div class="risk-cell risk-header">Low</div>
                                    <div class="risk-cell risk-low">Very Low</div>
                                    <div class="risk-cell risk-low">Low</div>
                                    <div class="risk-cell risk-low">Low</div>
                                    <div class="risk-cell risk-medium">Medium</div>
                                    <div class="risk-cell risk-high">High</div>
                                    
                                    <div class="risk-cell risk-header">Very Low</div>
                                    <div class="risk-cell risk-low">Very Low</div>
                                    <div class="risk-cell risk-low">Very Low</div>
                                    <div class="risk-cell risk-low">Low</div>
                                    <div class="risk-cell risk-low">Low</div>
                                    <div class="risk-cell risk-medium">Medium</div>
                                </div>

                                <div id="pp-auto-risks" class="auto-generated">
                                    <h4 style="color: var(--primary-orange);">Automatically Identified Risks:</h4>
                                    <div id="pp-risk-list" style="color: var(--white);">
                                        <p><em>Please select equipment and surface type in onboarding to generate automatic risk assessment.</em></p>
                                    </div>
                                </div>

                                <div id="pp-generated-procedures" class="form-section" style="display: none;">
                                    <h4>Generated Safe Working Procedures</h4>
                                    <div id="pp-equipment-procedures"></div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="pp-additional-risks">Additional Site-Specific Risks:</label>
                                    <textarea id="pp-additional-risks" name="additional_risks" class="form-input" rows="4" 
                                              placeholder="Identify any additional risks specific to your site..."></textarea>
                                </div>

                                <div class="legislation-ref">
                                    Reference: Health and Safety at Work etc. Act 1974, Management of Health and Safety at Work Regulations 1999, 
                                    BS EN 1176:2017, BS EN 1177:2018
                                </div>

                                <button type="button" class="btn btn-secondary" onclick="showPlayParkStep('onboarding')">Back</button>
                                <button type="button" class="btn" onclick="generatePlayParkProcedures()">Generate Procedures</button>
                                <button type="button" class="btn" onclick="showPlayParkStep('inspection')">Continue to Inspection</button>
                            </div>
                        </div>

                        <!-- STEP 3: INSPECTION -->
                        <div class="playpark-step" id="pp-inspection">
                            <div class="form-section">
                                <h3>Inspection Details</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-inspection-date">Inspection Date <span class="required">*</span></label>
                                        <input type="date" id="pp-inspection-date" name="inspection_date" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-inspection-type">Inspection Type <span class="required">*</span></label>
                                        <select id="pp-inspection-type" name="inspection_type" class="form-input" required>
                                            <option value="">Select...</option>
                                            <option value="daily">Daily Visual</option>
                                            <option value="weekly">Weekly Functional</option>
                                            <option value="monthly">Monthly Detailed</option>
                                            <option value="annual">Annual Principal</option>
                                            <option value="post-incident">Post-Incident</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Quick Daily Check Option for Play Parks -->
                                <div class="alert alert-info" style="margin: 20px 0;">
                                    <strong>Quick Daily Check:</strong> 
                                    <button type="button" class="btn" onclick="quickPlayParkDailyCheck()" style="margin: 0 10px;">Complete Daily Check (All Good)</button>
                                    <button type="button" class="btn btn-secondary" onclick="selectAllPlayParkDailyChecks()" style="margin: 0 10px;">Select All Safety Checks</button>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-inspector-name">Inspector Name <span class="required">*</span></label>
                                        <input type="text" id="pp-inspector-name" name="inspector_name" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-inspector-quals">Inspector Qualifications</label>
                                        <select id="pp-inspector-quals" name="inspector_qualifications" class="form-input">
                                            <option value="">Select...</option>
                                            <option value="rospa">RoSPA Playground Inspector</option>
                                            <option value="rpii">RPII Registered Inspector</option>
                                            <option value="manufacturer">Manufacturer Trained</option>
                                            <option value="internal">Internal Trained Staff</option>
                                        </select>
                                    </div>
                                </div>

                                <h4 style="color: var(--primary-orange); margin: 20px 0;">Equipment Condition Assessment</h4>
                                <table class="inspection-table">
                                    <thead>
                                        <tr>
                                            <th>Equipment Type</th>
                                            <th>Present</th>
                                            <th>Good</th>
                                            <th>Fair</th>
                                            <th>Poor</th>
                                            <th>Unsafe</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>Swings</strong></td>
                                            <td><input type="checkbox" name="swing_present"></td>
                                            <td><input type="radio" name="swing_condition" value="good"></td>
                                            <td><input type="radio" name="swing_condition" value="fair"></td>
                                            <td><input type="radio" name="swing_condition" value="poor"></td>
                                            <td><input type="radio" name="swing_condition" value="unsafe"></td>
                                            <td><input type="text" name="swing_notes"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Slides</strong></td>
                                            <td><input type="checkbox" name="slide_present"></td>
                                            <td><input type="radio" name="slide_condition" value="good"></td>
                                            <td><input type="radio" name="slide_condition" value="fair"></td>
                                            <td><input type="radio" name="slide_condition" value="poor"></td>
                                            <td><input type="radio" name="slide_condition" value="unsafe"></td>
                                            <td><input type="text" name="slide_notes"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Climbing Equipment</strong></td>
                                            <td><input type="checkbox" name="climb_present"></td>
                                            <td><input type="radio" name="climb_condition" value="good"></td>
                                            <td><input type="radio" name="climb_condition" value="fair"></td>
                                            <td><input type="radio" name="climb_condition" value="poor"></td>
                                            <td><input type="radio" name="climb_condition" value="unsafe"></td>
                                            <td><input type="text" name="climb_notes"></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="form-group">
                                    <label class="form-label">Safety Compliance Checks</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-check-surface" name="safety_checks" value="surface_adequate">
                                            <label for="pp-check-surface">Surface adequate depth and coverage</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-check-clearance" name="safety_checks" value="clearance_adequate">
                                            <label for="pp-check-clearance">Adequate clearances around equipment</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-check-hardware" name="safety_checks" value="hardware_secure">
                                            <label for="pp-check-hardware">All hardware secure and tight</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-check-signage" name="safety_checks" value="signage_present">
                                            <label for="pp-check-signage">Safety signage present and visible</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="pp-overall-condition">Overall Playground Condition <span class="required">*</span></label>
                                    <select id="pp-overall-condition" name="overall_condition" class="form-input" required>
                                        <option value="">Select...</option>
                                        <option value="excellent">Excellent</option>
                                        <option value="good">Good</option>
                                        <option value="fair">Fair</option>
                                        <option value="poor">Poor</option>
                                        <option value="unsafe">Unsafe - Closure Required</option>
                                    </select>
                                </div>

                                <button type="button" class="btn btn-secondary" onclick="showPlayParkStep('risk-assessment')">Back</button>
                                <button type="button" class="btn" onclick="showPlayParkStep('maintenance')">Continue to Maintenance</button>
                            </div>
                        </div>

                        <!-- STEP 4: MAINTENANCE -->
                        <div class="playpark-step" id="pp-maintenance">
                            <div class="form-section">
                                <h3>Maintenance Management</h3>
                                
                                <div class="alert alert-warning">
                                    <strong>Priority Actions:</strong> Document any immediate maintenance requirements identified during inspection.
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Immediate Actions Required (Close/Remove from Service)</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-immediate-structural" name="immediate_actions" value="structural_failure">
                                            <label for="pp-immediate-structural">Structural failure or instability</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-immediate-sharp" name="immediate_actions" value="sharp_edges">
                                            <label for="pp-immediate-sharp">Sharp edges or protrusions</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-immediate-entrapment" name="immediate_actions" value="entrapment_hazards">
                                            <label for="pp-immediate-entrapment">Entrapment hazards</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">High Priority (Repair within 1 week)</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-high-hardware" name="high_priority" value="loose_hardware">
                                            <label for="pp-high-hardware">Loose hardware requiring attention</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-high-wear" name="high_priority" value="excessive_wear">
                                            <label for="pp-high-wear">Excessive wear patterns developing</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="pp-high-surface" name="high_priority" value="surface_maintenance">
                                            <label for="pp-high-surface">Surface maintenance needed</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group form-group-full">
                                    <label class="form-label" for="pp-maintenance-notes">Detailed Maintenance Requirements</label>
                                    <textarea id="pp-maintenance-notes" name="maintenance_notes" class="form-input" rows="4" 
                                              placeholder="Describe specific maintenance actions required..."></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="pp-next-inspection">Next Inspection Due</label>
                                        <input type="date" id="pp-next-inspection" name="next_inspection" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-maintenance-budget">Estimated Maintenance Cost (£)</label>
                                        <input type="number" id="pp-maintenance-budget" name="maintenance_budget" class="form-input" min="0" step="0.01">
                                    </div>
                                </div>

                                <button type="button" class="btn btn-secondary" onclick="showPlayParkStep('inspection')">Back</button>
                                <button type="button" class="btn" onclick="showPlayParkStep('rpii')">Continue to RPII Framework</button>
                            </div>
                        </div>

                        <!-- STEP 5: RPII FRAMEWORK -->
                        <div class="playpark-step" id="pp-rpii">
                            <div class="form-section">
                                <h3>RPII Framework Implementation</h3>
                                
                                <div class="alert alert-success">
                                    <strong>RPII Framework:</strong> Record, Plan, Implement, Improve - Ensuring continuous safety improvement.
                                </div>

                                <!-- RECORD -->
                                <div class="rpii-stage">
                                    <div class="rpii-title">R - RECORD</div>
                                    <div class="form-group">
                                        <label class="form-label">Recording Systems in Place</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pp-record-inspections" name="rpii_record" value="inspection_records" checked disabled>
                                                <label for="pp-record-inspections">Inspection records maintained</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pp-record-maintenance" name="rpii_record" value="maintenance_logs" checked disabled>
                                                <label for="pp-record-maintenance">Maintenance logs documented</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pp-record-incidents" name="rpii_record" value="incident_reporting">
                                                <label for="pp-record-incidents">Incident reporting system</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pp-record-training" name="rpii_record" value="training_records">
                                                <label for="pp-record-training">Staff training records</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- PLAN -->
                                <div class="rpii-stage">
                                    <div class="rpii-title">P - PLAN</div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-safety-objectives">Current Year Safety Objectives</label>
                                        <textarea id="pp-safety-objectives" name="safety_objectives" class="form-input" rows="3" 
                                                  placeholder="Define specific safety objectives..."></textarea>
                                    </div>
                                </div>

                                <!-- IMPLEMENT -->
                                <div class="rpii-stage">
                                    <div class="rpii-title">I - IMPLEMENT</div>
                                    <div class="form-group">
                                        <label class="form-label">Implementation Status</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pp-impl-procedures" name="rpii_implement" value="procedures_documented" checked disabled>
                                                <label for="pp-impl-procedures">Safe working procedures documented</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pp-impl-schedules" name="rpii_implement" value="schedules_operational" checked disabled>
                                                <label for="pp-impl-schedules">Inspection schedules operational</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pp-impl-training" name="rpii_implement" value="training_delivered">
                                                <label for="pp-impl-training">Staff training programme delivered</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- IMPROVE -->
                                <div class="rpii-stage">
                                    <div class="rpii-title">I - IMPROVE</div>
                                    <div class="form-group">
                                        <label class="form-label" for="pp-improve-actions">Improvement Actions Identified</label>
                                        <textarea id="pp-improve-actions" name="improvement_actions" class="form-input" rows="3" 
                                                  placeholder="List specific improvement actions..."></textarea>
                                    </div>
                                </div>

                                <button type="button" class="btn btn-secondary" onclick="showPlayParkStep('maintenance')">Back</button>
                                <button type="submit" class="btn btn-submit">Submit Complete Play Park Assessment</button>
                            </div>
                        </div>

                        <!-- Success Message -->
                        <div id="pp-successMessage" style="display: none;">
                            <div class="alert alert-success">
                                <h3>Submission Successful</h3>
                                <p>Your play park assessment has been successfully submitted.</p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Executive Dashboard Section -->
            <div id="dashboard" class="content-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Executive Dashboard</h2>
                        <p class="section-subtitle">Comprehensive business overview</p>
                    </div>
                    <div class="header-stats">
                        <div class="stat-item">
                            <div class="stat-value">98%</div>
                            <div class="stat-label">Compliance</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">Active</div>
                            <div class="stat-label">System Status</div>
                        </div>
                    </div>
                </div>

                <div class="playpark-container">
                    <div class="form-section">
                        <h3>System Overview</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <div class="alert alert-success">
                                    <strong>Open Incidents:</strong> 3 active cases requiring attention
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="alert alert-success">
                                    <strong>Resolved Today:</strong> 7 cases successfully closed
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <div class="alert alert-info">
                                    <strong>Play Parks:</strong> 12 parks managed, 3 inspections due this week
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="alert alert-info">
                                    <strong>Hot Tubs:</strong> 5 active units, 96% quality score
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <div class="alert alert-warning">
                                    <strong>Maintenance Due:</strong> 8 items scheduled for this week
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="alert alert-info">
                                    <strong>Staff Training:</strong> 95% compliance rate
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Quick Actions</h3>
                        <div class="form-row">
                            <button type="button" class="btn" onclick="showSection('incidents-actions')">Report New Incident</button>
                            <button type="button" class="btn" onclick="showSection('play-parks')">Start Park Inspection</button>
                            <button type="button" class="btn" onclick="showSection('hot-tubs')">Hot Tub Check</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Recent Activity</h3>
                        <table class="inspection-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Module</th>
                                    <th>Action</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>09:15</td>
                                    <td>Play Parks</td>
                                    <td>Daily Inspection - Park A</td>
                                    <td><span style="color: var(--success);">✔ Complete</span></td>
                                </tr>
                                <tr>
                                    <td>08:45</td>
                                    <td>Hot Tubs</td>
                                    <td>Water Quality Test - Unit 3</td>
                                    <td><span style="color: var(--success);">✔ Complete</span></td>
                                </tr>
                                <tr>
                                    <td>08:30</td>
                                    <td>Incidents</td>
                                    <td>Minor slip hazard reported</td>
                                    <td><span style="color: var(--warning);">⚠ In Progress</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Incidents & Actions Section -->
            <div id="incidents-actions" class="content-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Incident Reporting System</h2>
                        <p class="section-subtitle">Professional incident management and reporting platform</p>
                    </div>
                    <div class="header-stats">
                        <div class="stat-item">
                            <div class="stat-value">3</div>
                            <div class="stat-label">Open Cases</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">27</div>
                            <div class="stat-label">Resolved</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">Active</div>
                            <div class="stat-label">System</div>
                        </div>
                    </div>
                </div>

                <div class="playpark-container">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div class="incident-ref-badge" style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, var(--primary-orange), var(--dark-orange)); color: white; padding: 8px 16px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; box-shadow: var(--shadow-medium);">
                            <span>Incident Reference: <span id="refNumber">INC-00000000-0000-0000</span></span>
                        </div>
                        <div class="status-indicator" style="margin-top: 15px; display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 8px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; background: rgba(40, 167, 69, 0.1); color: var(--success);">
                            <span>System Active</span>
                        </div>
                    </div>

                    <!-- Form with Formspree integration -->
                    <form id="masterIncidentForm" action="https://formspree.io/f/xldprzkr" method="POST" enctype="multipart/form-data">
                        <!-- Hidden fields for Formspree -->
                        <input type="hidden" name="_subject" value="New CQR365 Incident Report">
                        <input type="hidden" name="incident_reference" id="hiddenIncidentRef">
                        <input type="hidden" name="witness_statements_json" id="hiddenWitnessData">

                        <!-- Progress Bar -->
                        <div class="progress-container" style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.2);">
                            <div class="progress-steps" style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 15px;">
                                <div class="step-indicator active" id="step1" style="padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: var(--primary-orange); color: var(--white); border: 1px solid var(--primary-orange);">1. Incident Report</div>
                                <div class="step-indicator" id="step2" style="padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: rgba(255,255,255,0.1); color: #B8C5D6; border: 1px solid rgba(255,255,255,0.2);">2. Investigation</div>
                                <div class="step-indicator" id="step3" style="padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: rgba(255,255,255,0.1); color: #B8C5D6; border: 1px solid rgba(255,255,255,0.2);">3. Review & Submit</div>
                            </div>
                            <div class="progress-bar" style="background: rgba(255,255,255,0.2); height: 4px; border-radius: 2px; overflow: hidden;">
                                <div class="progress-fill" id="progressFill" style="background: linear-gradient(90deg, var(--primary-orange), var(--success)); height: 100%; border-radius: 2px; width: 33.33%;"></div>
                            </div>
                        </div>

                        <!-- STEP 1: Initial Incident Form -->
                        <div class="form-step active" id="incidentStep">
                            <div class="form-section">
                                <h3>Incident Report</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="incidentDate">Date of Incident <span class="required">*</span></label>
                                        <input type="date" id="incidentDate" name="incident_date" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="incidentTime">Time of Incident <span class="required">*</span></label>
                                        <input type="time" id="incidentTime" name="incident_time" class="form-input" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="reportedBy">Reported By <span class="required">*</span></label>
                                        <input type="text" id="reportedBy" name="reported_by" class="form-input" placeholder="Full name of reporter" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="reporterRole">Reporter Role <span class="required">*</span></label>
                                        <select id="reporterRole" name="reporter_role" class="form-input" required>
                                            <option value="">Select your role...</option>
                                            <option value="manager">Manager</option>
                                            <option value="supervisor">Supervisor</option>
                                            <option value="employee">Employee</option>
                                            <option value="contractor">Contractor</option>
                                            <option value="visitor">Visitor</option>
                                            <option value="guest">Guest</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="incidentLocation">Location of Incident <span class="required">*</span></label>
                                    <select id="incidentLocation" name="incident_location" class="form-input" required>
                                        <option value="">Select incident location...</option>
                                        <option value="reception">Reception Area</option>
                                        <option value="restaurant">Restaurant</option>
                                        <option value="bar">Bar/Lounge</option>
                                        <option value="kitchen">Kitchen</option>
                                        <option value="accommodation">Accommodation Unit</option>
                                        <option value="swimming-pool">Swimming Pool Area</option>
                                        <option value="playground">Playground</option>
                                        <option value="car-park">Car Park</option>
                                        <option value="maintenance">Maintenance Area</option>
                                        <option value="hot-tub">Hot Tub Area</option>
                                        <option value="play-park">Play Park</option>
                                        <option value="other">Other Location</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="incidentType">Type of Incident <span class="required">*</span></label>
                                    <select id="incidentType" name="incident_type" class="form-input" required>
                                        <option value="">Select incident type...</option>
                                        <option value="accident">Accident</option>
                                        <option value="near-miss">Near Miss</option>
                                        <option value="injury">Personal Injury</option>
                                        <option value="property-damage">Property Damage</option>
                                        <option value="security">Security Incident</option>
                                        <option value="fire">Fire Related</option>
                                        <option value="medical">Medical Emergency</option>
                                        <option value="environmental">Environmental</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Incident Severity <span class="required">*</span></label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="radio" name="incident_severity" value="low" id="severity-low" required>
                                            <label for="severity-low">Low - Minor incident, no injury</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="radio" name="incident_severity" value="medium" id="severity-medium" required>
                                            <label for="severity-medium">Medium - First aid required</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="radio" name="incident_severity" value="high" id="severity-high" required>
                                            <label for="severity-high">High - Medical attention needed</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="radio" name="incident_severity" value="critical" id="severity-critical" required>
                                            <label for="severity-critical">Critical - Emergency services required</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">People Involved</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="employees" name="people_involved" value="employees">
                                            <label for="employees">Employees</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="guests" name="people_involved" value="guests">
                                            <label for="guests">Guests</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="contractors" name="people_involved" value="contractors">
                                            <label for="contractors">Contractors</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="visitors" name="people_involved" value="visitors">
                                            <label for="visitors">Visitors</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="children" name="people_involved" value="children">
                                            <label for="children">Children (Under 18)</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group form-group-full">
                                    <label class="form-label" for="incidentDescription">Detailed Description <span class="required">*</span></label>
                                    <textarea id="incidentDescription" name="incident_description" class="form-input" rows="5" 
                                              placeholder="Provide a comprehensive description of what happened..." required></textarea>
                                </div>
                                
                                <div class="form-group form-group-full">
                                    <label class="form-label" for="immediateActions">Immediate Actions Taken</label>
                                    <textarea id="immediateActions" name="immediate_actions" class="form-input" rows="3" 
                                              placeholder="Describe any immediate actions taken (first aid, area secured, etc.)..."></textarea>
                                </div>
                                
                                <div class="form-group form-group-full">
                                    <label class="form-label" for="witnesses">Witnesses</label>
                                    <textarea id="witnesses" name="witnesses_info" class="form-input" rows="2" 
                                              placeholder="Names and contact details of witnesses..."></textarea>
                                </div>
                                
                                <div class="form-group form-group-full">
                                    <label class="form-label">Witness Statements</label>
                                    <div id="witnessStatus" class="witness-status-container" style="background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 25px;">
                                        <div class="witness-status-message" style="text-align: center; color: #B8C5D6; font-style: italic;">No witness statements completed yet</div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 30px; display: flex; gap: 20px; justify-content: center;">
                                    <button type="button" class="btn" onclick="proceedToInvestigation()">
                                        Continue to Investigation
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="openWitnessForm()">
                                        Add Witness Statement
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- STEP 2: Investigation Form -->
                        <div class="form-step" id="investigationStep" style="display: none;">
                            <div class="form-section">
                                <h3>Investigation & Action Plan</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="investigator">Lead Investigator <span class="required">*</span></label>
                                        <input type="text" id="investigator" name="lead_investigator" class="form-input" 
                                               placeholder="Name of investigating officer">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="investigationDate">Investigation Date <span class="required">*</span></label>
                                        <input type="date" id="investigationDate" name="investigation_date" class="form-input">
                                    </div>
                                </div>
                                
                                <div class="form-group form-group-full">
                                    <label class="form-label" for="rootCause">Root Cause Analysis <span class="required">*</span></label>
                                    <textarea id="rootCause" name="root_cause_analysis" class="form-input" rows="4" 
                                              placeholder="Identify the underlying causes..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Contributing Factors</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="human-error" name="contributing_factors" value="human-error">
                                            <label for="human-error">Human Error</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="equipment-failure" name="contributing_factors" value="equipment-failure">
                                            <label for="equipment-failure">Equipment Failure</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="inadequate-training" name="contributing_factors" value="inadequate-training">
                                            <label for="inadequate-training">Inadequate Training</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="environmental" name="contributing_factors" value="environmental">
                                            <label for="environmental">Environmental Factors</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group form-group-full">
                                    <label class="form-label" for="correctiveActions">Corrective Actions <span class="required">*</span></label>
                                    <textarea id="correctiveActions" name="corrective_actions" class="form-input" rows="4" 
                                              placeholder="List specific actions to prevent recurrence..."></textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="actionOwner">Action Owner <span class="required">*</span></label>
                                        <input type="text" id="actionOwner" name="action_owner" class="form-input" 
                                               placeholder="Responsible person/department">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="targetDate">Target Date <span class="required">*</span></label>
                                        <input type="date" id="targetDate" name="target_completion_date" class="form-input">
                                    </div>
                                </div>
                                
                                <div style="margin-top: 30px; display: flex; gap: 20px; justify-content: center;">
                                    <button type="button" class="btn btn-secondary" onclick="backToIncidentForm()">
                                        Back to Incident Report
                                    </button>
                                    <button type="button" class="btn" onclick="proceedToSubmission()">
                                        Review & Submit
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- STEP 3: Review & Submit -->
                        <div class="form-step" id="submissionStep" style="display: none;">
                            <div class="form-section">
                                <h3>Review & Submit Report</h3>
                                <div id="reportSummary"></div>
                                
                                <div style="margin-top: 30px; display: flex; gap: 20px; justify-content: center;">
                                    <button type="button" class="btn btn-secondary" onclick="backToInvestigation()">
                                        Back to Edit
                                    </button>
                                    <button type="submit" class="btn btn-submit" id="finalSubmitBtn">
                                        Submit Complete Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Hot Tubs Section -->
            <div id="hot-tubs" class="content-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Hot Tub Management System</h2>
                        <p class="section-subtitle">Real-time monitoring and maintenance compliance</p>
                    </div>
                    <div class="header-stats">
                        <div class="stat-item">
                            <div class="stat-value">5</div>
                            <div class="stat-label">Active Units</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">96%</div>
                            <div class="stat-label">Quality Score</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">2</div>
                            <div class="stat-label">Due Today</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">2 hrs</div>
                            <div class="stat-label">Last Check</div>
                        </div>
                    </div>
                </div>

                <div class="playpark-container">
                    <form id="hotTubForm" action="https://formspree.io/f/mqayzvrv" method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="_subject" value="Hot Tub Maintenance Report Submission">
                        
                        <div id="hottub-success" class="alert alert-success" style="display: none;">
                            Hot Tub Maintenance Report submitted successfully! Thank you.
                        </div>

                        <div class="form-section">
                            <h3>Site & Inspection Details</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Property/Site Name <span class="required">*</span></label>
                                    <select name="business_name" class="form-input" required id="ht-site-select" onchange="updateHotTubList()">
                                        <option value="">Select Site</option>
                                        <option value="Sunshine Holiday Park">Sunshine Holiday Park</option>
                                        <option value="Riverside Resort">Riverside Resort</option>
                                        <option value="Lakeside Lodge">Lakeside Lodge</option>
                                        <option value="Coastal Retreat">Coastal Retreat</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Inspection Date <span class="required">*</span></label>
                                    <input type="date" name="maintenance_date" class="form-input" required id="ht-maintenance-date">
                                </div>
                            </div>
                            
                            <!-- Quick Daily Check Option -->
                            <div class="alert alert-info" id="quick-check-option" style="margin: 20px 0;">
                                <strong>Quick Daily Check:</strong> 
                                <button type="button" class="btn" onclick="selectAllDailyChecks()" style="margin: 0 10px;">Select All Daily Tasks</button>
                                <button type="button" class="btn" onclick="submitQuickCheck()" style="margin: 0 10px;">Submit Quick Check</button>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Inspector/Technician <span class="required">*</span></label>
                                    <select name="technician_name" class="form-input" required id="technician-select" onchange="updateTechnicianCert()">
                                        <option value="">Select Inspector</option>
                                        <option value="John Smith" data-cert="WQ-2024-001">John Smith</option>
                                        <option value="Sarah Johnson" data-cert="WQ-2024-002">Sarah Johnson</option>
                                        <option value="Mike Davis" data-cert="WQ-2024-003">Mike Davis</option>
                                        <option value="Emma Wilson" data-cert="WQ-2024-004">Emma Wilson</option>
                                        <option value="custom">Other Inspector</option>
                                    </select>
                                    <input type="text" name="custom_technician" class="form-input" id="custom-technician" placeholder="Enter inspector name" style="display: none; margin-top: 10px;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Professional Certification</label>
                                    <input type="text" name="licence_number" class="form-input" id="technician-cert" placeholder="Auto-filled for selected inspector">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Hot Tub Information & Management</h3>
                            
                            <!-- Add/Remove Hot Tubs -->
                            <div class="form-row" style="margin-bottom: 20px;">
                                <div class="form-group">
                                    <button type="button" class="btn btn-secondary" onclick="showAddHotTubDialog()">+ Add New Hot Tub</button>
                                    <button type="button" class="btn btn-secondary" onclick="showRemoveHotTubDialog()">- Remove Hot Tub</button>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Hot Tub ID/Location <span class="required">*</span></label>
                                    <select name="hottub_id" class="form-input" required id="hottub-select" onchange="updateHotTubDetails()">
                                        <option value="">Select Hot Tub</option>
                                        <!-- Options will be dynamically loaded based on selected site -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Capacity (Litres)</label>
                                    <input type="number" name="hottub_capacity" class="form-input" id="hottub-capacity" placeholder="Auto-filled when selected" readonly>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Last Professional Service</label>
                                    <input type="date" name="last_service_date" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Maintenance Type <span class="required">*</span></label>
                                    <select name="maintenance_type" class="form-input" required>
                                        <option value="">Select Type</option>
                                        <option value="daily">Daily Check</option>
                                        <option value="changeover">Changeover Maintenance</option>
                                        <option value="deep-clean">Deep Clean</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Maintenance Tasks Completed</h3>
                            
                            <h4 style="color: var(--primary-orange); margin: 20px 0 15px;">Daily Check Tasks</h4>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="visual_inspection" id="visual-inspection" value="completed">
                                    <label for="visual-inspection">Visual inspection of water clarity and equipment</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="water_testing" id="water-testing" value="completed">
                                    <label for="water-testing">Water chemistry testing completed and logged</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="waterline_clean" id="waterline-clean" value="completed">
                                    <label for="waterline-clean">Waterline cleaned and scrubbed</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="surface_debris" id="surface-debris" value="completed">
                                    <label for="surface-debris">Surface debris removed</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="lid_inspection" id="lid-inspection" value="completed">
                                    <label for="lid-inspection">Hot tub lid/cover inspected for damage</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="lid_clean" id="lid-clean" value="completed">
                                    <label for="lid-clean">Hot tub lid cleaned and treated</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="lid_secure" id="lid-secure" value="completed">
                                    <label for="lid-secure">Hot tub lid properly secured and locked</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="safety_equipment" id="safety-equipment" value="completed">
                                    <label for="safety-equipment">Safety equipment check (emergency stop, signage)</label>
                                </div>
                            </div>

                            <h4 style="color: var(--primary-orange); margin: 30px 0 15px;">Changeover Tasks (if applicable)</h4>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="full_drain" id="full-drain" value="completed">
                                    <label for="full-drain">Complete hot tub drain</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="shell_clean" id="shell-clean" value="completed">
                                    <label for="shell-clean">Full shell and surface cleaning</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="jet_clean" id="jet-clean" value="completed">
                                    <label for="jet-clean">Jets deep cleaned and inspected</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="filter_change" id="filter-change" value="completed">
                                    <label for="filter-change">Filter cartridges changed</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="refill_complete" id="refill-complete" value="completed">
                                    <label for="refill-complete">Complete refill and initial chemical balance</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="system_restart" id="system-restart" value="completed">
                                    <label for="system-restart">System restart and circulation check</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Water Quality Testing & Monitoring</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="ph-level">pH Level <span class="required">*</span></label>
                                    <input type="number" name="ph_level" class="form-input" id="ph-level" step="0.1" min="6.0" max="8.0" required>
                                    <small style="color: #B8C5D6;">Target: 7.2 - 7.6</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bromine-level">Free Bromine (mg/l) <span class="required">*</span></label>
                                    <input type="number" name="bromine_level" class="form-input" id="bromine-level" step="0.1" min="0" max="8" required>
                                    <small style="color: #B8C5D6;">Target: 3.0 - 5.0 mg/l</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="temperature">Temperature (°C) <span class="required">*</span></label>
                                    <input type="number" name="temperature" class="form-input" id="temperature" step="0.1" min="35" max="40" required>
                                    <small style="color: #B8C5D6;">Legal Max: 40°C</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="total-alkalinity">Total Alkalinity (mg/l) <span class="required">*</span></label>
                                    <input type="number" name="total_alkalinity" class="form-input" id="total-alkalinity" step="1" min="80" max="200" required>
                                    <small style="color: #B8C5D6;">Target: 80 - 120 mg/l</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Chemical Treatment Log</h3>
                            <div class="form-group form-group-full">
                                <label class="form-label">Chemicals Added</label>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="bromine_tablets" id="bromine-tablets" value="added">
                                        <label for="bromine-tablets">Bromine Tablets</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="ph_plus" id="ph-plus" value="added">
                                        <label for="ph-plus">pH Plus</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="ph_minus" id="ph-minus" value="added">
                                        <label for="ph-minus">pH Minus</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="alkalinity_increaser" id="alkalinity-increaser" value="added">
                                        <label for="alkalinity-increaser">Alkalinity Increaser</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="bromine_shock" id="bromine-shock" value="added">
                                        <label for="bromine-shock">Bromine Shock</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="anti_foam" id="anti-foam" value="added">
                                        <label for="anti-foam">Anti-Foam</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group form-group-full">
                                <label class="form-label">Chemical Treatment Details</label>
                                <textarea name="chemical_notes" class="form-input" rows="4" placeholder="Record specific chemical amounts, treatments, or observations..."></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Issues & Maintenance Notes</h3>
                            
                            <div class="form-group form-group-full">
                                <label class="form-label">Issues Identified</label>
                                <textarea name="issues_identified" class="form-input" rows="4" placeholder="Document any equipment issues, water quality problems, or safety concerns..."></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Issue Priority</label>
                                    <select name="priority_level" class="form-input">
                                        <option value="low">Low - Routine</option>
                                        <option value="medium">Medium - Schedule Soon</option>
                                        <option value="high">High - Urgent</option>
                                        <option value="critical">Critical - Immediate Action</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Follow-up Required By</label>
                                    <input type="date" name="follow_up_date" class="form-input">
                                </div>
                            </div>
                            
                            <div class="form-group form-group-full">
                                <label class="form-label">Additional Notes</label>
                                <textarea name="additional_notes" class="form-input" rows="3" placeholder="Any additional maintenance notes, observations, or special instructions..."></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-submit">Submit Hot Tub Maintenance Report</button>
                    </form>
                </div>
            </div>

            <!-- Other sections as placeholders -->
            <div id="property-passports" class="content-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Property Passports</h2>
                        <p class="section-subtitle">Property management documentation</p>
                    </div>
                </div>
                <div style="padding: 40px; text-align: center;">
                    <p>Property Passports module - Integration pending</p>
                </div>
            </div>

            <div id="accommodation" class="content-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Accommodation</h2>
                        <p class="section-subtitle">Accommodation management system</p>
                    </div>
                </div>
                <div style="padding: 40px; text-align: center;">
                    <p>Accommodation module - Integration pending</p>
                </div>
            </div>

            <div id="grounds-maintenance" class="content-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Grounds & Maintenance</h2>
                        <p class="section-subtitle">Grounds and maintenance management</p>
                    </div>
                </div>
                <div style="padding: 40px; text-align: center;">
                    <p>Grounds & Maintenance module - Integration pending</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Global variables
        let incidentReferenceNumber = '';
        let witnesses = [];
        let currentIncidentStep = 1;
        
        // Data storage for parks and hot tubs
        const siteData = {
            'Sunshine Holiday Park': {
                playParks: ['Main Adventure Park', 'Toddler Play Area', 'Water Splash Zone'],
                hotTubs: [
                    {id: 'HT-001-SHP', name: 'Poolside Spa 1', capacity: 1200},
                    {id: 'HT-002-SHP', name: 'Poolside Spa 2', capacity: 1200},
                    {id: 'HT-003-SHP', name: 'VIP Lodge Spa', capacity: 800}
                ]
            },
            'Riverside Resort': {
                playParks: ['River Adventure Zone', 'Kids Kingdom'],
                hotTubs: [
                    {id: 'HT-001-RR', name: 'Riverside Spa', capacity: 1500},
                    {id: 'HT-002-RR', name: 'Deck Spa', capacity: 1000}
                ]
            },
            'Lakeside Lodge': {
                playParks: ['Lakeside Adventure Park'],
                hotTubs: [
                    {id: 'HT-001-LL', name: 'Lake View Spa', capacity: 1300}
                ]
            },
            'Coastal Retreat': {
                playParks: ['Beach Play Zone', 'Coastal Kids Area'],
                hotTubs: [
                    {id: 'HT-001-CR', name: 'Ocean View Spa 1', capacity: 1100},
                    {id: 'HT-002-CR', name: 'Ocean View Spa 2', capacity: 1100}
                ]
            }
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            // Generate incident reference
            incidentReferenceNumber = generateIncidentReference();
            document.getElementById('refNumber').textContent = incidentReferenceNumber;
            document.getElementById('hiddenIncidentRef').value = incidentReferenceNumber;
            
            // Set today's dates
            const today = new Date().toISOString().split('T')[0];
            const dateFields = ['pp-inspection-date', 'ht-maintenance-date', 'incidentDate', 'investigationDate'];
            dateFields.forEach(id => {
                const field = document.getElementById(id);
                if (field) field.value = today;
            });
            
            // Setup form submissions
            setupFormSubmissions();
        }

        // Generate incident reference number
        function generateIncidentReference() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const random = Math.floor(Math.random() * 9999).toString().padStart(4, '0');
            
            return `INC-${year}${month}${day}-${hours}${minutes}-${random}`;
        }

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Add active class to clicked button
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Close mobile nav if open
            closeMobileNav();
        }

        // Mobile navigation
        function toggleMobileNav() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
            document.querySelector('.mobile-overlay').classList.toggle('active');
        }

        function closeMobileNav() {
            document.getElementById('sidebar').classList.remove('mobile-open');
            document.querySelector('.mobile-overlay').classList.remove('active');
        }

        // Play Park Functions
        function showPlayParkStep(stepId) {
            // Hide all play park steps
            document.querySelectorAll('.playpark-step').forEach(step => {
                step.classList.remove('active');
            });
            
            // Remove active from all nav buttons
            document.querySelectorAll('.playpark-nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected step
            document.getElementById('pp-' + stepId).classList.add('active');
            
            // Update nav button
            const navButtons = {
                'onboarding': 0,
                'risk-assessment': 1,
                'inspection': 2,
                'maintenance': 3,
                'rpii': 4
            };
            
            const buttons = document.querySelectorAll('.playpark-nav-button');
            if (buttons[navButtons[stepId]]) {
                buttons[navButtons[stepId]].classList.add('active');
            }
            
            // Update hidden submission type
            document.getElementById('playParkSubmissionType').value = stepId;
        }

        function updatePlayParkList() {
            const facility = document.getElementById('pp-park-name').value;
            const parkSelect = document.getElementById('pp-park-id');
            
            parkSelect.innerHTML = '<option value="">Select Play Park Area</option>';
            
            if (facility && siteData[facility]) {
                siteData[facility].playParks.forEach(park => {
                    const option = document.createElement('option');
                    option.value = park;
                    option.textContent = park;
                    parkSelect.appendChild(option);
                });
            }
        }

        function showAddPlayParkDialog() {
            const newParkName = prompt('Enter new play park name:');
            if (newParkName) {
                const facility = document.getElementById('pp-park-name').value;
                if (!facility) {
                    alert('Please select a facility first');
                    return;
                }
                
                if (!siteData[facility]) {
                    siteData[facility] = { playParks: [], hotTubs: [] };
                }
                
                siteData[facility].playParks.push(newParkName);
                updatePlayParkList();
                alert(`${newParkName} added successfully!`);
            }
        }

        function showRemovePlayParkDialog() {
            const facility = document.getElementById('pp-park-name').value;
            if (!facility || !siteData[facility] || siteData[facility].playParks.length === 0) {
                alert('No play parks available to remove');
                return;
            }
            
            const parkToRemove = prompt(`Enter park name to remove:\n${siteData[facility].playParks.join('\n')}`);
            if (parkToRemove) {
                const index = siteData[facility].playParks.indexOf(parkToRemove);
                if (index > -1) {
                    siteData[facility].playParks.splice(index, 1);
                    updatePlayParkList();
                    alert(`${parkToRemove} removed successfully!`);
                }
            }
        }

        function quickPlayParkDailyCheck() {
            // Set inspection type to daily
            document.getElementById('pp-inspection-type').value = 'daily';
            
            // Check all safety checks
            document.querySelectorAll('input[name="safety_checks"]').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            // Set all equipment to good condition
            document.querySelectorAll('input[value="good"]').forEach(radio => {
                radio.checked = true;
            });
            
            // Set overall condition to good
            document.getElementById('pp-overall-condition').value = 'good';
            
            alert('Daily check completed - all equipment marked as good condition');
        }

        function selectAllPlayParkDailyChecks() {
            document.querySelectorAll('input[name="safety_checks"]').forEach(checkbox => {
                checkbox.checked = true;
            });
            alert('All safety checks selected');
        }

        // Hot Tub Functions
        function updateHotTubList() {
            const site = document.getElementById('ht-site-select').value;
            const hotTubSelect = document.getElementById('hottub-select');
            
            hotTubSelect.innerHTML = '<option value="">Select Hot Tub</option>';
            
            if (site && siteData[site]) {
                siteData[site].hotTubs.forEach(tub => {
                    const option = document.createElement('option');
                    option.value = tub.id;
                    option.textContent = `${tub.name} (${tub.id})`;
                    option.setAttribute('data-capacity', tub.capacity);
                    hotTubSelect.appendChild(option);
                });
            }
        }

        function updateHotTubDetails() {
            const select = document.getElementById('hottub-select');
            const capacityField = document.getElementById('hottub-capacity');
            
            if (select.selectedIndex > 0) {
                const option = select.options[select.selectedIndex];
                capacityField.value = option.getAttribute('data-capacity') || '';
            } else {
                capacityField.value = '';
            }
        }

        function showAddHotTubDialog() {
            const site = document.getElementById('ht-site-select').value;
            if (!site) {
                alert('Please select a site first');
                return;
            }
            
            const name = prompt('Enter hot tub name:');
            if (!name) return;
            
            const capacity = prompt('Enter capacity in litres:');
            if (!capacity || isNaN(capacity)) return;
            
            const id = `HT-${Math.floor(Math.random() * 999).toString().padStart(3, '0')}-${site.split(' ').map(w => w[0]).join('')}`;
            
            if (!siteData[site]) {
                siteData[site] = { playParks: [], hotTubs: [] };
            }
            
            siteData[site].hotTubs.push({ id, name, capacity: parseInt(capacity) });
            updateHotTubList();
            alert(`${name} added successfully!`);
        }

        function showRemoveHotTubDialog() {
            const site = document.getElementById('ht-site-select').value;
            if (!site || !siteData[site] || siteData[site].hotTubs.length === 0) {
                alert('No hot tubs available to remove');
                return;
            }
            
            const tubList = siteData[site].hotTubs.map(t => `${t.name} (${t.id})`).join('\n');
            const idToRemove = prompt(`Enter hot tub ID to remove:\n${tubList}`);
            
            if (idToRemove) {
                const index = siteData[site].hotTubs.findIndex(t => t.id === idToRemove);
                if (index > -1) {
                    const name = siteData[site].hotTubs[index].name;
                    siteData[site].hotTubs.splice(index, 1);
                    updateHotTubList();
                    alert(`${name} removed successfully!`);
                }
            }
        }

        function updateTechnicianCert() {
            const select = document.getElementById('technician-select');
            const certField = document.getElementById('technician-cert');
            const customField = document.getElementById('custom-technician');
            
            if (select.value === 'custom') {
                customField.style.display = 'block';
                certField.value = '';
            } else {
                customField.style.display = 'none';
                if (select.selectedIndex > 0) {
                    const option = select.options[select.selectedIndex];
                    certField.value = option.getAttribute('data-cert') || '';
                }
            }
        }

        function selectAllDailyChecks() {
            const checkboxes = [
                'visual-inspection', 'water-testing', 'waterline-clean',
                'surface-debris', 'lid-inspection', 'lid-clean',
                'lid-secure', 'safety-equipment'
            ];
            
            checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) checkbox.checked = true;
            });
            
            alert('All daily tasks selected');
        }

        function submitQuickCheck() {
            // Select all daily checks
            selectAllDailyChecks();
            
            // Set optimal water values
            document.getElementById('ph-level').value = '7.4';
            document.getElementById('bromine-level').value = '4.0';
            document.getElementById('temperature').value = '38.5';
            document.getElementById('total-alkalinity').value = '100';
            
            alert('Quick check ready - please review and submit');
        }

        // Risk Assessment Functions
        function updatePlayParkRiskAssessment() {
            const equipment = Array.from(document.querySelectorAll('input[name="equipment"]:checked')).map(el => el.value);
            const surfaceType = document.getElementById('pp-surface-type').value;

            if (equipment.length === 0 || !surfaceType) {
                document.getElementById('pp-risk-list').innerHTML = '<p><em>Please select equipment and surface type to generate risk assessment.</em></p>';
                return;
            }

            let riskHTML = '<ul style="color: var(--white); list-style: none; padding: 0;">';
            
            equipment.forEach(item => {
                const risks = getPlayParkEquipmentRisks(item, surfaceType);
                risks.forEach(risk => {
                    let riskColor = risk.level === 'High' ? '#FF4500' : 
                                   risk.level === 'Medium' ? '#FFD700' : '#90EE90';
                    riskHTML += `<li style="margin: 10px 0;">
                        <strong>${risk.hazard}:</strong> ${risk.description} 
                        <span style="background: ${riskColor}; color: var(--black); font-weight: bold; padding: 2px 8px; border-radius: 3px; margin-left: 10px;">
                        ${risk.level} Risk</span>
                    </li>`;
                });
            });
            
            riskHTML += '</ul>';
            document.getElementById('pp-risk-list').innerHTML = riskHTML;
        }

        function getPlayParkEquipmentRisks(equipment, surfaceType) {
            const riskDatabase = {
                'swings': [
                    { hazard: 'Fall from Height', description: 'Falls from swing seats during use', level: 'Medium' },
                    { hazard: 'Impact Injury', description: 'Being struck by moving swing', level: 'High' },
                    { hazard: 'Entanglement', description: 'Clothing/jewelry caught in chains', level: 'Low' }
                ],
                'slides': [
                    { hazard: 'Fall from Height', description: 'Falls from platform or slide surface', level: 'Medium' },
                    { hazard: 'Burns', description: 'Hot surfaces in direct sunlight', level: 'Low' },
                    { hazard: 'Collision', description: 'Multiple users on slide simultaneously', level: 'Medium' }
                ],
                'climbing': [
                    { hazard: 'Fall from Height', description: 'Falls during climbing activity', level: 'High' },
                    { hazard: 'Crush Injury', description: 'Hands/fingers caught in gaps', level: 'Medium' }
                ],
                'seesaws': [
                    { hazard: 'Impact Injury', description: 'Sudden impact when seesaw hits ground', level: 'Medium' },
                    { hazard: 'Pinch Points', description: 'Fingers caught in pivot mechanism', level: 'Medium' }
                ],
                'roundabout': [
                    { hazard: 'Centrifugal Force', description: 'Children thrown from equipment', level: 'High' },
                    { hazard: 'Collision', description: 'Impact with stationary objects', level: 'Medium' }
                ],
                'spring': [
                    { hazard: 'Fall Risk', description: 'Falls from spring riders', level: 'Low' },
                    { hazard: 'Pinch Points', description: 'Fingers caught in spring mechanism', level: 'Medium' }
                ],
                'multiplay': [
                    { hazard: 'Multiple Hazards', description: 'Combined risks from various components', level: 'Medium' },
                    { hazard: 'Congestion', description: 'Multiple users causing collisions', level: 'Medium' }
                ],
                'sandbox': [
                    { hazard: 'Hygiene', description: 'Contamination from animals or debris', level: 'Medium' },
                    { hazard: 'Eye Injury', description: 'Sand thrown into eyes', level: 'Low' }
                ],
                'water': [
                    { hazard: 'Slip Hazard', description: 'Wet surfaces causing slips', level: 'High' },
                    { hazard: 'Hygiene', description: 'Water quality and contamination', level: 'Medium' }
                ],
                'fitness': [
                    { hazard: 'Strain Injury', description: 'Improper use causing muscle strain', level: 'Medium' },
                    { hazard: 'Impact', description: 'Falls from equipment', level: 'Medium' }
                ]
            };

            let risks = riskDatabase[equipment] || [
                { hazard: 'General Hazard', description: 'Equipment specific assessment required', level: 'Medium' }
            ];
            
            // Adjust risk based on surface type
            if (surfaceType === 'concrete' || surfaceType === 'grass') {
                risks = risks.map(risk => {
                    if (risk.hazard.includes('Fall')) {
                        return {...risk, level: 'High'};
                    }
                    return risk;
                });
            }
            
            return risks;
        }

        function generatePlayParkProcedures() {
            const equipment = Array.from(document.querySelectorAll('input[name="equipment"]:checked')).map(el => el.value);
            
            if (equipment.length === 0) {
                alert('Please select equipment to generate procedures');
                return;
            }
            
            let proceduresHTML = '';
            
            equipment.forEach(item => {
                const procedures = getPlayParkProcedures(item);
                proceduresHTML += `<div class="procedure-step">
                    <h4>${procedures.title}</h4>
                    <p><strong>Inspection Procedures:</strong></p>
                    <ul>`;
                
                procedures.steps.forEach(step => {
                    proceduresHTML += `<li>${step}</li>`;
                });
                
                proceduresHTML += `</ul>
                    <div class="legislation-ref">Reference: ${procedures.reference}</div>
                </div>`;
            });
            
            document.getElementById('pp-equipment-procedures').innerHTML = proceduresHTML;
            document.getElementById('pp-generated-procedures').style.display = 'block';
        }

        function getPlayParkProcedures(equipment) {
            const procedureDatabase = {
                'swings': {
                    title: 'Swing Safety Procedures',
                    steps: [
                        'Check all swing seats for cracks or damage',
                        'Inspect chains/ropes for wear or fraying',
                        'Verify connection points are secure',
                        'Test swing operation for smooth movement',
                        'Check fall zone surfacing adequacy'
                    ],
                    reference: 'BS EN 1176-1:2017, Section 4.2.6'
                },
                'slides': {
                    title: 'Slide Safety Procedures',
                    steps: [
                        'Inspect slide surface for cracks or sharp edges',
                        'Check access ladder/steps for stability',
                        'Verify platform barriers are secure',
                        'Test surface temperature in sunlight',
                        'Confirm exit area is clear and safe'
                    ],
                    reference: 'BS EN 1176-1:2017, Section 4.2.4'
                },
                'climbing': {
                    title: 'Climbing Equipment Procedures',
                    steps: [
                        'Check all climbing holds are secure',
                        'Inspect framework for structural integrity',
                        'Verify safety surfacing beneath equipment',
                        'Test all connection points',
                        'Check for appropriate fall zones'
                    ],
                    reference: 'BS EN 1176-1:2017, Section 4.2.5'
                },
                'roundabout': {
                    title: 'Roundabout Safety Procedures',
                    steps: [
                        'Test rotation mechanism for smooth operation',
                        'Check central bearing for wear',
                        'Verify speed limiting mechanism',
                        'Inspect handholds and platforms',
                        'Check clearance zones'
                    ],
                    reference: 'BS EN 1176-1:2017, Section 4.2.7'
                }
            };
            
            return procedureDatabase[equipment] || {
                title: 'Equipment Safety Procedures',
                steps: ['Complete visual inspection', 'Check structural integrity', 'Verify safe operation'],
                reference: 'BS EN 1176-1:2017'
            };
        }

        // Incident Form Functions
        function proceedToInvestigation() {
            if (validateIncidentForm()) {
                showIncidentStep(2);
            }
        }

        function proceedToSubmission() {
            if (validateInvestigationForm()) {
                generateReportSummary();
                showIncidentStep(3);
            }
        }

        function backToIncidentForm() {
            showIncidentStep(1);
        }

        function backToInvestigation() {
            showIncidentStep(2);
        }

        function showIncidentStep(step) {
            currentIncidentStep = step;
            
            // Hide all steps
            document.querySelectorAll('.form-step').forEach(s => {
                s.style.display = 'none';
            });
            
            // Show current step
            if (step === 1) {
                document.getElementById('incidentStep').style.display = 'block';
            } else if (step === 2) {
                document.getElementById('investigationStep').style.display = 'block';
            } else if (step === 3) {
                document.getElementById('submissionStep').style.display = 'block';
            }
            
            // Update progress
            const progress = (currentIncidentStep / 3) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update step indicators
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step${i}`);
                if (indicator) {
                    if (i <= currentIncidentStep) {
                        indicator.style.background = 'var(--primary-orange)';
                        indicator.style.color = 'var(--white)';
                        indicator.style.borderColor = 'var(--primary-orange)';
                    } else {
                        indicator.style.background = 'rgba(255,255,255,0.1)';
                        indicator.style.color = '#B8C5D6';
                        indicator.style.borderColor = 'rgba(255,255,255,0.2)';
                    }
                }
            }
        }

        function validateIncidentForm() {
            const requiredFields = ['incidentDate', 'incidentTime', 'reportedBy', 'reporterRole', 
                                   'incidentLocation', 'incidentType', 'incidentDescription'];
            const severitySelected = document.querySelector('input[name="incident_severity"]:checked');
            
            let isValid = true;
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger)';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            if (!severitySelected) {
                alert('Please select an incident severity level.');
                isValid = false;
            }
            
            if (!isValid) {
                alert('Please complete all required fields.');
            }
            
            return isValid;
        }

        function validateInvestigationForm() {
            const requiredFields = ['investigator', 'investigationDate', 'rootCause', 
                                   'correctiveActions', 'actionOwner', 'targetDate'];
            
            let isValid = true;
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger)';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            if (!isValid) {
                alert('Please complete all required fields.');
            }
            
            return isValid;
        }

        function generateReportSummary() {
            const summary = `
                <div class="form-section">
                    <h4>Incident Summary</h4>
                    <div style="color: var(--white);">
                        <p><strong>Reference:</strong> ${incidentReferenceNumber}</p>
                        <p><strong>Date/Time:</strong> ${document.getElementById('incidentDate').value} ${document.getElementById('incidentTime').value}</p>
                        <p><strong>Location:</strong> ${document.getElementById('incidentLocation').options[document.getElementById('incidentLocation').selectedIndex].text}</p>
                        <p><strong>Type:</strong> ${document.getElementById('incidentType').options[document.getElementById('incidentType').selectedIndex].text}</p>
                        <p><strong>Severity:</strong> ${document.querySelector('input[name="incident_severity"]:checked')?.value || 'Not selected'}</p>
                        <p><strong>Reported By:</strong> ${document.getElementById('reportedBy').value}</p>
                        <p><strong>Investigation Status:</strong> ${document.getElementById('investigator').value ? 'Completed' : 'Pending'}</p>
                        <p><strong>Witness Statements:</strong> ${witnesses.length} recorded</p>
                    </div>
                </div>
            `;
            
            document.getElementById('reportSummary').innerHTML = summary;
        }

        // Witness Form
        function openWitnessForm() {
            const name = prompt('Witness Name:');
            if (!name) return;
            
            const phone = prompt('Contact Phone:');
            if (!phone) return;
            
            const statement = prompt('Brief Statement:');
            if (!statement) return;
            
            witnesses.push({ name, phone, statement });
            updateWitnessStatus();
            
            // Update hidden field
            document.getElementById('hiddenWitnessData').value = JSON.stringify(witnesses);
            
            alert('Witness statement added successfully!');
        }

        function updateWitnessStatus() {
            const container = document.getElementById('witnessStatus');
            if (witnesses.length === 0) {
                container.innerHTML = '<div class="witness-status-message" style="text-align: center; color: #B8C5D6; font-style: italic;">No witness statements completed yet</div>';
            } else {
                let html = '<div style="margin-bottom: 15px; color: var(--success);">✔ ' + witnesses.length + ' witness statement(s) recorded</div>';
                witnesses.forEach(w => {
                    html += `
                        <div style="background: rgba(204, 85, 0, 0.1); border: 1px solid rgba(204, 85, 0, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                            <div style="font-weight: 700; color: var(--white); margin-bottom: 4px;">${w.name}</div>
                            <div style="font-size: 0.85rem; color: #B8C5D6;">${w.phone}</div>
                            <div style="font-size: 0.9rem; color: var(--white); margin-top: 8px;">"${w.statement}"</div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
        }

        // Form submissions
        function setupFormSubmissions() {
            // Play Park form submission
            const playParkForm = document.getElementById('playParkForm');
            if (playParkForm) {
                playParkForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Show success message
                    document.getElementById('pp-successMessage').style.display = 'block';
                    
                    // Submit form after showing message
                    setTimeout(() => {
                        this.submit();
                    }, 2000);
                });
            }
            
            // Hot Tub form submission
            const hotTubForm = document.getElementById('hotTubForm');
            if (hotTubForm) {
                hotTubForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Show success message
                    document.getElementById('hottub-success').style.display = 'block';
                    
                    // Submit form after showing message
                    setTimeout(() => {
                        this.submit();
                    }, 2000);
                });
            }
            
            // Incident form submission
            const incidentForm = document.getElementById('masterIncidentForm');
            if (incidentForm) {
                incidentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    alert('Incident report submitted successfully! Reference: ' + incidentReferenceNumber);
                    
                    // Submit form
                    this.submit();
                });
            }
        }
    </script>
</body>
</html>