// =====================================
// CQR365 Dashboard Integration Code
// Add this to your GitHub forms to make them reactive
// =====================================

// CORE FUNCTION - Add this to ALL your forms
function updateDashboard(sectionId, data) {
    let dashboardData = JSON.parse(localStorage.getItem('cqr365-dashboard-data') || '{}');
    dashboardData[sectionId] = data;
    localStorage.setItem('cqr365-dashboard-data', JSON.stringify(dashboardData));
    
    // Show success message
    showUpdateMessage('Dashboard updated successfully!');
}

function showUpdateMessage(message) {
    // Create a simple notification
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; 
        background: #28A745; color: white; 
        padding: 15px 20px; border-radius: 8px; 
        z-index: 10000; font-weight: 600;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// =====================================
// EXAMPLE 1: PROPERTY PASSPORT FORM
// =====================================

// Add this to your property-passport.html form
function submitPropertyForm(event) {
    event.preventDefault();
    
    // Get form data (example)
    const totalProperties = document.getElementById('total-properties').value;
    const occupancyRate = document.getElementById('occupancy-rate').value;
    const revenue = document.getElementById('revenue').value;
    const maintenanceRequests = document.getElementById('maintenance-requests').value;
    
    // Update dashboard
    updateDashboard('property-passports', {
        card1: { 
            value: totalProperties, 
            trend: '+12% from last month', 
            status: 'positive' 
        },
        card2: { 
            value: occupancyRate + '%', 
            trend: '+2.1% from last month', 
            status: 'positive' 
        },
        card3: { 
            value: '£' + revenue, 
            trend: '+8.5% from last month', 
            status: 'positive' 
        },
        card4: { 
            value: maintenanceRequests, 
            trend: maintenanceRequests > 20 ? 'Above average' : 'Normal levels', 
            status: maintenanceRequests > 20 ? 'negative' : 'positive' 
        }
    });
    
    alert('Property data submitted and dashboard updated!');
}

// =====================================
// EXAMPLE 2: INCIDENTS & ACTIONS FORM
// =====================================

// Add this to your incidents-actions.html form
function submitIncidentForm(event) {
    event.preventDefault();
    
    const openIncidents = document.getElementById('open-incidents').value;
    const pendingActions = document.getElementById('pending-actions').value;
    const avgResolution = document.getElementById('avg-resolution').value;
    const criticalIncidents = document.getElementById('critical-incidents').value;
    
    updateDashboard('incidents-actions', {
        card1: { 
            value: openIncidents, 
            trend: 'Updated from form', 
            status: openIncidents > 10 ? 'negative' : 'positive' 
        },
        card2: { 
            value: pendingActions, 
            trend: 'Requires attention', 
            status: 'pending' 
        },
        card3: { 
            value: avgResolution + ' days', 
            trend: 'Resolution time', 
            status: 'positive' 
        },
        card4: { 
            value: criticalIncidents, 
            trend: criticalIncidents > 0 ? 'Requires attention' : 'All clear', 
            status: criticalIncidents > 0 ? 'negative' : 'positive' 
        }
    });
    
    alert('Incident data submitted and dashboard updated!');
}

// =====================================
// EXAMPLE 3: HOT TUBS FORM
// =====================================

// Add this to your hot-tubs.html form
function submitHotTubForm(event) {
    event.preventDefault();
    
    const activeHotTubs = document.getElementById('active-hottubs').value;
    const waterQuality = document.getElementById('water-quality').value;
    const maintenanceDue = document.getElementById('maintenance-due').value;
    const temperatureRange = document.getElementById('temperature-range').value;
    
    updateDashboard('hot-tubs', {
        card1: { 
            value: activeHotTubs, 
            trend: 'All operational', 
            status: 'positive' 
        },
        card2: { 
            value: waterQuality + '%', 
            trend: waterQuality > 95 ? 'Excellent rating' : 'Good rating', 
            status: waterQuality > 95 ? 'positive' : 'pending' 
        },
        card3: { 
            value: maintenanceDue, 
            trend: 'Within 7 days', 
            status: 'pending' 
        },
        card4: { 
            value: temperatureRange + '°C', 
            trend: 'Optimal range', 
            status: 'positive' 
        }
    });
    
    alert('Hot tub data submitted and dashboard updated!');
}

// =====================================
// EXAMPLE 4: ACCOMMODATION FORM
// =====================================

// Add this to your accommodation.html form
function submitAccommodationForm(event) {
    event.preventDefault();
    
    const availableRooms = document.getElementById('available-rooms').value;
    const checkinsToday = document.getElementById('checkins-today').value;
    const guestSatisfaction = document.getElementById('guest-satisfaction').value;
    const housekeepingQueue = document.getElementById('housekeeping-queue').value;
    
    updateDashboard('accommodation', {
        card1: { 
            value: availableRooms, 
            trend: 'Rooms available', 
            status: 'positive' 
        },
        card2: { 
            value: checkinsToday, 
            trend: 'On schedule', 
            status: 'positive' 
        },
        card3: { 
            value: guestSatisfaction + '/5', 
            trend: '+0.2 this month', 
            status: 'positive' 
        },
        card4: { 
            value: housekeepingQueue, 
            trend: 'Rooms pending', 
            status: 'pending' 
        }
    });
    
    alert('Accommodation data submitted and dashboard updated!');
}

// =====================================
// EXAMPLE 5: SIMPLE COUNTER UPDATE
// =====================================

// For simple counter-type updates (like incident reporting)
function incrementCounter(sectionId, cardIndex, incrementBy = 1) {
    let dashboardData = JSON.parse(localStorage.getItem('cqr365-dashboard-data') || '{}');
    
    if (!dashboardData[sectionId]) {
        dashboardData[sectionId] = {};
    }
    
    const cardKey = `card${cardIndex}`;
    const currentValue = parseInt(dashboardData[sectionId][cardKey]?.value || 0);
    const newValue = currentValue + incrementBy;
    
    dashboardData[sectionId][cardKey] = {
        value: newValue.toString(),
        trend: `${incrementBy > 0 ? '+' : ''}${incrementBy} update`,
        status: newValue > 10 ? 'negative' : 'positive'
    };
    
    localStorage.setItem('cqr365-dashboard-data', JSON.stringify(dashboardData));
    showUpdateMessage(`Counter updated! New value: ${newValue}`);
}

// =====================================
// EXAMPLE 6: REAL-TIME UPDATES
// =====================================

// For continuous monitoring (like water quality)
function updateRealTimeData(sectionId, readings) {
    const data = {};
    
    readings.forEach((reading, index) => {
        data[`card${index + 1}`] = {
            value: reading.value,
            trend: reading.trend || 'Live update',
            status: reading.status || 'positive'
        };
    });
    
    updateDashboard(sectionId, data);
}

// Example usage for water quality readings:
function submitWaterQualityReading() {
    const readings = [
        { value: '97.8%', trend: 'Excellent rating', status: 'positive' },
        { value: '24,750 L', trend: '-12% vs yesterday', status: 'positive' },
        { value: '4.2 bar', trend: 'Optimal range', status: 'positive' },
        { value: '0.3%', trend: 'Below threshold', status: 'positive' }
    ];
    
    updateRealTimeData('all-water', readings);
}

// =====================================
// EXAMPLE HTML FORM TEMPLATE
// =====================================

/*
Add this HTML structure to your GitHub forms:

<form onsubmit="submitPropertyForm(event)">
    <h2>Property Passport Data Entry</h2>
    
    <label for="total-properties">Total Properties:</label>
    <input type="number" id="total-properties" required>
    
    <label for="occupancy-rate">Occupancy Rate (%):</label>
    <input type="number" id="occupancy-rate" min="0" max="100" required>
    
    <label for="revenue">Revenue (without £ or commas):</label>
    <input type="number" id="revenue" required>
    
    <label for="maintenance-requests">Maintenance Requests:</label>
    <input type="number" id="maintenance-requests" required>
    
    <button type="submit">Update Dashboard</button>
</form>

<script>
    // Add the appropriate submit function here
    function submitPropertyForm(event) {
        // Copy the example code from above
    }
</script>
*/

// =====================================
// COMPLETE FORM TEMPLATE EXAMPLE
// =====================================

/*
Here's a complete working form template you can use:

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hot Tub Management - CQR365</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #CC5500; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #B8460C; }
    </style>
</head>
<body>
    <h1>Hot Tub Management Form</h1>
    
    <form onsubmit="submitHotTubForm(event)">
        <div class="form-group">
            <label for="active-hottubs">Number of Active Hot Tubs:</label>
            <input type="number" id="active-hottubs" required>
        </div>
        
        <div class="form-group">
            <label for="water-quality">Water Quality Score (%):</label>
            <input type="number" id="water-quality" min="0" max="100" required>
        </div>
        
        <div class="form-group">
            <label for="maintenance-due">Hot Tubs Due for Maintenance:</label>
            <input type="number" id="maintenance-due" min="0" required>
        </div>
        
        <div class="form-group">
            <label for="temperature-range">Average Temperature:</label>
            <input type="number" id="temperature-range" min="30" max="45" required>
        </div>
        
        <button type="submit">Update Hot Tub Dashboard</button>
    </form>

    <script>
        function updateDashboard(sectionId, data) {
            let dashboardData = JSON.parse(localStorage.getItem('cqr365-dashboard-data') || '{}');
            dashboardData[sectionId] = data;
            localStorage.setItem('cqr365-dashboard-data', JSON.stringify(dashboardData));
            showUpdateMessage('Dashboard updated successfully!');
        }

        function showUpdateMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: #28A745; color: white; 
                padding: 15px 20px; border-radius: 8px; 
                z-index: 10000; font-weight: 600;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function submitHotTubForm(event) {
            event.preventDefault();
            
            const activeHotTubs = document.getElementById('active-hottubs').value;
            const waterQuality = document.getElementById('water-quality').value;
            const maintenanceDue = document.getElementById('maintenance-due').value;
            const temperatureRange = document.getElementById('temperature-range').value;
            
            updateDashboard('hot-tubs', {
                card1: { value: activeHotTubs, trend: 'All operational', status: 'positive' },
                card2: { value: waterQuality + '%', trend: 'Excellent rating', status: 'positive' },
                card3: { value: maintenanceDue, trend: 'Within 7 days', status: 'pending' },
                card4: { value: temperatureRange + '°C', trend: 'Optimal range', status: 'positive' }
            });
            
            alert('Hot tub data submitted and dashboard updated!');
            
            // Optional: redirect back to main dashboard
            // window.open('https://CQR365.github.io/customer-contact-forms/', '_blank');
        }
    </script>
</body>
</html>
*/

// =====================================
// USAGE INSTRUCTIONS
// =====================================

/*
IMPLEMENTATION STEPS:

1. Copy the core functions (updateDashboard, showUpdateMessage) into each of your forms
2. Create specific submit functions for each form type
3. Add form HTML with proper IDs matching your JavaScript
4. Test by submitting forms and checking if dashboard updates

SECTION IDs TO USE:
- 'property-passports'
- 'incidents-actions'  
- 'hot-tubs'
- 'accommodation'
- 'grounds-maintenance'
- 'food-beverage'
- 'vehicles'
- 'library'
- 'all-water'
- 'team'
- 'risk-assessment'
- 'dashboard'
- 'reports'

CARD DATA STRUCTURE:
Each section expects data like:
{
    card1: { value: "25", trend: "+3 this month", status: "positive" },
    card2: { value: "94%", trend: "Above target", status: "positive" },
    card3: { value: "£2.4M", trend: "+8.5% from last month", status: "positive" },
    card4: { value: "18", trend: "+3 from last week", status: "negative" }
}

STATUS OPTIONS: 'positive', 'negative', 'pending'
*/
