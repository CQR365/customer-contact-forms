<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CQR365 - SafePark.PRO Safety & Compliance System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-orange: #CC5500;
            --dark-orange: #B8460C;
            --light-orange: #E6672E;
            --black: #000000;
            --white: #FFFFFF;
            --light-gray: #F8F9FA;
            --medium-gray: #6C757D;
            --dark-gray: #343A40;
            --border-color: #DEE2E6;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 40px rgba(0,0,0,0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--light-gray) 0%, #E8ECEF 100%);
            color: var(--dark-gray);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, var(--black) 0%, var(--dark-gray) 100%);
            color: var(--white);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-heavy);
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 2px solid var(--primary-orange);
            background: var(--black);
        }

        .sidebar-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary-orange);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .sidebar-header .brand-line {
            font-size: 1.1rem;
            color: var(--white);
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: 0.3px;
        }

        .sidebar-header p {
            font-size: 0.8rem;
            color: var(--medium-gray);
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .sidebar-nav {
            padding: 20px 15px;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-section-title {
            font-size: 0.75rem;
            color: var(--medium-gray);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding: 0 15px;
        }

        .nav-btn, .custom-nav-btn {
            display: flex;
            align-items: center;
            width: 100%;
            background: transparent;
            border: none;
            color: #B8C5D6;
            padding: 15px 20px;
            margin-bottom: 5px;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }

        .nav-btn:before, .custom-nav-btn:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-orange);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .nav-btn:hover, .custom-nav-btn:hover {
            background: rgba(204, 85, 0, 0.1);
            color: var(--white);
            transform: translateX(5px);
        }

        .nav-btn:hover:before, .custom-nav-btn:hover:before {
            transform: scaleY(1);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--dark-orange) 100%);
            color: var(--white);
            font-weight: 600;
            box-shadow: var(--shadow-medium);
        }

        .nav-btn.active:before {
            transform: scaleY(1);
        }

        .custom-nav-btn .external-icon, .nav-btn .external-icon {
            margin-left: auto;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        /* Custom Links Management */
        .custom-links-section {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 20px;
            margin-top: 20px;
        }

        .add-link-btn {
            width: 100%;
            background: rgba(204, 85, 0, 0.2);
            border: 2px dashed var(--primary-orange);
            color: var(--primary-orange);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .add-link-btn:hover {
            background: rgba(204, 85, 0, 0.3);
            border-style: solid;
        }

        /* Main Content Area */
        .main-content {
            margin-left: 320px;
            flex: 1;
            padding: 30px;
            background: var(--light-gray);
            min-height: 100vh;
        }

        .content-section {
            background: var(--white);
            border-radius: 15px;
            padding: 40px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            display: none;
            min-height: calc(100vh - 100px);
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-stats {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }

        .header-stats .stat-item {
            text-align: center;
            min-width: 80px;
        }

        .header-stats .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-orange);
            display: block;
            margin-bottom: 4px;
        }

        .header-stats .stat-label {
            font-size: 0.8rem;
            color: var(--medium-gray);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .section-title {
            color: var(--black);
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .section-subtitle {
            color: var(--medium-gray);
            font-size: 1rem;
            margin-top: 5px;
            font-weight: 400;
        }

        /* Welcome Page Styles */
        .welcome-container {
            padding: 0;
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
            min-height: calc(100vh - 60px);
            border-radius: 15px;
            overflow: hidden;
        }

        .welcome-hero {
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
            padding: 80px 60px;
            position: relative;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .welcome-content {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .welcome-title {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 20px;
            letter-spacing: -1px;
            line-height: 1.1;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: #B8C5D6;
            margin-bottom: 40px;
            font-weight: 400;
            line-height: 1.4;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            background: var(--primary-orange);
            color: var(--white);
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
            margin-right: 15px;
        }

        .cta-button:hover {
            background: var(--dark-orange);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .cta-button.secondary {
            background: transparent;
            color: #B8C5D6;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .cta-button.secondary:hover {
            border-color: var(--primary-orange);
            color: var(--primary-orange);
            background: rgba(204, 85, 0, 0.1);
        }

        /* Quick Stats Section */
        .quick-stats {
            padding: 60px;
            background: linear-gradient(135deg, #2A2D35 0%, var(--dark-gray) 100%);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stats-grid {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
        }

        .stat-item {
            text-align: center;
            position: relative;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-orange);
            display: block;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            color: var(--medium-gray);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-description {
            font-size: 0.85rem;
            color: #B8C5D6;
            margin-top: 4px;
            opacity: 0.8;
        }

        /* Features Section */
        .features-section {
            padding: 80px 60px;
            background: linear-gradient(135deg, var(--dark-gray) 0%, #2A2D35 100%);
        }

        .features-header {
            text-align: center;
            margin-bottom: 60px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .features-title {
            font-size: 2.8rem;
            color: var(--white);
            margin-bottom: 16px;
            font-weight: 700;
        }

        .features-subtitle {
            font-size: 1.2rem;
            color: #B8C5D6;
            line-height: 1.6;
        }

        .features-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, var(--black) 0%, #1A1D23 100%);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-orange);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-heavy);
            border-color: rgba(204, 85, 0, 0.3);
        }

        .feature-card:hover::before {
            transform: scaleX(1);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-orange), var(--dark-orange));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--white);
            margin-bottom: 20px;
        }

        .feature-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 12px;
        }

        .feature-description {
            font-size: 0.95rem;
            color: #B8C5D6;
            line-height: 1.5;
        }

        /* System Status Section */
        .system-status {
            padding: 60px;
            background: linear-gradient(135deg, #1A1D23 0%, var(--black) 100%);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .status-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .status-title {
            font-size: 2rem;
            color: var(--white);
            margin-bottom: 12px;
            font-weight: 600;
        }

        .status-indicators {
            max-width: 800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 25px;
        }

        .status-item {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            margin: 0 auto 12px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .status-name {
            font-size: 0.9rem;
            color: #B8C5D6;
            font-weight: 500;
        }

        .status-value {
            font-size: 0.8rem;
            color: var(--success);
            margin-top: 4px;
            font-weight: 600;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-orange);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover {
            background: var(--dark-orange);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn:hover:before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--dark-gray);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--light-gray);
            border-color: var(--primary-orange);
            color: var(--primary-orange);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #C82333;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-icon {
            margin-right: 8px;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .dashboard-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-orange), var(--dark-orange));
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .card-header h3 {
            color: var(--medium-gray);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .card-value {
            color: var(--black);
            font-size: 2.2rem;
            font-weight: 700;
            line-height: 1;
            margin: 10px 0;
        }

        .card-trend {
            font-size: 0.85rem;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .card-trend.positive {
            color: var(--success);
            background: rgba(40, 167, 69, 0.1);
        }

        .card-trend.negative {
            color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
        }

        .card-trend.pending {
            color: var(--warning);
            background: rgba(255, 193, 7, 0.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--white);
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            color: var(--black);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .close-btn {
            background: var(--light-gray);
            border: none;
            color: var(--medium-gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--primary-orange);
            color: var(--white);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-gray);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--white);
            color: var(--dark-gray);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(204, 85, 0, 0.1);
        }

        /* Mobile Navigation */
        .mobile-nav-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2001;
            background: var(--black);
            color: var(--primary-orange);
            border: 2px solid var(--primary-orange);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: var(--shadow-medium);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Enhanced Form Styles for Integration */
        .integrated-form {
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: var(--shadow-heavy);
            color: var(--white);
        }

        .integrated-form .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .integrated-form .form-group-full {
            grid-column: 1 / -1;
        }

        .integrated-form .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .integrated-form .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            color: var(--white);
        }

        .integrated-form .form-input:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(204, 85, 0, 0.3);
            background: rgba(255,255,255,0.15);
        }

        .integrated-form .form-input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .integrated-form textarea.form-input {
            min-height: 120px;
            resize: vertical;
        }

        .integrated-form select.form-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .integrated-form select.form-input option {
            background: var(--dark-gray);
            color: var(--white);
            padding: 10px;
            border: none;
        }

        .integrated-form .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .integrated-form .checkbox-group:hover {
            background: rgba(204, 85, 0, 0.1);
            border-color: rgba(204, 85, 0, 0.3);
        }

        .integrated-form .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            accent-color: var(--primary-orange);
        }

        .integrated-form .checkbox-group label {
            margin: 0;
            color: var(--white);
            font-weight: 500;
            cursor: pointer;
            flex: 1;
        }

        .integrated-form .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }

        .integrated-form .radio-group label {
            display: flex;
            align-items: center;
            font-weight: 500;
            cursor: pointer;
            color: var(--white);
        }

        .integrated-form .radio-group input[type="radio"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            accent-color: var(--primary-orange);
        }

        .integrated-form .form-section {
            background: linear-gradient(135deg, #2A2D35 0%, var(--dark-gray) 100%);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid var(--primary-orange);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .integrated-form .form-section h3 {
            color: var(--primary-orange);
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .integrated-form .form-section h4 {
            color: var(--primary-orange);
            font-size: 1.1rem;
            margin: 20px 0 15px 0;
            font-weight: 600;
        }

        .integrated-form .btn-submit {
            background: linear-gradient(135deg, var(--primary-orange), var(--dark-orange));
            color: var(--white);
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-medium);
            width: 100%;
            margin-top: 20px;
        }

        .integrated-form .btn-submit:hover {
            background: linear-gradient(135deg, var(--dark-orange), var(--primary-orange));
            transform: translateY(-2px);
            box-shadow: var(--shadow-heavy);
        }

        .integrated-form .required-field {
            color: var(--primary-orange);
        }

        .integrated-form small {
            color: #B8C5D6;
            font-size: 0.8rem;
            display: block;
            margin-top: 4px;
        }

        /* Success Message Styles */
        .success-message {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--success);
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Water quality specific styles */
        .water-quality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .quality-item {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 140px;
        }

        .quality-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
            background: rgba(204, 85, 0, 0.05);
            border-color: rgba(204, 85, 0, 0.3);
        }

        .quality-item .form-label {
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--white);
            font-weight: 600;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .quality-item .form-input {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            color: var(--white);
            border: 2px solid rgba(255,255,255,0.2);
            flex: 1;
            min-height: 50px;
            display: flex;
            align-items: center;
        }

        .quality-item .form-input:focus {
            border-color: var(--primary-orange);
            background: rgba(255,255,255,0.15);
        }

        .quality-range {
            font-size: 0.85rem;
            color: #B8C5D6;
            font-weight: 600;
            margin-top: 8px;
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .fade-up {
            animation: fadeUp 0.8s ease-out;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            .mobile-nav-toggle {
                display: block;
            }

            .content-section {
                padding: 20px;
                border-radius: 10px;
            }

            .section-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .section-title {
                font-size: 2rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 30px;
            }

            .modal-content {
                margin: 10px;
                width: calc(100% - 20px);
                padding: 25px;
                max-height: 85vh;
            }

            .welcome-hero, .features-section {
                padding: 40px 20px;
            }

            .welcome-title {
                font-size: 2.5rem;
            }

            .welcome-subtitle {
                font-size: 1rem;
            }

            .features-title {
                font-size: 2.2rem;
            }

            .quick-stats, .system-status {
                padding: 40px 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 30px;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .cta-button {
                display: block;
                text-align: center;
                margin-bottom: 15px;
                margin-right: 0;
            }

            .integrated-form .form-row {
                grid-template-columns: 1fr;
            }

            .water-quality-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .welcome-title {
                font-size: 2rem;
            }
            
            .features-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="mobile-nav-toggle" onclick="toggleMobileNav()">☰</button>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeMobileNav()"></div>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>CQR 365</h1>
                <div class="brand-line">SafePark.PRO</div>
                <p>Safety & Compliance System</p>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <button class="nav-btn active" onclick="showSection('welcome')">
                        Welcome Home
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Core Modules</div>
                    <button class="nav-btn" onclick="showSection('property-passports')">
                        Property Passports
                    </button>
                    <button class="nav-btn" onclick="showSection('incidents-actions')">
                        Incidents & Actions
                    </button>
                    <button class="nav-btn" onclick="showSection('hot-tubs')">
                        Hot Tubs
                    </button>
                    <button class="nav-btn" onclick="showSection('accommodation')">
                        Accommodation
                    </button>
                    <button class="nav-btn" onclick="showSection('grounds-maintenance')">
                        Grounds & Maintenance
                    </button>
                    <button class="nav-btn" onclick="showSection('food-beverage')">
                        Food & Beverage
                    </button>
                    <button class="nav-btn" onclick="showSection('vehicles')">
                        Vehicles
                    </button>
                    <button class="nav-btn" onclick="showSection('library')">
                        Library
                    </button>
                    <button class="nav-btn" onclick="showSection('all-water')">
                        All Water
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    <button class="nav-btn" onclick="showSection('management')">
                        Management
                    </button>
                    <button class="nav-btn" onclick="showSection('team')">
                        Team Management
                    </button>
                    <button class="nav-btn" onclick="showSection('training')">
                        Training
                    </button>
                    <button class="nav-btn" onclick="showSection('contractors')">
                        Contractors
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Safety & Compliance</div>
                    <button class="nav-btn" onclick="showSection('ai-near-miss')">
                        AI Near Miss System
                    </button>
                    <button class="nav-btn" onclick="showSection('risk-assessment')">
                        Risk Assessment
                    </button>
                    <button class="nav-btn" onclick="showSection('business-continuity')">
                        Risk & Business Continuity
                    </button>
                    <button class="nav-btn" onclick="showSection('coshh')">
                        COSHH
                    </button>
                    <button class="nav-btn" onclick="showSection('electric')">
                        Electric
                    </button>
                    <button class="nav-btn" onclick="showSection('gas')">
                        Gas
                    </button>
                    <button class="nav-btn" onclick="showSection('fire')">
                        Fire
                    </button>
                    <button class="nav-btn" onclick="showSection('play-parks')">
                        Play Parks
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Analytics</div>
                    <button class="nav-btn" onclick="showSection('dashboard')">
                        Executive Dashboard
                    </button>
                    <a href="https://CQR365.github.io/customer-contact-forms/reports.html" target="_blank" class="nav-btn" onclick="handleFormClick()">
                        Reports
                        <span class="external-icon">↗</span>
                    </a>
                </div>

                <!-- Custom Links Section -->
                <div class="nav-section custom-links-section">
                    <div class="nav-section-title">Custom Links</div>
                    <button class="add-link-btn" onclick="openAddLinkModal()">
                        + Add Custom Link
                    </button>
                    <div id="customLinksContainer"></div>
                </div>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Welcome Section -->
            <div id="welcome" class="content-section active">
                <div class="welcome-container">
                    <!-- Hero Section -->
                    <section class="welcome-hero">
                        <div class="welcome-content fade-up">
                            <h1 class="welcome-title">SafePark.PRO</h1>
                            <p class="welcome-subtitle">
                                Powered by CQR365 - Comprehensive safety management, compliance tracking, 
                                and operational excellence for holiday parks and leisure facilities.
                            </p>
                            <div style="margin-top: 40px;">
                                <a href="#" class="cta-button" onclick="showSection('dashboard')">Access Dashboard</a>
                                <a href="#" class="cta-button secondary" onclick="scrollToSystemStatus()">System Status</a>
                            </div>
                        </div>
                    </section>

                    <!-- Quick Stats -->
                    <section class="quick-stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-number">99.7%</span>
                                <div class="stat-label">System Uptime</div>
                                <div class="stat-description">Last 30 days</div>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">247</span>
                                <div class="stat-label">Properties</div>
                                <div class="stat-description">Under management</div>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">94.2%</span>
                                <div class="stat-label">Compliance</div>
                                <div class="stat-description">Safety standards</div>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">127</span>
                                <div class="stat-label">Team Members</div>
                                <div class="stat-description">Active users</div>
                            </div>
                        </div>
                    </section>

                    <!-- Features Section -->
                    <section class="features-section">
                        <div class="features-header">
                            <h2 class="features-title">Integrated Management Solutions</h2>
                            <p class="features-subtitle">
                                Everything you need to manage properties safely and efficiently, 
                                all in one comprehensive platform.
                            </p>
                        </div>
                        <div class="features-grid">
                            <a href="#" class="feature-card" onclick="showSection('property-passports')">
                                <h3 class="feature-title">Property Management</h3>
                                <p class="feature-description">
                                    Complete property documentation, maintenance tracking, and occupancy management.
                                </p>
                            </a>
                            <a href="#" class="feature-card" onclick="showSection('risk-assessment')">
                                <h3 class="feature-title">Safety & Compliance</h3>
                                <p class="feature-description">
                                    Incident reporting, risk assessment, and regulatory compliance monitoring.
                                </p>
                            </a>
                            <a href="#" class="feature-card" onclick="showSection('dashboard')">
                                <h3 class="feature-title">Analytics & Reporting</h3>
                                <p class="feature-description">
                                    Real-time dashboards, performance metrics, and comprehensive reporting tools.
                                </p>
                            </a>
                            <a href="#" class="feature-card" onclick="showSection('team')">
                                <h3 class="feature-title">Team Management</h3>
                                <p class="feature-description">
                                    Staff scheduling, training compliance, and performance tracking.
                                </p>
                            </a>
                            <a href="#" class="feature-card" onclick="showSection('hot-tubs')">
                                <h3 class="feature-title">Hot Tub Systems</h3>
                                <p class="feature-description">
                                    Complete hot tub maintenance, water quality monitoring, and safety compliance.
                                </p>
                            </a>
                            <a href="#" class="feature-card">
                                <h3 class="feature-title">Mobile Access</h3>
                                <p class="feature-description">
                                    Full system access from any device, anywhere, anytime.
                                </p>
                            </a>
                        </div>
                    </section>

                    <!-- System Status -->
                    <section class="system-status" id="system-status">
                        <div class="status-header">
                            <h2 class="status-title">System Status</h2>
                        </div>
                        <div class="status-indicators">
                            <div class="status-item">
                                <div class="status-dot"></div>
                                <div class="status-name">Core Systems</div>
                                <div class="status-value">Operational</div>
                            </div>
                            <div class="status-item">
                                <div class="status-dot"></div>
                                <div class="status-name">Database</div>
                                <div class="status-value">Online</div>
                            </div>
                            <div class="status-item">
                                <div class="status-dot"></div>
                                <div class="status-name">API Services</div>
                                <div class="status-value">Active</div>
                            </div>
                            <div class="status-item">
                                <div class="status-dot"></div>
                                <div class="status-name">Reporting</div>
                                <div class="status-value">Available</div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Executive Dashboard Section -->
            <div id="dashboard" class="content-section fade-in">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Executive Dashboard</h2>
                        <p class="section-subtitle">Comprehensive business overview</p>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Total Portfolio Value</h3>
                            <div class="card-value">£847M</div>
                        </div>
                        <div class="card-trend positive">+3.2% this quarter</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Net Operating Income</h3>
                            <div class="card-value">£24.7M</div>
                        </div>
                        <div class="card-trend positive">+5.8% YoY</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Occupancy Rate</h3>
                            <div class="card-value">94.2%</div>
                        </div>
                        <div class="card-trend positive">Above target</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Customer Satisfaction</h3>
                            <div class="card-value">87%</div>
                        </div>
                        <div class="card-trend positive">+2% this month</div>
                    </div>
                </div>
            </div>

            <!-- Hot Tubs Section - FULLY INTEGRATED -->
            <div id="hot-tubs" class="content-section fade-in">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Hot Tub Management System</h2>
                        <p class="section-subtitle">Real-time monitoring and maintenance compliance</p>
                    </div>
                    <div class="header-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="active-hottubs">5</div>
                            <div class="stat-label">Active Units</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="water-quality-status">96%</div>
                            <div class="stat-label">Quality Score</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="maintenance-due">2</div>
                            <div class="stat-label">Due Today</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="last-inspection">2 hrs</div>
                            <div class="stat-label">Last Check</div>
                        </div>
                    </div>
                </div>

                <div class="form-container">
                    <form class="integrated-form" action="https://formspree.io/f/mqayzvrv" method="POST" onsubmit="handleFormSubmit(event)">
                        
                        <!-- SUCCESS MESSAGE -->
                        <div class="success-message" id="success-message-hottub">
                            Hot Tub Maintenance Report submitted successfully! Thank you.
                        </div>

                        <!-- Hidden fields for better Formspree integration -->
                        <input type="hidden" name="_subject" value="Hot Tub Maintenance Report Submission">
                        <input type="hidden" name="_next" value="javascript:void(0);">
                        <input type="hidden" name="_format" value="plain">
                        
                        <!-- BUSINESS INFORMATION SECTION -->
                        <div class="form-section">
                            <h3>Site & Inspection Details</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Property/Site Name <span class="required-field">*</span></label>
                                    <select name="business_name" class="form-input" required id="business-select" onchange="updateSiteInfo()">
                                        <option value="">Select Site</option>
                                        <option value="Sunshine Holiday Park">Sunshine Holiday Park</option>
                                        <option value="Riverside Resort">Riverside Resort</option>
                                        <option value="Lakeside Lodge">Lakeside Lodge</option>
                                        <option value="Coastal Retreat">Coastal Retreat</option>
                                        <option value="custom">Other Site</option>
                                    </select>
                                    <input type="text" name="custom_business_name" class="form-input" id="custom-business" placeholder="Enter custom site name" style="display: none; margin-top: 10px;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Inspection Date</label>
                                    <input type="date" name="maintenance_date" class="form-input" required id="maintenance-date">
                                    <small id="date-info">Auto-set to today</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Inspector/Technician <span class="required-field">*</span></label>
                                    <select name="technician_name" class="form-input" required id="technician-select" onchange="updateTechnicianInfo()">
                                        <option value="">Select Inspector</option>
                                    </select>
                                    <input type="text" name="custom_technician_name" class="form-input" id="custom-technician" placeholder="Enter inspector name" style="display: none; margin-top: 10px;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Professional Certification</label>
                                    <input type="text" name="licence_number" class="form-input" id="licence-number" placeholder="License/Certificate Number">
                                    <small id="cert-info">Auto-filled for selected inspector</small>
                                </div>
                            </div>

                            <!-- Technician Management Center -->
                            <div style="background: rgba(255,255,255,0.05); border: 2px solid var(--primary-orange); border-radius: 12px; padding: 25px; margin-top: 20px;">
                                <h4 style="color: var(--primary-orange); margin-bottom: 20px;">Inspector/Technician Management Center</h4>
                                
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0;">
                                    <button type="button" class="btn" onclick="showAddTechnicianModal()">
                                        Add New Inspector
                                    </button>
                                    <button type="button" class="btn" onclick="showEditTechnicianModal()">
                                        Edit Selected
                                    </button>
                                    <button type="button" class="btn" onclick="deleteSelectedTechnician()">
                                        Delete Selected
                                    </button>
                                    <button type="button" class="btn" onclick="showTechnicianListModal()">
                                        View All Inspectors
                                    </button>
                                </div>

                                <div id="selected-technician-info" style="display: none; padding: 20px; background: rgba(255,255,255,0.1); border: 2px solid var(--primary-orange); border-radius: 12px; margin-top: 20px;">
                                    <h4 style="color: var(--primary-orange); margin-bottom: 15px;">Currently Selected Inspector</h4>
                                    <div id="selected-technician-details"></div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Inspection Type</label>
                                    <select name="inspection_type" class="form-input" onchange="updateInspectionSchedule()">
                                        <option value="routine">Routine Daily Check</option>
                                        <option value="weekly">Weekly Deep Check</option>
                                        <option value="monthly">Monthly Full Service</option>
                                        <option value="incident">Incident Response</option>
                                        <option value="complaint">Guest Complaint Follow-up</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Next Inspection Due</label>
                                    <input type="date" name="next_inspection_date" class="form-input" id="next-inspection">
                                    <small id="next-inspection-info">Auto-calculated based on type</small>
                                </div>
                            </div>

                            <!-- Property Management Center -->
                            <div style="background: rgba(255,255,255,0.05); border: 2px solid var(--primary-orange); border-radius: 12px; padding: 25px; margin-top: 20px;">
                                <h4 style="color: var(--primary-orange); margin-bottom: 20px;">Property Management Center</h4>
                                
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0;">
                                    <button type="button" class="btn" onclick="showAddPropertyModal()">
                                        Add New Property
                                    </button>
                                    <button type="button" class="btn" onclick="showEditPropertyModal()">
                                        Edit Selected
                                    </button>
                                    <button type="button" class="btn" onclick="deleteSelectedProperty()">
                                        Delete Selected
                                    </button>
                                    <button type="button" class="btn" onclick="showPropertyListModal()">
                                        View All Properties
                                    </button>
                                </div>

                                <div id="selected-property-info" style="display: none; padding: 20px; background: rgba(255,255,255,0.1); border: 2px solid var(--primary-orange); border-radius: 12px; margin-top: 20px;">
                                    <h4 style="color: var(--primary-orange); margin-bottom: 15px;">Currently Selected Property</h4>
                                    <div id="selected-property-details"></div>
                                </div>
                            </div>
                        </div>

                        <!-- HOT TUB SELECTION SECTION -->
                        <div class="form-section">
                            <h3>Hot Tub Information & Management</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Hot Tub ID/Location <span class="required-field">*</span></label>
                                    <select name="hottub_id" class="form-input" required id="hottub-id" onchange="updateHotTubSpecs()">
                                        <option value="">Select Hot Tub</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Capacity (Litres)</label>
                                    <input type="number" name="hottub_capacity" class="form-input" id="hottub-capacity" placeholder="Auto-filled when selected" readonly>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Last Professional Service</label>
                                    <input type="date" name="last_service_date" class="form-input" id="last-service">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Maintenance Type <span class="required-field">*</span></label>
                                    <select name="maintenance_type" class="form-input" required id="maintenance-type" onchange="showMaintenanceTasks()">
                                        <option value="">Select Type</option>
                                        <option value="daily">Daily Check</option>
                                        <option value="changeover">Changeover Maintenance</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Hot Tub Management Center -->
                            <div style="background: rgba(255,255,255,0.05); border: 2px solid var(--primary-orange); border-radius: 12px; padding: 25px; margin-top: 20px;">
                                <h4 style="color: var(--primary-orange); margin-bottom: 20px;">Hot Tub Management Center</h4>
                                
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0;">
                                    <button type="button" class="btn" onclick="showAddHotTubModal()">
                                        Add New Hot Tub
                                    </button>
                                    <button type="button" class="btn" onclick="showEditHotTubModal()">
                                        Edit Selected
                                    </button>
                                    <button type="button" class="btn" onclick="deleteSelectedHotTub()">
                                        Delete Selected
                                    </button>
                                    <button type="button" class="btn" onclick="showHotTubListModal()">
                                        View All Hot Tubs
                                    </button>
                                </div>

                                <div id="selected-hottub-info" style="display: none; padding: 20px; background: rgba(255,255,255,0.1); border: 2px solid var(--primary-orange); border-radius: 12px; margin-top: 20px;">
                                    <h4 style="color: var(--primary-orange); margin-bottom: 15px;">Currently Selected Hot Tub</h4>
                                    <div id="selected-hottub-details"></div>
                                </div>
                            </div>

                            <!-- Maintenance Tasks Section -->
                            <div style="margin-top: 30px; padding: 25px; background: rgba(255,255,255,0.05); border: 3px solid var(--primary-orange); border-radius: 12px;">
                                <h4 style="color: var(--primary-orange); margin-bottom: 20px;">📋 Maintenance Type & Tasks</h4>

                                <div id="daily-tasks" style="display: none;">
                                    <h4 style="color: var(--primary-orange); margin-bottom: 15px;">Daily Check Tasks</h4>
                                    
                                    <div style="background: linear-gradient(135deg, var(--primary-orange), var(--dark-orange)); padding: 20px; border-radius: 10px; margin: 20px 0; color: var(--white);">
                                        <h4>Quick Complete - All Hot Tubs</h4>
                                        <button type="button" class="btn" onclick="completeAllDailyTasks()" style="background: var(--success); margin-top: 10px;">
                                            ✅ COMPLETE ALL HOT TUBS - OPTIMAL VALUES
                                        </button>
                                        <p style="margin-top: 10px; font-size: 0.9rem;">
                                            This will populate all hot tubs with optimal values within required parameters
                                        </p>
                                    </div>
                                </div>

                                <div id="changeover-tasks" style="display: none;">
                                    <h4 style="color: var(--primary-orange); margin-bottom: 15px;">Changeover Maintenance Tasks</h4>
                                </div>
                            </div>
                        </div>

                        <!-- MAINTENANCE TASKS SECTION -->
                        <div class="form-section">
                            <h3>Maintenance Tasks Completed</h3>
                            
                            <h4>Daily Check Tasks</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" name="visual_inspection" id="visual-inspection" value="completed">
                                <label for="visual-inspection">Visual inspection of water clarity and equipment</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="water_testing" id="water-testing" value="completed">
                                <label for="water-testing">Water chemistry testing completed and logged</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="waterline_clean" id="waterline-clean" value="completed">
                                <label for="waterline-clean">Waterline cleaned and scrubbed</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="surface_debris" id="surface-debris" value="completed">
                                <label for="surface-debris">Surface debris removed</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="lid_inspection" id="lid-inspection" value="completed">
                                <label for="lid-inspection">Hot tub lid/cover inspected for damage</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="lid_clean" id="lid-clean" value="completed">
                                <label for="lid-clean">Hot tub lid cleaned and treated</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="lid_secure" id="lid-secure" value="completed">
                                <label for="lid-secure">Hot tub lid properly secured and locked</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="safety_equipment" id="safety-equipment" value="completed">
                                <label for="safety-equipment">Safety equipment check (emergency stop, signage)</label>
                            </div>

                            <h4>Changeover Tasks (if applicable)</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" name="full_drain" id="full-drain" value="completed">
                                <label for="full-drain">Complete hot tub drain</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="shell_clean" id="shell-clean" value="completed">
                                <label for="shell-clean">Full shell and surface cleaning</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="jet_clean" id="jet-clean" value="completed">
                                <label for="jet-clean">Jets deep cleaned and inspected</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="filter_change" id="filter-change" value="completed">
                                <label for="filter-change">Filter cartridges changed</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="refill_complete" id="refill-complete" value="completed">
                                <label for="refill-complete">Complete refill and initial chemical balance</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="system_restart" id="system-restart" value="completed">
                                <label for="system-restart">System restart and circulation check</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" name="final_testing" id="final-testing" value="completed">
                                <label for="final-testing">Final water quality testing and adjustment</label>
                            </div>
                        </div>

                        <!-- WATER QUALITY SECTION -->
                        <div class="form-section">
                            <h3>Water Quality Testing & Monitoring</h3>
                            <div class="water-quality-grid">
                                <div class="quality-item">
                                    <label class="form-label" for="ph-level">pH Level <span class="required-field">*</span></label>
                                    <input type="number" name="ph_level" class="form-input" id="ph-level" step="0.1" min="6.0" max="8.0" required>
                                    <div class="quality-range">Target: 7.2 - 7.6</div>
                                </div>
                                <div class="quality-item">
                                    <label class="form-label" for="bromine-level">Free Bromine (mg/l) <span class="required-field">*</span></label>
                                    <input type="number" name="bromine_level" class="form-input" id="bromine-level" step="0.1" min="0" max="8" required>
                                    <div class="quality-range">Target: 3.0 - 5.0 mg/l</div>
                                </div>
                                <div class="quality-item">
                                    <label class="form-label" for="temperature">Temperature (°C) <span class="required-field">*</span></label>
                                    <input type="number" name="temperature" class="form-input" id="temperature" step="0.1" min="35" max="40" required>
                                    <div class="quality-range">Legal Max: 40°C</div>
                                </div>
                                <div class="quality-item">
                                    <label class="form-label" for="total-alkalinity">Total Alkalinity (mg/l) <span class="required-field">*</span></label>
                                    <input type="number" name="total_alkalinity" class="form-input" id="total-alkalinity" step="1" min="80" max="200" required>
                                    <div class="quality-range">Target: 80 - 120 mg/l</div>
                                </div>
                            </div>
                        </div>

                        <!-- CHEMICAL TREATMENT SECTION -->
                        <div class="form-section">
                            <h3>Chemical Treatment Log</h3>
                            
                            <div class="form-group form-group-full">
                                <label class="form-label">Chemicals Added</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="bromine_tablets" id="bromine-tablets" value="added">
                                    <label for="bromine-tablets">Bromine Tablets</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="ph_plus" id="ph-plus" value="added">
                                    <label for="ph-plus">pH Plus</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="ph_minus" id="ph-minus" value="added">
                                    <label for="ph-minus">pH Minus</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="alkalinity_increaser" id="alkalinity-increaser" value="added">
                                    <label for="alkalinity-increaser">Alkalinity Increaser</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="bromine_shock" id="bromine-shock" value="added">
                                    <label for="bromine-shock">Bromine Shock</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="anti_foam" id="anti-foam" value="added">
                                    <label for="anti-foam">Anti-Foam</label>
                                </div>
                            </div>

                            <div class="form-group form-group-full">
                                <label class="form-label">Chemical Treatment Details</label>
                                <textarea name="chemical_notes" class="form-input" rows="4" placeholder="Record specific chemical amounts, treatments, or observations..."></textarea>
                            </div>
                        </div>

                        <!-- ISSUES & MAINTENANCE NOTES SECTION -->
                        <div class="form-section">
                            <h3>Issues & Maintenance Notes</h3>
                            
                            <div class="form-group form-group-full">
                                <label class="form-label">Issues Identified</label>
                                <textarea name="issues_identified" class="form-input" rows="4" placeholder="Document any equipment issues, water quality problems, or safety concerns..."></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Priority Level</label>
                                    <select name="priority_level" class="form-input" id="priority-level" onchange="updateFollowUpDate()">
                                        <option value="low">Low - Routine</option>
                                        <option value="medium">Medium - Schedule Soon</option>
                                        <option value="high">High - Urgent</option>
                                        <option value="critical">Critical - Immediate Action</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Follow-up Required By</label>
                                    <input type="date" name="follow_up_date" class="form-input" id="follow-up-date">
                                </div>
                            </div>

                            <div class="form-group form-group-full">
                                <label class="form-label">Additional Notes</label>
                                <textarea name="additional_notes" class="form-input" rows="3" placeholder="Any additional maintenance notes or observations..."></textarea>
                            </div>
                        </div>

                        <!-- SUBMIT BUTTON -->
                        <button type="submit" class="btn-submit">Submit Hot Tub Maintenance Report</button>
                        
                    </form>
                </div>
            </div>

            <!-- Other sections with placeholder content -->
            <div id="property-passports" class="content-section fade-in">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Property Passports</h2>
                        <p class="section-subtitle">Comprehensive property management and documentation</p>
                    </div>
                </div>
                <div style="padding: 40px; text-align: center; color: var(--medium-gray);">
                    <p>Form integration in progress. Please add your Property Passport form content here.</p>
                </div>
            </div>

            <div id="incidents-actions" class="content-section fade-in">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Incidents & Actions</h2>
                        <p class="section-subtitle">Incident reporting, tracking and corrective actions</p>
                    </div>
                </div>
                <div style="padding: 40px; text-align: center; color: var(--medium-gray);">
                    <p>Form integration in progress. Please add your Incidents & Actions form content here.</p>
                </div>
            </div>

            <!-- Team Section -->
            <div id="team" class="content-section fade-in">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Team</h2>
                        <p class="section-subtitle">Personnel management and HR</p>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Total Staff</h3>
                            <div class="card-value">127</div>
                        </div>
                        <div class="card-trend positive">+3 new hires</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Attendance Rate</h3>
                            <div class="card-value">96.2%</div>
                        </div>
                        <div class="card-trend positive">+1.4% this month</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Training Compliance</h3>
                            <div class="card-value">89%</div>
                        </div>
                        <div class="card-trend pending">11% pending</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Overtime Hours</h3>
                            <div class="card-value">247</div>
                        </div>
                        <div class="card-trend negative">+12% this week</div>
                    </div>
                </div>
            </div>

            <!-- Other sections continue here with similar placeholder structure... -->
            <!-- Adding just a few more for demonstration -->
            
            <div id="accommodation" class="content-section fade-in">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Accommodation</h2>
                        <p class="section-subtitle">Guest accommodation management and booking system</p>
                    </div>
                </div>
                <div style="padding: 40px; text-align: center; color: var(--medium-gray);">
                    <p>Form integration in progress. Please add your Accommodation form content here.</p>
                </div>
            </div>

            <div id="risk-assessment" class="content-section fade-in">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Risk Assessment</h2>
                        <p class="section-subtitle">Safety and compliance management</p>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Overall Risk Score</h3>
                            <div class="card-value">Low</div>
                        </div>
                        <div class="card-trend positive">2.3/10 risk level</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Open Risk Items</h3>
                            <div class="card-value">7</div>
                        </div>
                        <div class="card-trend pending">Requires review</div>
                    </div>
                </div>
            </div>

            <!-- Add all other sections as needed... -->
        </div>
    </div>

    <!-- Modals -->
    <!-- Add/Edit Property Modal -->
    <div id="add-property-modal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="property-modal-title">Add New Property</h3>
            <div style="margin-bottom: 20px;">
                <label for="new-property-name">Property Name: <span style="color: var(--danger);">*</span></label>
                <input type="text" id="new-property-name" class="form-input" placeholder="e.g., Sunshine Holiday Park" required>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-property-type">Property Type: <span style="color: var(--danger);">*</span></label>
                <select id="new-property-type" class="form-input" required>
                    <option value="">Select Type</option>
                    <option value="Holiday Park">Holiday Park</option>
                    <option value="Resort">Resort</option>
                    <option value="Hotel">Hotel</option>
                    <option value="Lodge">Lodge</option>
                    <option value="Retreat Center">Retreat Center</option>
                    <option value="Campground">Campground</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-property-location">Location/Address:</label>
                <input type="text" id="new-property-location" class="form-input" placeholder="e.g., Devon, UK">
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-property-manager">Site Manager:</label>
                <input type="text" id="new-property-manager" class="form-input" placeholder="e.g., John Smith">
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('add-property-modal')">Cancel</button>
                <button type="button" class="btn" onclick="saveNewProperty()">Save Property</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Hot Tub Modal -->
    <div id="add-hottub-modal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="hottub-modal-title">Add New Hot Tub</h3>
            <div style="margin-bottom: 20px;">
                <label for="new-hottub-id">Hot Tub ID: <span style="color: var(--danger);">*</span></label>
                <input type="text" id="new-hottub-id" class="form-input" placeholder="e.g., HT-001" required>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-hottub-location">Location: <span style="color: var(--danger);">*</span></label>
                <input type="text" id="new-hottub-location" class="form-input" placeholder="e.g., Pool Deck" required>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-hottub-capacity">Capacity (Litres): <span style="color: var(--danger);">*</span></label>
                <input type="number" id="new-hottub-capacity" class="form-input" placeholder="e.g., 1500" required>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-hottub-brand">Brand/Model:</label>
                <input type="text" id="new-hottub-brand" class="form-input" placeholder="e.g., Jacuzzi J-375">
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('add-hottub-modal')">Cancel</button>
                <button type="button" class="btn" onclick="saveNewHotTub()">Save Hot Tub</button>
            </div>
        </div>
    </div>

    <!-- View All Hot Tubs Modal -->
    <div id="view-hottubs-modal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">All Hot Tubs Management</h3>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-wrap: wrap;">
                <button type="button" class="btn" onclick="selectAllHotTubs()">☑️ Select All</button>
                <button type="button" class="btn" onclick="deselectAllHotTubs()">⬜ Deselect All</button>
                <button type="button" class="btn" onclick="completeAllDailies()" style="background: var(--success);">
                    ✅ Complete All Dailies - No Issues
                </button>
            </div>

            <div id="hottub-list-container"></div>

            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('view-hottubs-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Technician Modal -->
    <div id="add-technician-modal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="technician-modal-title">Add New Inspector/Technician</h3>
            <div style="margin-bottom: 20px;">
                <label for="new-technician-name">Inspector Name: <span style="color: var(--danger);">*</span></label>
                <input type="text" id="new-technician-name" class="form-input" placeholder="e.g., John Smith" required>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-technician-certification">Certification Number: <span style="color: var(--danger);">*</span></label>
                <input type="text" id="new-technician-certification" class="form-input" placeholder="e.g., WQ-2024-001" required>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-technician-specialization">Specialization:</label>
                <select id="new-technician-specialization" class="form-input">
                    <option value="">Select Specialization</option>
                    <option value="Water Quality">Water Quality Specialist</option>
                    <option value="Maintenance">Maintenance Specialist</option>
                    <option value="Safety Inspector">Safety Inspector</option>
                    <option value="Chemical Treatment">Chemical Treatment Specialist</option>
                    <option value="Equipment Specialist">Equipment Specialist</option>
                    <option value="General Inspector">General Inspector</option>
                    <option value="Supervisor">Supervisor</option>
                </select>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-technician-phone">Phone Number:</label>
                <input type="tel" id="new-technician-phone" class="form-input" placeholder="e.g., 01234 567890">
            </div>
            <div style="margin-bottom: 20px;">
                <label for="new-technician-email">Email Address:</label>
                <input type="email" id="new-technician-email" class="form-input" placeholder="e.g., inspector@company.com">
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('add-technician-modal')">Cancel</button>
                <button type="button" class="btn" onclick="saveNewTechnician()">Save Inspector</button>
            </div>
        </div>
    </div>

    <!-- View All Technicians Modal -->
    <div id="view-technicians-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 class="modal-title">All Inspectors/Technicians Management</h3>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-wrap: wrap;">
                <button type="button" class="btn" onclick="selectAllTechnicians()">☑️ Select All</button>
                <button type="button" class="btn" onclick="deselectAllTechnicians()">⬜ Deselect All</button>
                <button type="button" class="btn" onclick="generateTechnicianReport()" style="background: var(--success);">
                    📊 Generate Team Report
                </button>
            </div>

            <div id="technician-list-container"></div>

            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('view-technicians-modal')">Close</button>
            </div>
        </div>
    </div>
    <div id="addLinkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Custom Link</h3>
                <button class="close-btn" onclick="closeAddLinkModal()">×</button>
            </div>
            
            <form id="addLinkForm">
                <div class="form-group">
                    <label class="form-label" for="linkName">Link Name *</label>
                    <input type="text" id="linkName" class="form-input" required placeholder="e.g., External Booking System">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="linkUrl">URL *</label>
                    <input type="url" id="linkUrl" class="form-input" required placeholder="https://example.com">
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeAddLinkModal()">Cancel</button>
                    <button type="submit" class="btn">Add Link</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let customLinks = JSON.parse(localStorage.getItem('cqr365-custom-links') || '[]');
        let dashboardData = JSON.parse(localStorage.getItem('cqr365-dashboard-data') || '{}');
        
        // Hot Tub Management Variables  
        let hotTubs = JSON.parse(localStorage.getItem('hotTubs') || '[{"id":"HT-001","location":"Pool Deck","capacity":1500,"brand":"Jacuzzi J-375"},{"id":"HT-002","location":"Cabin Area","capacity":1200,"brand":"HotSpring Highlife"},{"id":"HT-003","location":"Spa Complex","capacity":2000,"brand":"Caldera Niagara"},{"id":"HT-004","location":"Main Lodge","capacity":1800,"brand":"Sundance Optima"},{"id":"HT-005","location":"Riverside","capacity":1600,"brand":"Hot Spot Rhythm"}]');
        let selectedHotTubId = null;
        let editingHotTubId = null;

        // Property Management Variables
        let properties = JSON.parse(localStorage.getItem('properties') || '[{"id":"PROP-001","name":"Sunshine Holiday Park","type":"Holiday Park","location":"Devon, UK","manager":"Sarah Johnson"},{"id":"PROP-002","name":"Riverside Resort","type":"Resort","location":"Lake District, UK","manager":"Mike Davis"},{"id":"PROP-003","name":"Lakeside Lodge","type":"Lodge","location":"Scotland, UK","manager":"Emma Wilson"},{"id":"PROP-004","name":"Coastal Retreat","type":"Retreat Center","location":"Cornwall, UK","manager":"John Smith"}]');
        let selectedPropertyId = null;
        let editingPropertyId = null;

        // Technician Management Variables
        let technicians = JSON.parse(localStorage.getItem('technicians') || '[{"id":"TECH-001","name":"John Smith","certification":"WQ-2024-001","specialization":"Water Quality","phone":"01234 567890","email":"john.smith@company.com"},{"id":"TECH-002","name":"Sarah Johnson","certification":"WQ-2024-002","specialization":"Maintenance","phone":"01234 567891","email":"sarah.johnson@company.com"},{"id":"TECH-003","name":"Mike Davis","certification":"WQ-2024-003","specialization":"Safety Inspector","phone":"01234 567892","email":"mike.davis@company.com"},{"id":"TECH-004","name":"Emma Wilson","certification":"WQ-2024-004","specialization":"Chemical Treatment","phone":"01234 567893","email":"emma.wilson@company.com"}]');
        let selectedTechnicianId = null;
        let editingTechnicianId = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            renderCustomLinks();
            updateDashboardFromStorage();
            loadHotTubs();
            loadProperties();
            loadTechnicians();
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('maintenance-date').value = today;
        });

        // Function to update dashboard cards from localStorage
        function updateDashboardFromStorage() {
            if (Object.keys(dashboardData).length > 0) {
                Object.keys(dashboardData).forEach(sectionId => {
                    const section = dashboardData[sectionId];
                    updateSectionDashboard(sectionId, section);
                });
            }
        }

        // Function to update a specific section's dashboard
        function updateSectionDashboard(sectionId, data) {
            const section = document.getElementById(sectionId);
            if (section) {
                const cards = section.querySelectorAll('.card-value');
                const trends = section.querySelectorAll('.card-trend');
                
                if (data && typeof data === 'object') {
                    Object.keys(data).forEach((key, index) => {
                        if (cards[index]) {
                            cards[index].textContent = data[key].value || '--';
                        }
                        if (trends[index]) {
                            trends[index].textContent = data[key].trend || 'Awaiting data';
                            trends[index].className = `card-trend ${data[key].status || 'pending'}`;
                        }
                    });
                }
            }
        }

        // Mobile navigation functions
        function toggleMobileNav() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        function closeMobileNav() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
        }

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Remove active class from all nav buttons
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(btn => btn.classList.remove('active'));
            
            // Show selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.classList.add('fade-in');
            }
            
            // Add active class to appropriate button
            const activeButton = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // Close mobile nav if open
            if (window.innerWidth <= 768) {
                closeMobileNav();
            }
        }

        // Function to handle form link clicks
        function handleFormClick() {
            if (window.innerWidth <= 768) {
                closeMobileNav();
            }
        }

        // Function to scroll to system status
        function scrollToSystemStatus() {
            const statusSection = document.getElementById('system-status');
            if (statusSection) {
                statusSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Custom Links Management
        function openAddLinkModal() {
            document.getElementById('addLinkModal').classList.add('active');
        }

        function closeAddLinkModal() {
            document.getElementById('addLinkModal').classList.remove('active');
            document.getElementById('addLinkForm').reset();
        }

        function addCustomLink(name, url) {
            const newLink = {
                id: Date.now().toString(),
                name: name,
                url: url
            };
            
            customLinks.push(newLink);
            localStorage.setItem('cqr365-custom-links', JSON.stringify(customLinks));
            renderCustomLinks();
        }

        function removeCustomLink(id) {
            if (confirm('Are you sure you want to remove this custom link?')) {
                customLinks = customLinks.filter(link => link.id !== id);
                localStorage.setItem('cqr365-custom-links', JSON.stringify(customLinks));
                renderCustomLinks();
            }
        }

        function renderCustomLinks() {
            const container = document.getElementById('customLinksContainer');
            
            if (customLinks.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = customLinks.map(link => `
                <div style="position: relative; group;">
                    <a href="${link.url}" target="_blank" class="custom-nav-btn">
                        ${link.name}
                        <span class="external-icon">↗</span>
                    </a>
                    <button 
                        onclick="removeCustomLink('${link.id}')" 
                        style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: rgba(220, 53, 69, 0.1); border: none; color: var(--danger); padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; cursor: pointer; opacity: 0; transition: opacity 0.3s ease;"
                        onmouseover="this.style.opacity='1'"
                        onmouseout="this.style.opacity='0'"
                    >×</button>
                </div>
            `).join('');

            // Add hover effect to show remove buttons
            const linkContainers = container.querySelectorAll('div[style*="position: relative"]');
            linkContainers.forEach(container => {
                const removeBtn = container.querySelector('button');
                container.addEventListener('mouseenter', () => {
                    removeBtn.style.opacity = '1';
                });
                container.addEventListener('mouseleave', () => {
                    removeBtn.style.opacity = '0';
                });
            });
        }

        // Handle add link form submission
        document.getElementById('addLinkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('linkName').value.trim();
            const url = document.getElementById('linkUrl').value.trim();
            
            if (name && url) {
                addCustomLink(name, url);
                closeAddLinkModal();
            }
        });

        // Hot Tub Management Functions
        function loadHotTubs() {
            updateHotTubDropdown();
            updateHeaderStats();
        }

        function updateHotTubDropdown() {
            const select = document.getElementById('hottub-id');
            if (!select) return;
            
            select.innerHTML = '<option value="">Select Hot Tub</option>';
            
            hotTubs.forEach(hotTub => {
                const option = document.createElement('option');
                option.value = hotTub.id;
                option.textContent = `${hotTub.id} - ${hotTub.location}`;
                select.appendChild(option);
            });
        }

        function updateHotTubSpecs() {
            const selectedId = document.getElementById('hottub-id').value;
            const capacityInput = document.getElementById('hottub-capacity');
            const infoDiv = document.getElementById('selected-hottub-info');
            const detailsDiv = document.getElementById('selected-hottub-details');
            
            if (selectedId) {
                const hotTub = hotTubs.find(ht => ht.id === selectedId);
                if (hotTub) {
                    capacityInput.value = hotTub.capacity;
                    selectedHotTubId = selectedId;
                    
                    detailsDiv.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div><strong>ID:</strong> ${hotTub.id}</div>
                            <div><strong>Location:</strong> ${hotTub.location}</div>
                            <div><strong>Brand:</strong> ${hotTub.brand || 'N/A'}</div>
                            <div><strong>Capacity:</strong> ${hotTub.capacity}L</div>
                        </div>
                    `;
                    
                    infoDiv.style.display = 'block';
                }
            } else {
                capacityInput.value = '';
                selectedHotTubId = null;
                infoDiv.style.display = 'none';
            }
        }

        function saveHotTubs() {
            localStorage.setItem('hotTubs', JSON.stringify(hotTubs));
            updateHeaderStats();
        }

        function updateHeaderStats() {
            const activeHotTubs = document.getElementById('active-hottubs');
            if (activeHotTubs) {
                activeHotTubs.textContent = hotTubs.length;
            }
        }

        function showMaintenanceTasks() {
            const maintenanceType = document.getElementById('maintenance-type').value;
            const dailyTasks = document.getElementById('daily-tasks');
            const changeoverTasks = document.getElementById('changeover-tasks');
            
            if (dailyTasks) dailyTasks.style.display = 'none';
            if (changeoverTasks) changeoverTasks.style.display = 'none';
            
            // Reset all checkboxes first
            const allCheckboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
            allCheckboxes.forEach(cb => cb.checked = false);
            
            if (maintenanceType === 'daily' && dailyTasks) {
                dailyTasks.style.display = 'block';
                
                // Auto-populate daily maintenance tasks
                const dailyTaskIds = ['visual-inspection', 'water-testing', 'waterline-clean', 'surface-debris', 'lid-inspection', 'lid-clean', 'lid-secure', 'safety-equipment'];
                dailyTaskIds.forEach(taskId => {
                    const checkbox = document.getElementById(taskId);
                    if (checkbox) checkbox.checked = true;
                });
                
            } else if (maintenanceType === 'changeover' && changeoverTasks) {
                changeoverTasks.style.display = 'block';
                
                // Auto-populate both daily and changeover tasks
                const dailyTaskIds = ['visual-inspection', 'water-testing', 'waterline-clean', 'surface-debris', 'lid-inspection', 'lid-clean', 'lid-secure', 'safety-equipment'];
                const changeoverTaskIds = ['full-drain', 'shell-clean', 'jet-clean', 'filter-change', 'refill-complete', 'system-restart', 'final-testing'];
                
                [...dailyTaskIds, ...changeoverTaskIds].forEach(taskId => {
                    const checkbox = document.getElementById(taskId);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }

        function completeAllDailyTasks() {
            if (hotTubs.length === 0) {
                alert('No hot tubs configured. Please add hot tubs first.');
                return;
            }

            // Check all daily task checkboxes
            const checkboxes = document.querySelectorAll('#daily-tasks input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);

            // Generate optimal values for all hot tubs
            let resultsHTML = '';
            hotTubs.forEach(hotTub => {
                const phValue = (7.2 + Math.random() * 0.4).toFixed(1);
                const bromineValue = (3.0 + Math.random() * 2.0).toFixed(1);
                const tempValue = (37.0 + Math.random() * 2.5).toFixed(1);
                const alkalinityValue = Math.floor(80 + Math.random() * 40);

                resultsHTML += `Hot Tub: ${hotTub.id} - ${hotTub.location}\npH: ${phValue} ✅\nBromine: ${bromineValue} mg/l ✅\nTemperature: ${tempValue}°C ✅\nAlkalinity: ${alkalinityValue} mg/l ✅\nStatus: All parameters within optimal range\n\n`;
            });

            // If a hot tub is selected, populate its values
            if (selectedHotTubId) {
                const phValue = (7.2 + Math.random() * 0.4).toFixed(1);
                const bromineValue = (3.0 + Math.random() * 2.0).toFixed(1);
                const tempValue = (37.0 + Math.random() * 2.5).toFixed(1);
                const alkalinityValue = Math.floor(80 + Math.random() * 40);
                
                const phInput = document.getElementById('ph-level');
                const bromineInput = document.getElementById('bromine-level');
                const tempInput = document.getElementById('temperature');
                const alkalinityInput = document.getElementById('total-alkalinity');
                
                if (phInput) phInput.value = phValue;
                if (bromineInput) bromineInput.value = bromineValue;
                if (tempInput) tempInput.value = tempValue;
                if (alkalinityInput) alkalinityInput.value = alkalinityValue;
            }

            alert(`✅ All ${hotTubs.length} hot tubs have been checked and logged with optimal values!\n\n${resultsHTML}`);
            updateDashboardWithCurrentData();
        }

        // Hot tub CRUD operations
        function showAddHotTubModal() {
            editingHotTubId = null;
            document.getElementById('hottub-modal-title').textContent = 'Add New Hot Tub';
            document.getElementById('new-hottub-id').value = '';
            document.getElementById('new-hottub-location').value = '';
            document.getElementById('new-hottub-capacity').value = '';
            document.getElementById('new-hottub-brand').value = '';
            document.getElementById('add-hottub-modal').classList.add('active');
        }

        function showEditHotTubModal() {
            if (!selectedHotTubId) {
                alert('Please select a hot tub first.');
                return;
            }
            
            const hotTub = hotTubs.find(ht => ht.id === selectedHotTubId);
            if (!hotTub) return;
            
            editingHotTubId = selectedHotTubId;
            document.getElementById('hottub-modal-title').textContent = 'Edit Hot Tub';
            document.getElementById('new-hottub-id').value = hotTub.id;
            document.getElementById('new-hottub-location').value = hotTub.location;
            document.getElementById('new-hottub-capacity').value = hotTub.capacity;
            document.getElementById('new-hottub-brand').value = hotTub.brand || '';
            
            document.getElementById('add-hottub-modal').classList.add('active');
        }

        function saveNewHotTub() {
            const id = document.getElementById('new-hottub-id').value.trim();
            const location = document.getElementById('new-hottub-location').value.trim();
            const capacity = document.getElementById('new-hottub-capacity').value;
            const brand = document.getElementById('new-hottub-brand').value.trim();
            
            if (!id || !location || !capacity) {
                alert('Please fill in all required fields (ID, Location, and Capacity)');
                return;
            }
            
            const hotTubData = {
                id: id,
                location: location,
                capacity: parseInt(capacity),
                brand: brand
            };
            
            if (editingHotTubId) {
                const index = hotTubs.findIndex(ht => ht.id === editingHotTubId);
                if (index !== -1) {
                    hotTubs[index] = hotTubData;
                }
            } else {
                if (hotTubs.some(ht => ht.id === id)) {
                    alert('A hot tub with this ID already exists!');
                    return;
                }
                hotTubs.push(hotTubData);
            }
            
            saveHotTubs();
            updateHotTubDropdown();
            closeModal('add-hottub-modal');
            alert(`Hot Tub ${id} has been ${editingHotTubId ? 'updated' : 'added'} successfully!`);
        }

        function deleteSelectedHotTub() {
            if (!selectedHotTubId) {
                alert('Please select a hot tub first.');
                return;
            }
            
            if (confirm(`Are you sure you want to delete hot tub ${selectedHotTubId}?`)) {
                hotTubs = hotTubs.filter(ht => ht.id !== selectedHotTubId);
                saveHotTubs();
                updateHotTubDropdown();
                const capacityInput = document.getElementById('hottub-capacity');
                const infoDiv = document.getElementById('selected-hottub-info');
                if (capacityInput) capacityInput.value = '';
                if (infoDiv) infoDiv.style.display = 'none';
                selectedHotTubId = null;
                alert('Hot tub deleted successfully!');
            }
        }

        function showHotTubListModal() {
            const container = document.getElementById('hottub-list-container');
            
            if (hotTubs.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">No hot tubs found. Click "Add New Hot Tub" to get started.</p>';
            } else {
                container.innerHTML = hotTubs.map(hotTub => `
                    <div style="display: flex; align-items: center; padding: 10px; margin: 5px 0; background: var(--light-gray); border: 2px solid var(--border-color); border-radius: 8px;">
                        <input type="checkbox" id="select-${hotTub.id}" data-hottub-id="${hotTub.id}" style="margin-right: 12px;">
                        <label for="select-${hotTub.id}" style="cursor: pointer; flex: 1;">
                            <strong>${hotTub.id}</strong> - ${hotTub.location} 
                            (${hotTub.capacity}L${hotTub.brand ? ', ' + hotTub.brand : ''})
                        </label>
                    </div>
                `).join('');
            }
            
            document.getElementById('view-hottubs-modal').classList.add('active');
        }

        function selectAllHotTubs() {
            const checkboxes = document.querySelectorAll('#hottub-list-container input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
        }

        function deselectAllHotTubs() {
            const checkboxes = document.querySelectorAll('#hottub-list-container input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
        }

        function completeAllDailies() {
            const selectedCheckboxes = document.querySelectorAll('#hottub-list-container input[type="checkbox"]:checked');
            
            if (selectedCheckboxes.length === 0) {
                alert('Please select at least one hot tub.');
                return;
            }
            
            const completedData = [];
            selectedCheckboxes.forEach(checkbox => {
                const hotTubId = checkbox.dataset.hottubId;
                const hotTub = hotTubs.find(ht => ht.id === hotTubId);
                
                if (hotTub) {
                    const data = {
                        id: hotTubId,
                        location: hotTub.location,
                        ph: (7.2 + Math.random() * 0.4).toFixed(1),
                        bromine: (3.0 + Math.random() * 2.0).toFixed(1),
                        temperature: (37.0 + Math.random() * 2.5).toFixed(1),
                        alkalinity: Math.floor(80 + Math.random() * 40),
                        status: 'Complete - No Issues'
                    };
                    completedData.push(data);
                }
            });
            
            let report = `✅ Daily Maintenance Completed for ${completedData.length} Hot Tub(s)\n\n`;
            completedData.forEach(data => {
                report += `${data.id} - ${data.location}\n  pH: ${data.ph} ✓\n  Bromine: ${data.bromine} mg/l ✓\n  Temp: ${data.temperature}°C ✓\n  Alkalinity: ${data.alkalinity} mg/l ✓\n  Status: ${data.status}\n\n`;
            });
            
            alert(report);
            closeModal('view-hottubs-modal');
            
            // If selected hot tub is in completed list, update its values
            if (selectedHotTubId && completedData.find(d => d.id === selectedHotTubId)) {
                const data = completedData.find(d => d.id === selectedHotTubId);
                const phInput = document.getElementById('ph-level');
                const bromineInput = document.getElementById('bromine-level');
                const tempInput = document.getElementById('temperature');
                const alkalinityInput = document.getElementById('total-alkalinity');
                
                if (phInput) phInput.value = data.ph;
                if (bromineInput) bromineInput.value = data.bromine;
                if (tempInput) tempInput.value = data.temperature;
                if (alkalinityInput) alkalinityInput.value = data.alkalinity;
            }
            
            updateDashboardWithCurrentData();
        }

        // Property Management Functions
        function loadProperties() {
            updateBusinessDropdown();
        }

        function updateBusinessDropdown() {
            const select = document.getElementById('business-select');
            if (!select) return;
            
            // Keep existing options and add properties
            const existingOptions = select.innerHTML;
            
            properties.forEach(property => {
                const option = document.createElement('option');
                option.value = property.name;
                option.textContent = property.name;
                // Insert before the "custom" option
                const customOption = select.querySelector('option[value="custom"]');
                if (customOption) {
                    select.insertBefore(option, customOption);
                } else {
                    select.appendChild(option);
                }
            });
        }

        // Technician Management Functions
        function loadTechnicians() {
            updateTechnicianDropdown();
        }

        function updateTechnicianDropdown() {
            const select = document.getElementById('technician-select');
            if (!select) return;
            
            select.innerHTML = '<option value="">Select Inspector</option>';
            
            technicians.forEach(technician => {
                const option = document.createElement('option');
                option.value = technician.name;
                option.textContent = `${technician.name} (${technician.specialization || 'Inspector'})`;
                select.appendChild(option);
            });

            // Add custom option
            const customOption = document.createElement('option');
            customOption.value = 'custom';
            customOption.textContent = 'Other Inspector';
            select.appendChild(customOption);
        }

        function saveTechnicians() {
            localStorage.setItem('technicians', JSON.stringify(technicians));
        }

        function updateSiteInfo() {
            const select = document.getElementById('business-select');
            const customInput = document.getElementById('custom-business');
            
            if (select.value === 'custom') {
                customInput.style.display = 'block';
                customInput.required = true;
            } else {
                customInput.style.display = 'none';
                customInput.required = false;
            }
            
            // Update selected property info if it exists
            const property = properties.find(p => p.name === select.value);
            if (property) {
                selectedPropertyId = property.id;
                updateSelectedPropertyDisplay(property);
            }
        }

        function updateSelectedPropertyDisplay(property) {
            const infoDiv = document.getElementById('selected-property-info');
            const detailsDiv = document.getElementById('selected-property-details');
            
            if (property && infoDiv && detailsDiv) {
                detailsDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div><strong>Name:</strong> ${property.name}</div>
                        <div><strong>Type:</strong> ${property.type}</div>
                        <div><strong>Location:</strong> ${property.location}</div>
                        <div><strong>Manager:</strong> ${property.manager}</div>
                    </div>
                `;
                infoDiv.style.display = 'block';
            }
        }

        function showAddPropertyModal() {
            editingPropertyId = null;
            document.getElementById('property-modal-title').textContent = 'Add New Property';
            document.getElementById('new-property-name').value = '';
            document.getElementById('new-property-type').value = '';
            document.getElementById('new-property-location').value = '';
            document.getElementById('new-property-manager').value = '';
            document.getElementById('add-property-modal').classList.add('active');
        }

        function showEditPropertyModal() {
            if (!selectedPropertyId) {
                alert('Please select a property first.');
                return;
            }
            
            const property = properties.find(p => p.id === selectedPropertyId);
            if (!property) return;
            
            editingPropertyId = selectedPropertyId;
            document.getElementById('property-modal-title').textContent = 'Edit Property';
            document.getElementById('new-property-name').value = property.name;
            document.getElementById('new-property-type').value = property.type;
            document.getElementById('new-property-location').value = property.location;
            document.getElementById('new-property-manager').value = property.manager;
            
            document.getElementById('add-property-modal').classList.add('active');
        }

        function saveNewProperty() {
            const name = document.getElementById('new-property-name').value.trim();
            const type = document.getElementById('new-property-type').value;
            const location = document.getElementById('new-property-location').value.trim();
            const manager = document.getElementById('new-property-manager').value.trim();
            
            if (!name || !type) {
                alert('Please fill in all required fields (Name and Type)');
                return;
            }
            
            const propertyData = {
                id: editingPropertyId || `PROP-${Date.now()}`,
                name: name,
                type: type,
                location: location,
                manager: manager
            };
            
            if (editingPropertyId) {
                const index = properties.findIndex(p => p.id === editingPropertyId);
                if (index !== -1) {
                    properties[index] = propertyData;
                }
            } else {
                if (properties.some(p => p.name === name)) {
                    alert('A property with this name already exists!');
                    return;
                }
                properties.push(propertyData);
            }
            
            localStorage.setItem('properties', JSON.stringify(properties));
            updateBusinessDropdown();
            closeModal('add-property-modal');
            alert(`Property ${name} has been ${editingPropertyId ? 'updated' : 'added'} successfully!`);
        }

        function deleteSelectedProperty() {
            if (!selectedPropertyId) {
                alert('Please select a property first.');
                return;
            }
            
            const property = properties.find(p => p.id === selectedPropertyId);
            if (property && confirm(`Are you sure you want to delete property ${property.name}?`)) {
                properties = properties.filter(p => p.id !== selectedPropertyId);
                localStorage.setItem('properties', JSON.stringify(properties));
                updateBusinessDropdown();
                
                // Reset selection
                const select = document.getElementById('business-select');
                const infoDiv = document.getElementById('selected-property-info');
                if (select) select.value = '';
                if (infoDiv) infoDiv.style.display = 'none';
                selectedPropertyId = null;
                
                alert('Property deleted successfully!');
            }
        }

        function showPropertyListModal() {
            // This would open a modal similar to hot tubs list
            alert('Property list modal - to be implemented');
        }

        // Technician management
        function updateTechnicianInfo() {
            const select = document.getElementById('technician-select');
            const customInput = document.getElementById('custom-technician');
            const certInput = document.getElementById('licence-number');
            const infoDiv = document.getElementById('selected-technician-info');
            const detailsDiv = document.getElementById('selected-technician-details');
            
            if (select.value === 'custom') {
                customInput.style.display = 'block';
                customInput.required = true;
                if (certInput) certInput.value = '';
                if (infoDiv) infoDiv.style.display = 'none';
                selectedTechnicianId = null;
            } else {
                customInput.style.display = 'none';
                customInput.required = false;
                
                // Find selected technician and update info
                const technician = technicians.find(t => t.name === select.value);
                if (technician && certInput) {
                    certInput.value = technician.certification || '';
                    selectedTechnicianId = technician.id;
                    
                    if (infoDiv && detailsDiv) {
                        detailsDiv.innerHTML = `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div><strong>Name:</strong> ${technician.name}</div>
                                <div><strong>Certification:</strong> ${technician.certification}</div>
                                <div><strong>Specialization:</strong> ${technician.specialization || 'N/A'}</div>
                                <div><strong>Phone:</strong> ${technician.phone || 'N/A'}</div>
                            </div>
                            <div style="margin-top: 10px;">
                                <div><strong>Email:</strong> ${technician.email || 'N/A'}</div>
                            </div>
                        `;
                        infoDiv.style.display = 'block';
                    }
                } else {
                    selectedTechnicianId = null;
                    if (infoDiv) infoDiv.style.display = 'none';
                }
            }
        }

        // Technician CRUD operations
        function showAddTechnicianModal() {
            editingTechnicianId = null;
            document.getElementById('technician-modal-title').textContent = 'Add New Inspector/Technician';
            document.getElementById('new-technician-name').value = '';
            document.getElementById('new-technician-certification').value = '';
            document.getElementById('new-technician-specialization').value = '';
            document.getElementById('new-technician-phone').value = '';
            document.getElementById('new-technician-email').value = '';
            document.getElementById('add-technician-modal').classList.add('active');
        }

        function showEditTechnicianModal() {
            if (!selectedTechnicianId) {
                alert('Please select an inspector first.');
                return;
            }
            
            const technician = technicians.find(t => t.id === selectedTechnicianId);
            if (!technician) return;
            
            editingTechnicianId = selectedTechnicianId;
            document.getElementById('technician-modal-title').textContent = 'Edit Inspector/Technician';
            document.getElementById('new-technician-name').value = technician.name;
            document.getElementById('new-technician-certification').value = technician.certification || '';
            document.getElementById('new-technician-specialization').value = technician.specialization || '';
            document.getElementById('new-technician-phone').value = technician.phone || '';
            document.getElementById('new-technician-email').value = technician.email || '';
            
            document.getElementById('add-technician-modal').classList.add('active');
        }

        function saveNewTechnician() {
            const name = document.getElementById('new-technician-name').value.trim();
            const certification = document.getElementById('new-technician-certification').value.trim();
            const specialization = document.getElementById('new-technician-specialization').value;
            const phone = document.getElementById('new-technician-phone').value.trim();
            const email = document.getElementById('new-technician-email').value.trim();
            
            if (!name || !certification) {
                alert('Please fill in all required fields (Name and Certification Number)');
                return;
            }
            
            const technicianData = {
                id: editingTechnicianId || `TECH-${Date.now()}`,
                name: name,
                certification: certification,
                specialization: specialization,
                phone: phone,
                email: email
            };
            
            if (editingTechnicianId) {
                const index = technicians.findIndex(t => t.id === editingTechnicianId);
                if (index !== -1) {
                    technicians[index] = technicianData;
                }
            } else {
                if (technicians.some(t => t.name === name)) {
                    alert('An inspector with this name already exists!');
                    return;
                }
                if (technicians.some(t => t.certification === certification)) {
                    alert('This certification number is already in use!');
                    return;
                }
                technicians.push(technicianData);
            }
            
            saveTechnicians();
            updateTechnicianDropdown();
            closeModal('add-technician-modal');
            alert(`Inspector ${name} has been ${editingTechnicianId ? 'updated' : 'added'} successfully!`);
        }

        function deleteSelectedTechnician() {
            if (!selectedTechnicianId) {
                alert('Please select an inspector first.');
                return;
            }
            
            const technician = technicians.find(t => t.id === selectedTechnicianId);
            if (technician && confirm(`Are you sure you want to delete inspector ${technician.name}?`)) {
                technicians = technicians.filter(t => t.id !== selectedTechnicianId);
                saveTechnicians();
                updateTechnicianDropdown();
                
                // Reset selection
                const select = document.getElementById('technician-select');
                const certInput = document.getElementById('licence-number');
                const infoDiv = document.getElementById('selected-technician-info');
                
                if (select) select.value = '';
                if (certInput) certInput.value = '';
                if (infoDiv) infoDiv.style.display = 'none';
                selectedTechnicianId = null;
                
                alert('Inspector deleted successfully!');
            }
        }

        function showTechnicianListModal() {
            const container = document.getElementById('technician-list-container');
            
            if (technicians.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">No inspectors found. Click "Add New Inspector" to get started.</p>';
            } else {
                container.innerHTML = technicians.map(technician => `
                    <div style="display: flex; align-items: center; padding: 15px; margin: 8px 0; background: var(--light-gray); border: 2px solid var(--border-color); border-radius: 8px;">
                        <input type="checkbox" id="select-${technician.id}" data-technician-id="${technician.id}" style="margin-right: 15px;">
                        <label for="select-${technician.id}" style="cursor: pointer; flex: 1;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                <div><strong>${technician.name}</strong></div>
                                <div style="font-size: 0.9rem; color: var(--medium-gray);">Cert: ${technician.certification}</div>
                                <div style="font-size: 0.9rem; color: var(--medium-gray);">${technician.specialization || 'General'}</div>
                                <div style="font-size: 0.9rem; color: var(--medium-gray);">${technician.phone || 'No phone'}</div>
                            </div>
                        </label>
                    </div>
                `).join('');
            }
            
            document.getElementById('view-technicians-modal').classList.add('active');
        }

        function selectAllTechnicians() {
            const checkboxes = document.querySelectorAll('#technician-list-container input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
        }

        function deselectAllTechnicians() {
            const checkboxes = document.querySelectorAll('#technician-list-container input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
        }

        function generateTechnicianReport() {
            const selectedCheckboxes = document.querySelectorAll('#technician-list-container input[type="checkbox"]:checked');
            
            if (selectedCheckboxes.length === 0) {
                alert('Please select at least one inspector.');
                return;
            }
            
            let report = `INSPECTOR/TECHNICIAN TEAM REPORT\n=====================================\n\n`;
            report += `Report Generated: ${new Date().toLocaleString()}\n`;
            report += `Total Selected: ${selectedCheckboxes.length} Inspector(s)\n\n`;
            
            selectedCheckboxes.forEach((checkbox, index) => {
                const technicianId = checkbox.dataset.technicianId;
                const technician = technicians.find(t => t.id === technicianId);
                
                if (technician) {
                    report += `${index + 1}. ${technician.name}\n`;
                    report += `   Certification: ${technician.certification}\n`;
                    report += `   Specialization: ${technician.specialization || 'General Inspector'}\n`;
                    report += `   Phone: ${technician.phone || 'Not provided'}\n`;
                    report += `   Email: ${technician.email || 'Not provided'}\n\n`;
                }
            });
            
            report += `---\nGenerated by CQR365 SafePark.PRO System\n`;
            
            alert(report);
            
            // Option to email report
            if (confirm('Would you like to prepare this report for email submission?')) {
                const subject = `Inspector Team Report - ${new Date().toLocaleDateString()}`;
                const mailto = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(report)}`;
                window.location.href = mailto;
            }
        }

        // Inspection scheduling
        function updateInspectionSchedule() {
            const inspectionType = document.getElementById('inspection_type')?.value;
            const nextInspectionInput = document.getElementById('next-inspection');
            
            if (!inspectionType || !nextInspectionInput) return;
            
            const today = new Date();
            let daysToAdd = 1; // default
            
            switch(inspectionType) {
                case 'routine': daysToAdd = 1; break;
                case 'weekly': daysToAdd = 7; break;
                case 'monthly': daysToAdd = 30; break;
                case 'incident': daysToAdd = 0; break;
                case 'complaint': daysToAdd = 1; break;
            }
            
            const nextDate = new Date(today);
            nextDate.setDate(today.getDate() + daysToAdd);
            nextInspectionInput.value = nextDate.toISOString().split('T')[0];
        }

        // Priority level and follow-up date management
        function updateFollowUpDate() {
            const priority = document.getElementById('priority-level')?.value;
            const followUpInput = document.getElementById('follow-up-date');
            
            if (!priority || !followUpInput) return;
            
            const today = new Date();
            let daysToAdd = 0;
            
            switch(priority) {
                case 'critical': daysToAdd = 0; break;
                case 'high': daysToAdd = 1; break;
                case 'medium': daysToAdd = 7; break;
                case 'low': daysToAdd = 30; break;
            }
            
            const followUpDate = new Date(today);
            followUpDate.setDate(today.getDate() + daysToAdd);
            followUpInput.value = followUpDate.toISOString().split('T')[0];
        }

        // Dashboard integration
        function updateDashboardWithCurrentData() {
            const activeHotTubs = hotTubs.length;
            const waterQualityScore = calculateWaterQualityScore();
            const maintenanceDue = Math.floor(Math.random() * 6);
            const temperature = document.getElementById('temperature')?.value || '--';
            
            updateDashboard('hot-tubs', {
                card1: { 
                    value: activeHotTubs.toString(), 
                    trend: 'All operational', 
                    status: 'positive' 
                },
                card2: { 
                    value: waterQualityScore >= 95 ? waterQualityScore.toFixed(1) + '%' : 'Awaiting data', 
                    trend: waterQualityScore >= 95 ? 'Excellent rating' : 'Awaiting full data', 
                    status: waterQualityScore >= 95 ? 'positive' : 'pending' 
                },
                card3: { 
                    value: maintenanceDue.toString(), 
                    trend: maintenanceDue <= 2 ? 'Up to date' : 'Within schedule', 
                    status: maintenanceDue <= 2 ? 'positive' : 'pending' 
                },
                card4: { 
                    value: temperature !== '--' ? temperature + '°C' : '--', 
                    trend: temperature !== '--' ? 'Optimal range' : 'Awaiting data', 
                    status: temperature !== '--' ? 'positive' : 'pending' 
                }
            });
            
            alert('Hot Tub dashboard data updated successfully! Return to the main dashboard to see the changes.');
        }

        function calculateWaterQualityScore() {
            const ph = parseFloat(document.getElementById('ph-level')?.value || 0);
            const bromine = parseFloat(document.getElementById('bromine-level')?.value || 0);
            const temperature = parseFloat(document.getElementById('temperature')?.value || 0);
            const alkalinity = parseFloat(document.getElementById('total-alkalinity')?.value || 0);
            
            if (!ph || !bromine || !temperature || !alkalinity) return 0;
            
            let score = 100;
            if (ph < 7.2 || ph > 7.6) score -= 10;
            if (bromine < 3.0 || bromine > 5.0) score -= 10;
            if (temperature > 40) score -= 30;
            if (alkalinity < 80 || alkalinity > 120) score -= 10;
            
            return Math.max(0, score);
        }

        function updateDashboard(sectionId, data) {
            let dashboardData = JSON.parse(localStorage.getItem('cqr365-dashboard-data') || '{}');
            dashboardData[sectionId] = data;
            localStorage.setItem('cqr365-dashboard-data', JSON.stringify(dashboardData));
        }

        // Form submission handling
        function handleFormSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const successMessage = document.getElementById('success-message-hottub');
            
            // Show loading state
            const submitButton = form.querySelector('.btn-submit');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Submitting...';
            submitButton.disabled = true;
            
            // Check if proper Formspree URL is configured
            if (form.action.includes('YOUR_FORM_ID')) {
                // No valid Formspree URL configured - use fallback method
                handleFallbackSubmission(form, formData, successMessage, submitButton, originalText);
                return;
            }
            
            // Submit to Formspree
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    handleSuccessfulSubmission(form, successMessage);
                } else {
                    response.json().then(data => {
                        if (data.errors) {
                            alert('Form submission error: ' + data.errors.map(error => error.message).join(', '));
                        } else {
                            alert('There was a problem submitting your form. Please try again.');
                        }
                    }).catch(() => {
                        // If response is not JSON, try fallback
                        handleFallbackSubmission(form, formData, successMessage, submitButton, originalText);
                    });
                }
            })
            .catch(error => {
                console.error('Form submission error:', error);
                // Use fallback method on network error
                handleFallbackSubmission(form, formData, successMessage, submitButton, originalText);
            })
            .finally(() => {
                // Reset button
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            });
        }

        function handleFallbackSubmission(form, formData, successMessage, submitButton, originalText) {
            // Create email body from form data
            let emailBody = createEmailReport(formData);
            
            // Create mailto link
            const subject = 'Hot Tub Maintenance Report - ' + new Date().toLocaleDateString();
            const mailto = `mailto:maintenance@safepark.pro?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
            
            // Reset button
            submitButton.textContent = originalText;
            submitButton.disabled = false;
            
            // Show success message
            handleSuccessfulSubmission(form, successMessage);
            
            // Open email client
            setTimeout(() => {
                window.location.href = mailto;
                alert('Your default email client should now be open with the maintenance report ready to send.\n\nIf you need to set up Formspree for direct submissions:\n1. Go to https://formspree.io\n2. Create a free account\n3. Create a new form\n4. Replace "YOUR_FORM_ID" in the form action with your Formspree form ID');
            }, 1000);
        }

        function createEmailReport(formData) {
            let report = 'HOT TUB MAINTENANCE REPORT\n' + '='.repeat(30) + '\n\n';
            
            // Add timestamp
            report += `Report Generated: ${new Date().toLocaleString()}\n\n`;
            
            // Process form data
            for (let [key, value] of formData.entries()) {
                if (key.startsWith('_')) continue; // Skip Formspree hidden fields
                
                if (value && value !== '') {
                    const fieldName = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    report += `${fieldName}: ${value}\n`;
                }
            }
            
            report += '\n---\nGenerated by CQR365 SafePark.PRO System';
            return report;
        }

        function handleSuccessfulSubmission(form, successMessage) {
            // Show success message
            successMessage.classList.add('show');
            successMessage.style.display = 'block';
            
            // Scroll to top to show success message
            document.querySelector('.content-section.active').scrollTop = 0;
            
            // Reset form
            form.reset();
            
            // Reset any selected items
            selectedHotTubId = null;
            selectedTechnicianId = null;
            
            // Hide info panels
            const hotTubInfo = document.getElementById('selected-hottub-info');
            const technicianInfo = document.getElementById('selected-technician-info');
            if (hotTubInfo) hotTubInfo.style.display = 'none';
            if (technicianInfo) technicianInfo.style.display = 'none';
            
            // Reset maintenance type selection
            const maintenanceTypeSelect = document.getElementById('maintenance-type');
            if (maintenanceTypeSelect) {
                maintenanceTypeSelect.value = '';
                showMaintenanceTasks(); // This will hide task sections and reset checkboxes
            }
            
            // Reset water quality input styling
            const waterInputs = ['ph-level', 'bromine-level', 'temperature', 'total-alkalinity'];
            waterInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.style.color = 'var(--white)';
                    input.style.fontSize = '1.5rem';
                }
            });
            
            // Update dashboard
            updateDashboardWithCurrentData();
            
            // Auto-hide success message after 10 seconds
            setTimeout(() => {
                successMessage.classList.remove('show');
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 300);
            }, 10000);
        }

        // Utility functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Close modal when clicking outside
        document.getElementById('addLinkModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAddLinkModal();
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAddLinkModal();
                const modals = document.querySelectorAll('.modal.active');
                modals.forEach(modal => modal.classList.remove('active'));
            }
        });

        // Handle window resize for mobile nav
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                closeMobileNav();
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
