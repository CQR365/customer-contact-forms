<!DOCTYPE html>
<!-- saved from url=(0188)file:///C:/Users/omnib/Documents/CQR%20Htmls/Complete%20-%20V1%20-%20CQR365%20(SPP)/300.06.%20V1%20-%20Accomodation%20Form%20&%20how%20it%20works/Final_DRAFT_Latest_CQR365_%20ASM_html.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CQR 365 Accommodation Services Module</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #cc5500 0%, #aa4400 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
        }

        .safe-procedures-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, #333, #000);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3), inset 2px 2px 4px rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .safe-procedures-btn:hover {
            transform: translateY(-2px);
            box-shadow: 7px 7px 15px rgba(0,0,0,0.4), inset 2px 2px 4px rgba(255,255,255,0.2);
        }

        .navigation {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: linear-gradient(145deg, #666, #444);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: linear-gradient(145deg, #cc5500, #aa4400);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .form-section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border-left: 5px solid #cc5500;
        }

        .section-title {
            color: #cc5500;
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 2px solid #cc5500;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #cc5500;
            box-shadow: 0 0 8px rgba(204, 85, 0, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .btn-3d {
            background: linear-gradient(145deg, #cc5500, #aa4400);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin: 10px 5px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3), inset 2px 2px 4px rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .btn-3d:hover {
            transform: translateY(-3px);
            box-shadow: 8px 8px 20px rgba(0,0,0,0.4), inset 2px 2px 4px rgba(255,255,255,0.3);
        }

        .btn-black {
            background: linear-gradient(145deg, #333, #000);
        }

        .btn-danger {
            background: linear-gradient(145deg, #dc3545, #c82333);
        }

        .btn-success {
            background: linear-gradient(145deg, #28a745, #218838);
        }

        .btn-checker {
            background: linear-gradient(145deg, #008800, #006600);
            font-size: 18px;
            padding: 20px 30px;
        }

        .service-type-section {
            background: linear-gradient(135deg, #fff5f0, #ffede0);
            border: 3px solid #cc5500;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .service-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .service-type-option {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .service-type-option:hover {
            border-color: #cc5500;
            background: #fff5f0;
            transform: translateY(-2px);
        }

        .service-type-option.selected {
            border-color: #cc5500;
            background: #ffede0;
            box-shadow: 0 4px 8px rgba(204, 85, 0, 0.2);
        }

        .service-requirements {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0066cc;
            margin: 20px 0;
            display: none;
        }

        .service-requirements.active {
            display: block;
        }

        .requirements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .select-all-service {
            background: #0066cc;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .select-all-service:hover {
            background: #0052a3;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }

        .checklist-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
            accent-color: #cc5500;
        }

        .accommodation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .accommodation-unit {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
        }

        .accommodation-unit.selected {
            border-color: #cc5500;
            background: #fff5f0;
        }

        .unit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .unit-checkbox {
            transform: scale(1.5);
            accent-color: #cc5500;
        }

        .unit-compliance-status {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 12px;
        }

        .unit-compliance-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            margin: 2px;
            font-size: 11px;
            font-weight: bold;
        }

        .badge-complete {
            background: #d4edda;
            color: #155724;
        }

        .badge-partial {
            background: #fff3cd;
            color: #856404;
        }

        .badge-incomplete {
            background: #f8d7da;
            color: #721c24;
        }

        .select-all-container {
            background: #ffede0;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #cc5500;
            margin-bottom: 20px;
            text-align: center;
        }

        .select-all-checkbox {
            transform: scale(1.8);
            accent-color: #cc5500;
            margin-right: 15px;
        }

        .file-upload-area {
            border: 3px dashed #cc5500;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #fff5f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            background: #ffede0;
            border-color: #aa4400;
        }

        .uploaded-files {
            margin-top: 15px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 4px;
            margin: 5px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .file-item .remove-file {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }

        .checker-section {
            background: linear-gradient(135deg, #e8f5e8, #d4f4d4);
            padding: 30px;
            border-radius: 12px;
            border: 3px solid #008800;
            margin-top: 30px;
            text-align: center;
        }

        .checker-section.disabled {
            background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
            border-color: #ccc;
        }

        .checker-section.disabled .btn-checker {
            background: linear-gradient(145deg, #999, #666);
            cursor: not-allowed;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
        }

        .close:hover {
            color: #cc5500;
        }

        .best-practices-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .practice-link {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #0066cc;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .practice-link:hover {
            background: #e6f3ff;
            transform: translateX(5px);
        }

        .units-list {
            margin-top: 20px;
        }

        .unit-card {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #cc5500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .unit-info h4 {
            color: #cc5500;
            margin-bottom: 5px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
            display: none;
        }

        .warning-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ffecc5;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }

        .action-buttons {
            text-align: center;
            margin: 30px 0;
        }

        .compliance-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .compliance-indicator.in-date {
            background: #d4edda;
            color: #155724;
        }

        .compliance-indicator.due-soon {
            background: #fff3cd;
            color: #856404;
        }

        .compliance-indicator.overdue {
            background: #f8d7da;
            color: #721c24;
        }

        .units-compliance-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .unit-status-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #cc5500;
        }

        .compliance-progress-bar {
            background: #e9ecef;
            border-radius: 4px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .compliance-progress {
            height: 100%;
            background: linear-gradient(145deg, #28a745, #218838);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .photo-upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .photo-preview {
            position: relative;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-preview img {
            max-width: 100%;
            max-height: 130px;
            border-radius: 4px;
        }

        .photo-preview .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }

        .maintenance-item {
            background: #fff5f0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #cc5500;
        }

        .maintenance-priority {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .priority-high {
            background: #dc3545;
            color: white;
        }

        .priority-medium {
            background: #ffc107;
            color: #333;
        }

        .priority-low {
            background: #28a745;
            color: white;
        }

        .completion-status {
            background: #e8f5e8;
            border: 2px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .incomplete-status {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .footer-branding {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 2px solid #cc5500;
            color: #666;
            font-size: 14px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .maintenance-form-actions {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #cc5500;
        }

        @media (max-width: 768px) {
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .safe-procedures-btn {
                position: static;
                margin-top: 15px;
            }

            .service-type-grid {
                grid-template-columns: 1fr;
            }

            .best-practices-links {
                grid-template-columns: 1fr;
            }

            .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CQR 365 Accommodation Services Module</h1>
        <button class="safe-procedures-btn" onclick="openSafeProcedures()">
            Safe Working Procedures
        </button>
    </div>

    <div class="navigation">
        <div class="nav-container">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showPage(&#39;main&#39;, this)">Main Form</button>
                <button class="nav-btn" onclick="showPage(&#39;unit-management&#39;, this)">Unit Management</button>
                <button class="nav-btn" onclick="showPage(&#39;maintenance&#39;, this)">Maintenance Requirements</button>
                <button class="nav-btn" onclick="showPage(&#39;best-practices&#39;, this)">Best Practices</button>
                <button class="nav-btn" onclick="showPage(&#39;compliance&#39;, this)">Compliance Tracking</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Main Form Page -->
        <div id="main" class="page active">
            <!-- Form Completion Status -->
            <div id="formStatus" class="completion-status incomplete-status"><h3>Form Status: Incomplete</h3><p>This form requires checker verification before completion</p></div>

            <!-- Property Information Section with Accommodation Units -->
            <div class="form-section">
                <h2 class="section-title">Property Information &amp; Accommodation Units</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="parkName">Holiday Park Name:</label>
                        <input type="text" id="parkName" name="parkName" required="" onchange="saveFormData()">
                    </div>
                    <div class="form-group">
                        <label for="parkLocation">Park Location:</label>
                        <input type="text" id="parkLocation" name="parkLocation" required="" onchange="saveFormData()">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label for="inspectionDate">Inspection Date:</label>
                        <input type="date" id="inspectionDate" name="inspectionDate" required="" onchange="saveFormData()">
                    </div>
                    <div class="form-group">
                        <label for="teamInitials">Team Initials:</label>
                        <input type="text" id="teamInitials" name="teamInitials" required="" placeholder="e.g., AB, CD, EF" onchange="saveFormData()">
                    </div>
                    <div class="form-group">
                        <label for="season">Season:</label>
                        <select id="season" name="season" onchange="updateSeasonalChecklists()">
                            <option value="">Select Season</option>
                            <option value="spring">Spring</option>
                            <option value="summer">Summer</option>
                            <option value="autumn">Autumn</option>
                            <option value="winter">Winter</option>
                        </select>
                    </div>
                </div>

                <!-- Accommodation Units Selection -->
                <h3 style="color: #cc5500; margin: 20px 0 15px 0;">Accommodation Units Selection</h3>
                <div class="select-all-container">
                    <label>
                        <input type="checkbox" class="select-all-checkbox" id="selectAllUnits" onchange="selectAllUnits()">
                        <strong>Select All Units - Auto-populate all checklists</strong>
                    </label>
                </div>
                <div class="accommodation-grid" id="accommodationGrid"><div style="text-align: center; padding: 40px; color: #666;"><p>No accommodation units added yet. Go to Unit Management to add units.</p></div></div>
            </div>

            <!-- Service Type Selection -->
            <div class="service-type-section">
                <h2 class="section-title">Service Type &amp; Compliance</h2>
                
                <!-- Units Compliance Summary -->
                <div class="units-compliance-summary" id="unitsComplianceSummary" style="display: none;">
                    <h3>Selected Units Compliance Status</h3>
                    <div id="unitsStatusList"></div>
                </div>
                
                <!-- Compliance Status Indicators -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4>Overall Compliance Status</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                        <div>
                            <label>
                                <input type="checkbox" id="monthlyInDate" disabled="">
                                Monthly Check
                                <span id="monthlyStatus" class="compliance-indicator overdue">Not Set</span>
                            </label>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Last completed: <span id="monthlyLastDate">Not Set</span>
                            </div>
                        </div>
                        <div>
                            <label>
                                <input type="checkbox" id="sixMonthlyInDate" disabled="">
                                6 Monthly Check
                                <span id="sixMonthlyStatus" class="compliance-indicator overdue">Not Set</span>
                            </label>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Last completed: <span id="sixMonthlyLastDate">Not Set</span>
                            </div>
                        </div>
                        <div>
                            <label>
                                <input type="checkbox" id="annualInDate" disabled="">
                                Annual Check
                                <span id="annualStatus" class="compliance-indicator overdue">Not Set</span>
                            </label>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Last completed: <span id="annualLastDate">Not Set</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="service-type-grid">
                    <div class="service-type-option selected" onclick="selectServiceType(&#39;turnover&#39;, this)">
                        <h3>Turnover</h3>
                        <p>Between guest changeovers</p>
                    </div>
                    <div class="service-type-option" onclick="selectServiceType(&#39;maintenance&#39;, this)">
                        <h3>Maintenance Inspection</h3>
                        <p>General maintenance check</p>
                    </div>
                    <div class="service-type-option" onclick="selectServiceType(&#39;monthly&#39;, this)">
                        <h3>Monthly</h3>
                        <p>Monthly safety inspection</p>
                    </div>
                    <div class="service-type-option" onclick="selectServiceType(&#39;6monthly&#39;, this)">
                        <h3>6 Monthly</h3>
                        <p>Comprehensive 6-month check</p>
                    </div>
                    <div class="service-type-option" onclick="selectServiceType(&#39;annually&#39;, this)">
                        <h3>Annual</h3>
                        <p>Full annual inspection</p>
                    </div>
                </div>

                <!-- Service Requirements Sections -->
                <div id="turnover-requirements" class="service-requirements active">
                    <div class="requirements-header">
                        <h3>Turnover Requirements</h3>
                        <button class="select-all-service" onclick="selectAllServiceTasks(&#39;turnover&#39;)">Select All</button>
                    </div>
                    <div id="turnover-checklist"><div class="checklist-item">
                    <input type="checkbox" id="turnover-0" checked="" onchange="toggleServiceTask(&#39;turnover-0&#39;)">
                    <label for="turnover-0">Clean and sanitize all surfaces </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-1" checked="" onchange="toggleServiceTask(&#39;turnover-1&#39;)">
                    <label for="turnover-1">Check bed linens and towels </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-2" checked="" onchange="toggleServiceTask(&#39;turnover-2&#39;)">
                    <label for="turnover-2">Inspect bathroom facilities </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-3" checked="" onchange="toggleServiceTask(&#39;turnover-3&#39;)">
                    <label for="turnover-3">Test all electrical appliances </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-4" checked="" onchange="toggleServiceTask(&#39;turnover-4&#39;)">
                    <label for="turnover-4">Check heating/cooling systems </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-5" checked="" onchange="toggleServiceTask(&#39;turnover-5&#39;)">
                    <label for="turnover-5">Inspect doors and windows </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-6" checked="" onchange="toggleServiceTask(&#39;turnover-6&#39;)">
                    <label for="turnover-6">Check inventory and supplies </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-7" checked="" onchange="toggleServiceTask(&#39;turnover-7&#39;)">
                    <label for="turnover-7">Test smoke detectors </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-8" checked="" onchange="toggleServiceTask(&#39;turnover-8&#39;)">
                    <label for="turnover-8">Inspect fire extinguisher </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-9" checked="" onchange="toggleServiceTask(&#39;turnover-9&#39;)">
                    <label for="turnover-9">Check gas connections (if applicable) </label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-10" onchange="toggleServiceTask(&#39;turnover-10&#39;)">
                    <label for="turnover-10">Prepare heating systems <span style="color: #cc5500; font-size: 12px;">(Seasonal)</span></label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-11" onchange="toggleServiceTask(&#39;turnover-11&#39;)">
                    <label for="turnover-11">Check weatherproofing <span style="color: #cc5500; font-size: 12px;">(Seasonal)</span></label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-12" onchange="toggleServiceTask(&#39;turnover-12&#39;)">
                    <label for="turnover-12">Clear leaves from drainage <span style="color: #cc5500; font-size: 12px;">(Seasonal)</span></label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-13" onchange="toggleServiceTask(&#39;turnover-13&#39;)">
                    <label for="turnover-13">Test emergency heating <span style="color: #cc5500; font-size: 12px;">(Seasonal)</span></label>
                </div><div class="checklist-item">
                    <input type="checkbox" id="turnover-14" onchange="toggleServiceTask(&#39;turnover-14&#39;)">
                    <label for="turnover-14">Inspect roof condition <span style="color: #cc5500; font-size: 12px;">(Seasonal)</span></label>
                </div></div>
                </div>

                <div id="maintenance-requirements" class="service-requirements">
                    <div class="requirements-header">
                        <h3>Maintenance Inspection Requirements</h3>
                        <button class="select-all-service" onclick="selectAllServiceTasks(&#39;maintenance&#39;)">Select All</button>
                    </div>
                    <div id="maintenance-checklist"></div>
                </div>

                <div id="monthly-requirements" class="service-requirements">
                    <div class="requirements-header">
                        <h3>Monthly Requirements</h3>
                        <button class="select-all-service" onclick="selectAllServiceTasks(&#39;monthly&#39;)">Select All</button>
                    </div>
                    <div id="monthly-checklist"></div>
                </div>

                <div id="6monthly-requirements" class="service-requirements">
                    <div class="requirements-header">
                        <h3>6 Monthly Requirements</h3>
                        <button class="select-all-service" onclick="selectAllServiceTasks(&#39;6monthly&#39;)">Select All</button>
                    </div>
                    <div id="6monthly-checklist"></div>
                </div>

                <div id="annually-requirements" class="service-requirements">
                    <div class="requirements-header">
                        <h3>Annual Requirements</h3>
                        <button class="select-all-service" onclick="selectAllServiceTasks(&#39;annually&#39;)">Select All</button>
                    </div>
                    <div id="annually-checklist"></div>
                </div>
            </div>

            <!-- Checker Verification Section -->
            <div class="checker-section disabled" id="checkerSection">
                <h2 style="color: #006600; margin-bottom: 20px;">Checker Verification (Required)</h2>
                <div class="form-group">
                    <label for="checkerName">Checker Name:</label>
                    <input type="text" id="checkerName" name="checkerName" style="max-width: 400px; margin: 0 auto;" onchange="saveFormData()">
                </div>
                <div class="form-group">
                    <label for="checkerDate">Verification Date:</label>
                    <input type="date" id="checkerDate" name="checkerDate" style="max-width: 400px; margin: 0 auto;" onchange="saveFormData()">
                </div>
                <div class="form-group" style="margin: 20px 0;">
                    <label>
                        <input type="checkbox" id="checkerConfirmation" style="transform: scale(1.5); margin-right: 10px;" onchange="updateFormStatus()">
                        <strong>I confirm that all accommodation units have been inspected and are serviceable and ready for hire</strong>
                    </label>
                </div>
                <button class="btn-3d btn-checker" id="checkerButton" onclick="submitCheckerVerification()" disabled="">
                    Checker Verification Complete
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-3d" onclick="saveForm()">Save Form</button>
                <button class="btn-3d btn-black" onclick="generateReport()">Generate Report</button>
                <button class="btn-3d btn-success" onclick="completeForm()">Complete &amp; Submit Form</button>
                <button class="btn-3d" onclick="resetForm()">Reset Form</button>
            </div>

            <div id="successMessage" class="success-message"></div>

            <!-- Footer Branding -->
            <div class="footer-branding">
                <p><strong>Owned by Omnibosh CQR 365</strong></p>
                <p>Quality management and compliance solutions</p>
            </div>
        </div>

        <!-- Unit Management Page -->
        <div id="unit-management" class="page">
            <div class="form-section">
                <h2 class="section-title">Unit Management</h2>
                
                <!-- Add New Unit -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="newUnitName">New Unit Name/Number:</label>
                        <input type="text" id="newUnitName" name="newUnitName" placeholder="e.g., Lodge A1, Cabin 12">
                    </div>
                    <div class="form-group">
                        <label for="unitType">Unit Type:</label>
                        <select id="unitType" name="unitType">
                            <option value="">Select Type</option>
                            <option value="lodge">Lodge</option>
                            <option value="cabin">Cabin</option>
                            <option value="static-caravan">Static Caravan</option>
                            <option value="glamping">Glamping Unit</option>
                            <option value="apartment">Apartment</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn-3d" onclick="addUnit()">Add Unit</button>
                <button class="btn-3d btn-danger" onclick="deleteAllUnits()">Delete All Units</button>

                <!-- Current Units List -->
                <div class="units-list">
                    <h3>Current Units (<span id="unitCount">0</span>)</h3>
                    <div id="unitsList"><div style="text-align: center; padding: 20px; color: #666;"><p>No units added yet. Use the form above to add your first unit.</p></div></div>
                </div>

                <!-- Footer Branding -->
                <div class="footer-branding">
                    <p><strong>Owned by Omnibosh CQR 365</strong></p>
                    <p>Quality management and compliance solutions</p>
                </div>
            </div>
        </div>

        <!-- Maintenance Requirements Page -->
        <div id="maintenance" class="page">
            <div class="form-section">
                <h2 class="section-title">Maintenance Requirements</h2>
                
                <!-- Add Maintenance Item -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="maintenanceDescription">Maintenance Description:</label>
                        <textarea id="maintenanceDescription" rows="3" placeholder="Describe the maintenance requirement..."></textarea>
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label for="maintenanceUnit">Unit:</label>
                        <select id="maintenanceUnit"><option value="">Select Unit</option></select>
                    </div>
                    <div class="form-group">
                        <label for="maintenancePriority">Priority:</label>
                        <select id="maintenancePriority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceDueDate">Due Date:</label>
                        <input type="date" id="maintenanceDueDate">
                    </div>
                </div>
                
                <!-- Photo Upload for Maintenance -->
                <div style="margin: 20px 0;">
                    <h4>Add Photos</h4>
                    <div class="file-upload-area" style="padding: 20px;" onclick="document.getElementById(&#39;maintenancePhotoInput&#39;).click()">
                        <input type="file" id="maintenancePhotoInput" multiple="" accept="image/*" style="display: none;" onchange="handleMaintenancePhotos(this.files)">
                        <p>Click to add photos of maintenance requirements</p>
                    </div>
                    <div class="photo-upload-grid" id="maintenancePhotos"></div>
                </div>
                
                <!-- Maintenance Form Actions -->
                <div class="maintenance-form-actions">
                    <button class="btn-3d" onclick="addMaintenanceItem()">Add Maintenance Item</button>
                    <button class="btn-3d btn-success" onclick="submitMaintenanceItems()">Submit Maintenance Items</button>
                    <button class="btn-3d btn-black" onclick="addNewMaintenanceTask()">Add New Maintenance Task</button>
                </div>
                
                <!-- Maintenance Items List -->
                <div style="margin-top: 30px;">
                    <h3>Current Maintenance Requirements</h3>
                    <div id="maintenanceList"><p style="text-align: center; color: #666;">No maintenance items recorded.</p></div>
                </div>

                <!-- Footer Branding -->
                <div class="footer-branding">
                    <p><strong>Owned by Omnibosh CQR 365</strong></p>
                    <p>Quality management and compliance solutions</p>
                </div>
            </div>
        </div>

        <!-- Best Practices Page -->
        <div id="best-practices" class="page">
            <div class="form-section">
                <h2 class="section-title">Best Practices &amp; Live Links</h2>
                
                <div class="best-practices-links">
                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.hse.gov.uk/gas/domestic/holidayparks.htm&#39;)">
                        <h4>HSE Holiday Parks Gas Safety</h4>
                        <p>Official guidance on gas safety in holiday parks</p>
                    </div>
                    
                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.gov.uk/government/publications/park-homes-guide-for-residents&#39;)">
                        <h4>Government Park Homes Guide</h4>
                        <p>Official guidance for park home standards</p>
                    </div>
                    
                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.hse.gov.uk/electricity/index.htm&#39;)">
                        <h4>Electrical Safety Standards</h4>
                        <p>Current electrical safety regulations</p>
                    </div>
                    
                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.gov.uk/government/collections/fire-safety-guidance&#39;)">
                        <h4>Fire Safety Regulations</h4>
                        <p>Latest fire safety requirements and guidance</p>
                    </div>
                    
                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.bhhpa.org.uk/&#39;)">
                        <h4>BHHPA Guidelines</h4>
                        <p>British Holiday &amp; Home Parks Association best practices</p>
                    </div>
                    
                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.hse.gov.uk/work-at-height/the-law.htm&#39;)">
                        <h4>Work at Height Regulations</h4>
                        <p>HSE guidance on working at height safety</p>
                    </div>

                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.legislation.gov.uk/uksi/1998/2451/contents/made&#39;)">
                        <h4>Gas Safety Regulations</h4>
                        <p>Gas Safety (Installation and Use) Regulations 1998</p>
                    </div>

                    <div class="practice-link" onclick="openExternalLink(&#39;https://www.hse.gov.uk/pubns/books/l138.htm&#39;)">
                        <h4>ACOP L138 - Gas Safety</h4>
                        <p>Approved Code of Practice for gas safety</p>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h3>Local Regulations &amp; Documents</h3>
                    <p>Upload and manage your local authority requirements, internal procedures, and site-specific guidelines using the document upload feature on the main form.</p>
                    
                    <div style="margin-top: 20px;">
                        <h4>Quick Access Tools</h4>
                        <button class="btn-3d" onclick="downloadTemplate()">Download Inspection Template</button>
                        <button class="btn-3d btn-black" onclick="viewLegislationSummary()">View Legislation Summary</button>
                    </div>
                </div>

                <!-- Footer Branding -->
                <div class="footer-branding">
                    <p><strong>Owned by Omnibosh CQR 365</strong></p>
                    <p>Quality management and compliance solutions</p>
                </div>
            </div>
        </div>

        <!-- Compliance Tracking Page -->
        <div id="compliance" class="page">
            <div class="form-section">
                <h2 class="section-title">Compliance Tracking</h2>
                
                <!-- Set Last Completion Dates -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>Set Last Completion Dates</h3>
                    <div class="form-row-3">
                        <div class="form-group">
                            <label for="lastMonthlyDate">Last Monthly Check:</label>
                            <input type="date" id="lastMonthlyDate" onchange="updateComplianceStatus()">
                        </div>
                        <div class="form-group">
                            <label for="lastSixMonthlyDate">Last 6 Monthly Check:</label>
                            <input type="date" id="lastSixMonthlyDate" onchange="updateComplianceStatus()">
                        </div>
                        <div class="form-group">
                            <label for="lastAnnualDate">Last Annual Check:</label>
                            <input type="date" id="lastAnnualDate" onchange="updateComplianceStatus()">
                        </div>
                    </div>
                </div>
                
                <!-- Compliance Overview -->
                <div style="margin-top: 30px;">
                    <h3>Compliance Overview</h3>
                    <div id="complianceOverview"><p style="text-align: center; color: #666;">No compliance dates set. Please set last completion dates above.</p></div>
                </div>
                
                <!-- Upload Compliance Documents -->
                <div style="margin-top: 30px;">
                    <h3>Compliance Documents</h3>
                    <div class="file-upload-area" onclick="document.getElementById(&#39;complianceFileInput&#39;).click()">
                        <input type="file" id="complianceFileInput" multiple="" accept=".pdf,.doc,.docx,.txt,.jpg,.png" style="display: none;" onchange="handleComplianceFiles(this.files)">
                        <h4>Upload Compliance Documents</h4>
                        <p>Gas certificates, electrical certificates, insurance documents, etc.</p>
                    </div>
                    <div class="uploaded-files" id="complianceFiles"></div>
                </div>

                <!-- Footer Branding -->
                <div class="footer-branding">
                    <p><strong>Owned by Omnibosh CQR 365</strong></p>
                    <p>Quality management and compliance solutions</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Safe Working Procedures Modal -->
    <div id="safeProceduresModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSafeProcedures()">×</span>
            <h2 style="color: #cc5500; margin-bottom: 20px;">Safe Working Procedures &amp; Legislation</h2>
            
            <div style="margin-bottom: 30px;">
                <h3>Current Legislation &amp; Standards</h3>
                <ul style="line-height: 1.8;">
                    <li><strong>Health and Safety at Work etc. Act 1974</strong> - Primary health and safety legislation</li>
                    <li><strong>Management of Health and Safety at Work Regulations 1999</strong> - Risk assessment requirements</li>
                    <li><strong>Caravan Sites and Control of Development Act 1960</strong> - Site licensing requirements</li>
                    <li><strong>Mobile Homes Act 2013</strong> - Standards for mobile home sites</li>
                    <li><strong>Gas Safety (Installation and Use) Regulations 1998</strong> - Gas safety requirements</li>
                    <li><strong>Electrical Equipment (Safety) Regulations 2016</strong> - Electrical safety standards</li>
                    <li><strong>Regulatory Reform (Fire Safety) Order 2005</strong> - Fire safety requirements</li>
                </ul>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3>Key Safety Procedures</h3>
                <ul style="line-height: 1.8;">
                    <li><strong>Gas Safety:</strong> Annual gas safety checks by Gas Safe registered engineers</li>
                    <li><strong>Electrical Safety:</strong> Regular PAT testing and electrical installation certificates</li>
                    <li><strong>Fire Safety:</strong> Regular fire risk assessments and equipment checks</li>
                    <li><strong>Water Safety:</strong> Legionella risk assessments and water quality monitoring</li>
                    <li><strong>Structural Safety:</strong> Regular structural inspections and maintenance</li>
                </ul>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3>Documentation Requirements</h3>
                <ul style="line-height: 1.8;">
                    <li>Site license documentation</li>
                    <li>Gas safety certificates</li>
                    <li>Electrical installation certificates</li>
                    <li>Fire risk assessments</li>
                    <li>Insurance certificates</li>
                    <li>Staff training records</li>
                    <li>Maintenance logs</li>
                    <li>Emergency procedures</li>
                </ul>
            </div>
            
            <!-- Document Upload Section -->
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h3>Upload Safety Documents</h3>
                <div class="file-upload-area" style="margin-top: 15px;" onclick="document.getElementById(&#39;safetyFileInput&#39;).click()">
                    <input type="file" id="safetyFileInput" multiple="" accept=".pdf,.doc,.docx,.txt,.jpg,.png" style="display: none;" onchange="handleSafetyFiles(this.files)">
                    <p>Click to upload safety procedures, certificates, and documentation</p>
                </div>
                <div class="uploaded-files" id="safetyFiles"></div>
            </div>

            <!-- Footer Branding in Modal -->
            <div class="footer-branding">
                <p><strong>Owned by Omnibosh CQR 365</strong></p>
                <p>Quality management and compliance solutions</p>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReportModal()">×</span>
            <h2 style="color: #cc5500; margin-bottom: 20px;">Inspection Report</h2>
            <div id="reportContent" style="white-space: pre-wrap; font-family: monospace; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; max-height: 400px; overflow-y: auto;"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-3d" onclick="printReport()">Print Report</button>
                <button class="btn-3d btn-black" onclick="downloadReport()">Download Report</button>
            </div>

            <!-- Footer Branding in Report Modal -->
            <div class="footer-branding">
                <p><strong>Owned by Omnibosh CQR 365</strong></p>
                <p>Quality management and compliance solutions</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let formData = {};
        let units = [];
        let selectedUnits = [];
        let uploadedFiles = [];
        let safetyDocuments = [];
        let complianceDocuments = [];
        let serviceTasks = {};
        let currentServiceType = '';
        let maintenanceItems = [];
        let maintenancePhotos = [];
        let complianceDates = {};
        let seasonalChecklists = {};
        let maintenanceSubmitted = false;
        let unitComplianceData = {};

        // Season-specific checklist items
        const seasonalItems = {
            spring: [
                'Check for winter damage',
                'Test outdoor water systems',
                'Clean gutters and drainage',
                'Service air conditioning units',
                'Check outdoor furniture condition'
            ],
            summer: [
                'Ensure adequate ventilation',
                'Check cooling systems',
                'Inspect outdoor areas for safety',
                'Test BBQ gas connections',
                'Verify pool/hot tub safety'
            ],
            autumn: [
                'Prepare heating systems',
                'Check weatherproofing',
                'Clear leaves from drainage',
                'Test emergency heating',
                'Inspect roof condition'
            ],
            winter: [
                'Test heating systems thoroughly',
                'Check pipe insulation',
                'Verify antifreeze levels',
                'Test carbon monoxide detectors',
                'Check for drafts and seal gaps'
            ]
        };

        // Service requirements data
        const serviceRequirements = {
            turnover: [
                'Clean and sanitize all surfaces',
                'Check bed linens and towels',
                'Inspect bathroom facilities',
                'Test all electrical appliances',
                'Check heating/cooling systems',
                'Inspect doors and windows',
                'Check inventory and supplies',
                'Test smoke detectors',
                'Inspect fire extinguisher',
                'Check gas connections (if applicable)'
            ],
            maintenance: [
                'Inspect structural integrity',
                'Check plumbing systems',
                'Test electrical systems',
                'Inspect HVAC systems',
                'Check exterior condition',
                'Inspect safety equipment',
                'Test emergency lighting',
                'Check fire safety systems',
                'Inspect accessibility features',
                'Review maintenance logs'
            ],
            monthly: [
                'Gas safety inspection',
                'Electrical safety check',
                'Fire safety equipment test',
                'Emergency exits inspection',
                'Water system check',
                'Heating system inspection',
                'Ventilation system check',
                'Safety signage review',
                'First aid kit inspection',
                'Emergency procedures review'
            ],
            '6monthly': [
                'Comprehensive gas safety check',
                'Electrical installation test',
                'Fire risk assessment review',
                'Water quality testing',
                'Structural safety inspection',
                'Emergency evacuation procedures',
                'Safety equipment servicing',
                'Staff training verification',
                'Insurance compliance check',
                'Regulatory compliance audit'
            ],
            annually: [
                'Full gas safety certificate renewal',
                'Electrical installation certificate',
                'Fire risk assessment update',
                'PAT testing completion',
                'Legionella risk assessment',
                'Asbestos management review',
                'Site license compliance',
                'Insurance policy review',
                'Emergency plan update',
                'Staff competency assessment'
            ]
        };

        // Check internet connectivity
        function checkConnectivity() {
            return navigator.onLine;
        }

        // Open external link with connectivity check
        function openExternalLink(url) {
            if (checkConnectivity()) {
                window.open(url, '_blank');
            } else {
                alert('No internet connection detected. Please check your WiFi or network connection and try again.');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inspectionDate').value = today;
            
            const month = new Date().getMonth();
            let season = '';
            if (month >= 2 && month <= 4) season = 'spring';
            else if (month >= 5 && month <= 7) season = 'summer';
            else if (month >= 8 && month <= 10) season = 'autumn';
            else season = 'winter';
            document.getElementById('season').value = season;
            
            loadSavedData();
            updateUnitDisplay();
            updateUnitsList();
            updateMaintenanceUnitOptions();
            updateComplianceStatus();
            updateSeasonalChecklists();
            updateCheckerSection();
        });

        // Page navigation
        function showPage(pageId, button) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        }

        // Update seasonal checklists
        function updateSeasonalChecklists() {
            const season = document.getElementById('season').value;
            saveFormData();
            
            if (!season) return;
            
            Object.keys(serviceRequirements).forEach(serviceType => {
                const checklistContainer = document.getElementById(serviceType + '-checklist');
                if (checklistContainer && currentServiceType === serviceType) {
                    populateServiceChecklist(serviceType);
                }
            });
        }

        // Update checker section availability
        function updateCheckerSection() {
            const checkerSection = document.getElementById('checkerSection');
            const checkerButton = document.getElementById('checkerButton');
            
            const hasUnits = selectedUnits.length > 0;
            const hasServiceType = currentServiceType !== '';
            const hasBasicInfo = formData.parkName && formData.parkLocation && formData.teamInitials;
            
            if (hasUnits && hasServiceType && hasBasicInfo) {
                checkerSection.classList.remove('disabled');
                checkerButton.disabled = false;
            } else {
                checkerSection.classList.add('disabled');
                checkerButton.disabled = true;
            }
        }

        // Save form data to localStorage
        function saveFormData() {
            formData = {
                parkName: document.getElementById('parkName').value,
                parkLocation: document.getElementById('parkLocation').value,
                inspectionDate: document.getElementById('inspectionDate').value,
                teamInitials: document.getElementById('teamInitials').value,
                season: document.getElementById('season').value,
                checkerName: document.getElementById('checkerName').value,
                checkerDate: document.getElementById('checkerDate').value,
                checkerConfirmation: document.getElementById('checkerConfirmation').checked
            };
            
            const data = {
                formData: formData,
                units: units,
                selectedUnits: selectedUnits,
                uploadedFiles: uploadedFiles,
                safetyDocuments: safetyDocuments,
                complianceDocuments: complianceDocuments,
                serviceTasks: serviceTasks,
                currentServiceType: currentServiceType,
                maintenanceItems: maintenanceItems,
                maintenancePhotos: maintenancePhotos,
                complianceDates: complianceDates,
                seasonalChecklists: seasonalChecklists,
                maintenanceSubmitted: maintenanceSubmitted,
                unitComplianceData: unitComplianceData
            };
            
            localStorage.setItem('holidayParkData', JSON.stringify(data));
            updateCheckerSection();
        }

        // Load saved data from localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('holidayParkData');
            if (saved) {
                const data = JSON.parse(saved);
                formData = data.formData || {};
                units = data.units || [];
                selectedUnits = data.selectedUnits || [];
                uploadedFiles = data.uploadedFiles || [];
                safetyDocuments = data.safetyDocuments || [];
                complianceDocuments = data.complianceDocuments || [];
                serviceTasks = data.serviceTasks || {};
                currentServiceType = data.currentServiceType || '';
                maintenanceItems = data.maintenanceItems || [];
                maintenancePhotos = data.maintenancePhotos || [];
                complianceDates = data.complianceDates || {};
                seasonalChecklists = data.seasonalChecklists || {};
                maintenanceSubmitted = data.maintenanceSubmitted || false;
                unitComplianceData = data.unitComplianceData || {};
                
                if (formData.parkName) document.getElementById('parkName').value = formData.parkName;
                if (formData.parkLocation) document.getElementById('parkLocation').value = formData.parkLocation;
                if (formData.inspectionDate) document.getElementById('inspectionDate').value = formData.inspectionDate;
                if (formData.teamInitials) document.getElementById('teamInitials').value = formData.teamInitials;
                if (formData.season) document.getElementById('season').value = formData.season;
                if (formData.checkerName) document.getElementById('checkerName').value = formData.checkerName;
                if (formData.checkerDate) document.getElementById('checkerDate').value = formData.checkerDate;
                if (formData.checkerConfirmation) document.getElementById('checkerConfirmation').checked = formData.checkerConfirmation;
                
                if (complianceDates.monthly) document.getElementById('lastMonthlyDate').value = complianceDates.monthly;
                if (complianceDates.sixMonthly) document.getElementById('lastSixMonthlyDate').value = complianceDates.sixMonthly;
                if (complianceDates.annual) document.getElementById('lastAnnualDate').value = complianceDates.annual;
                
                if (currentServiceType) {
                    const serviceOptions = document.querySelectorAll('.service-type-option');
                    serviceOptions.forEach(option => {
                        if (option.textContent.toLowerCase().includes(currentServiceType.replace('6monthly', '6 monthly'))) {
                            option.classList.add('selected');
                        }
                    });
                    document.getElementById(currentServiceType + '-requirements').classList.add('active');
                    populateServiceChecklist(currentServiceType);
                }
                
                updateMaintenanceList();
                updateSafetyFiles();
                updateComplianceFiles();
                updateFormStatus();
                updateCheckerSection();
                updateUnitsComplianceSummary();
            }
        }

        // Update form completion status
        function updateFormStatus() {
            const statusDiv = document.getElementById('formStatus');
            const isVerified = document.getElementById('checkerConfirmation').checked &&
                             document.getElementById('checkerName').value &&
                             document.getElementById('checkerDate').value;
            
            if (isVerified) {
                statusDiv.className = 'completion-status';
                statusDiv.innerHTML = '<h3>Form Status: Complete ✔</h3><p>Form has been verified by checker and is ready for submission</p>';
            } else {
                statusDiv.className = 'completion-status incomplete-status';
                statusDiv.innerHTML = '<h3>Form Status: Incomplete</h3><p>This form requires checker verification before completion</p>';
            }
            
            saveFormData();
        }

        // Complete form function
        function completeForm() {
            const isVerified = document.getElementById('checkerConfirmation').checked &&
                             document.getElementById('checkerName').value &&
                             document.getElementById('checkerDate').value;
            
            if (!isVerified) {
                alert('Form cannot be completed without checker verification. Please ensure all checker fields are completed and the checker has confirmed the inspection.');
                return;
            }
            
            if (confirm('Are you sure you want to submit this form? This action will finalize the inspection.')) {
                const today = new Date().toISOString().split('T')[0];
                
                selectedUnits.forEach(unitId => {
                    if (!unitComplianceData[unitId]) {
                        unitComplianceData[unitId] = {};
                    }
                    
                    if (currentServiceType === 'monthly') {
                        unitComplianceData[unitId].monthlyDate = today;
                    } else if (currentServiceType === '6monthly') {
                        unitComplianceData[unitId].sixMonthlyDate = today;
                    } else if (currentServiceType === 'annually') {
                        unitComplianceData[unitId].annualDate = today;
                    }
                });
                
                if (currentServiceType === 'monthly') {
                    complianceDates.monthly = today;
                    document.getElementById('lastMonthlyDate').value = today;
                } else if (currentServiceType === '6monthly') {
                    complianceDates.sixMonthly = today;
                    document.getElementById('lastSixMonthlyDate').value = today;
                } else if (currentServiceType === 'annually') {
                    complianceDates.annual = today;
                    document.getElementById('lastAnnualDate').value = today;
                }
                
                generateReport();
                showSuccessMessage('Form completed and submitted successfully! The form has been reset for the next inspection.');
                
                setTimeout(() => {
                    fullFormReset();
                }, 2000);
            }
        }

        // Full form reset after submission
        function fullFormReset() {
            formData = {};
            selectedUnits = [];
            uploadedFiles = [];
            safetyDocuments = [];
            complianceDocuments = [];
            serviceTasks = {};
            currentServiceType = '';
            maintenanceItems = [];
            maintenancePhotos = [];
            seasonalChecklists = {};
            maintenanceSubmitted = false;
            
            document.getElementById('parkName').value = '';
            document.getElementById('parkLocation').value = '';
            document.getElementById('teamInitials').value = '';
            document.getElementById('checkerName').value = '';
            document.getElementById('checkerDate').value = '';
            document.getElementById('checkerConfirmation').checked = false;
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inspectionDate').value = today;
            
            const month = new Date().getMonth();
            let season = '';
            if (month >= 2 && month <= 4) season = 'spring';
            else if (month >= 5 && month <= 7) season = 'summer';
            else if (month >= 8 && month <= 10) season = 'autumn';
            else season = 'winter';
            document.getElementById('season').value = season;
            
            document.querySelectorAll('.service-type-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelectorAll('.service-requirements').forEach(req => {
                req.classList.remove('active');
            });
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (checkbox.id !== 'monthlyInDate' && 
                    checkbox.id !== 'sixMonthlyInDate' && 
                    checkbox.id !== 'annualInDate') {
                    checkbox.checked = false;
                }
            });
            
            updateUnitDisplay();
            updateUnitsList();
            updateMaintenanceList();
            updateSafetyFiles();
            updateComplianceFiles();
            updateComplianceStatus();
            updateFormStatus();
            updateCheckerSection();
            updateUnitsComplianceSummary();
            
            saveFormData();
        }

        // Update units compliance summary
        function updateUnitsComplianceSummary() {
            const summaryDiv = document.getElementById('unitsComplianceSummary');
            const statusList = document.getElementById('unitsStatusList');
            
            if (selectedUnits.length === 0) {
                summaryDiv.style.display = 'none';
                return;
            }
            
            summaryDiv.style.display = 'block';
            statusList.innerHTML = '';
            
            selectedUnits.forEach(unitId => {
                const unit = units.find(u => u.id === unitId);
                if (!unit) return;
                
                const unitData = unitComplianceData[unitId] || {};
                const today = new Date();
                
                let monthlyStatus = 'Not Set';
                let sixMonthlyStatus = 'Not Set';
                let annualStatus = 'Not Set';
                let overallCompletion = 0;
                let totalChecks = 0;
                
                if (unitData.monthlyDate) {
                    const lastMonthly = new Date(unitData.monthlyDate);
                    const daysDiff = Math.floor((today - lastMonthly) / (1000 * 60 * 60 * 24));
                    if (daysDiff <= 30) {
                        monthlyStatus = 'Complete';
                        overallCompletion++;
                    } else if (daysDiff <= 37) {
                        monthlyStatus = 'Due Soon';
                    } else {
                        monthlyStatus = 'Overdue';
                    }
                    totalChecks++;
                }
                
                if (unitData.sixMonthlyDate) {
                    const lastSixMonthly = new Date(unitData.sixMonthlyDate);
                    const daysDiff = Math.floor((today - lastSixMonthly) / (1000 * 60 * 60 * 24));
                    if (daysDiff <= 180) {
                        sixMonthlyStatus = 'Complete';
                        overallCompletion++;
                    } else if (daysDiff <= 187) {
                        sixMonthlyStatus = 'Due Soon';
                    } else {
                        sixMonthlyStatus = 'Overdue';
                    }
                    totalChecks++;
                }
                
                if (unitData.annualDate) {
                    const lastAnnual = new Date(unitData.annualDate);
                    const daysDiff = Math.floor((today - lastAnnual) / (1000 * 60 * 60 * 24));
                    if (daysDiff <= 365) {
                        annualStatus = 'Complete';
                        overallCompletion++;
                    } else if (daysDiff <= 372) {
                        annualStatus = 'Due Soon';
                    } else {
                        annualStatus = 'Overdue';
                    }
                    totalChecks++;
                }
                
                const completionPercentage = totalChecks > 0 ? Math.round((overallCompletion / 3) * 100) : 0;
                
                const unitStatusCard = document.createElement('div');
                unitStatusCard.className = 'unit-status-card';
                unitStatusCard.innerHTML = `
                    <h4>${unit.name} (${unit.type.replace('-', ' ')})</h4>
                    <div class="compliance-progress-bar">
                        <div class="compliance-progress" style="width: ${completionPercentage}%">
                            ${completionPercentage}% Complete
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <span class="unit-compliance-badge ${monthlyStatus === 'Complete' ? 'badge-complete' : monthlyStatus === 'Due Soon' ? 'badge-partial' : 'badge-incomplete'}">
                            Monthly: ${monthlyStatus}
                        </span>
                        <span class="unit-compliance-badge ${sixMonthlyStatus === 'Complete' ? 'badge-complete' : sixMonthlyStatus === 'Due Soon' ? 'badge-partial' : 'badge-incomplete'}">
                            6-Monthly: ${sixMonthlyStatus}
                        </span>
                        <span class="unit-compliance-badge ${annualStatus === 'Complete' ? 'badge-complete' : annualStatus === 'Due Soon' ? 'badge-partial' : 'badge-incomplete'}">
                            Annual: ${annualStatus}
                        </span>
                    </div>
                    ${unitData.monthlyDate ? `<p style="font-size: 11px; color: #666; margin-top: 5px;">Last Monthly: ${new Date(unitData.monthlyDate).toLocaleDateString()}</p>` : ''}
                    ${unitData.sixMonthlyDate ? `<p style="font-size: 11px; color: #666;">Last 6-Monthly: ${new Date(unitData.sixMonthlyDate).toLocaleDateString()}</p>` : ''}
                    ${unitData.annualDate ? `<p style="font-size: 11px; color: #666;">Last Annual: ${new Date(unitData.annualDate).toLocaleDateString()}</p>` : ''}
                `;
                
                statusList.appendChild(unitStatusCard);
            });
        }

        // Update compliance status
        function updateComplianceStatus() {
            const today = new Date();
            
            if (document.getElementById('lastMonthlyDate').value) {
                const lastMonthly = new Date(document.getElementById('lastMonthlyDate').value);
                const monthlyDiff = Math.floor((today - lastMonthly) / (1000 * 60 * 60 * 24));
                
                updateComplianceIndicator('monthly', monthlyDiff, 30);
                document.getElementById('monthlyLastDate').textContent = lastMonthly.toLocaleDateString();
            } else {
                document.getElementById('monthlyStatus').textContent = 'Not Set';
                document.getElementById('monthlyStatus').className = 'compliance-indicator overdue';
                document.getElementById('monthlyLastDate').textContent = 'Not Set';
            }
            
            if (document.getElementById('lastSixMonthlyDate').value) {
                const lastSixMonthly = new Date(document.getElementById('lastSixMonthlyDate').value);
                const sixMonthlyDiff = Math.floor((today - lastSixMonthly) / (1000 * 60 * 60 * 24));
                
                updateComplianceIndicator('sixMonthly', sixMonthlyDiff, 180);
                document.getElementById('sixMonthlyLastDate').textContent = lastSixMonthly.toLocaleDateString();
            } else {
                document.getElementById('sixMonthlyStatus').textContent = 'Not Set';
                document.getElementById('sixMonthlyStatus').className = 'compliance-indicator overdue';
                document.getElementById('sixMonthlyLastDate').textContent = 'Not Set';
            }
            
            if (document.getElementById('lastAnnualDate').value) {
                const lastAnnual = new Date(document.getElementById('lastAnnualDate').value);
                const annualDiff = Math.floor((today - lastAnnual) / (1000 * 60 * 60 * 24));
                
                updateComplianceIndicator('annual', annualDiff, 365);
                document.getElementById('annualLastDate').textContent = lastAnnual.toLocaleDateString();
            } else {
                document.getElementById('annualStatus').textContent = 'Not Set';
                document.getElementById('annualStatus').className = 'compliance-indicator overdue';
                document.getElementById('annualLastDate').textContent = 'Not Set';
            }
            
            complianceDates = {
                monthly: document.getElementById('lastMonthlyDate').value,
                sixMonthly: document.getElementById('lastSixMonthlyDate').value,
                annual: document.getElementById('lastAnnualDate').value
            };
            
            saveFormData();
            updateComplianceOverview();
        }

        // Update individual compliance indicator
        function updateComplianceIndicator(type, daysDiff, maxDays) {
            const checkbox = document.getElementById(type + 'InDate');
            const status = document.getElementById(type + 'Status');
            
            if (daysDiff <= maxDays) {
                checkbox.checked = true;
                status.textContent = 'In Date';
                status.className = 'compliance-indicator in-date';
            } else if (daysDiff <= maxDays + 7) {
                checkbox.checked = false;
                status.textContent = 'Due Soon';
                status.className = 'compliance-indicator due-soon';
            } else {
                checkbox.checked = false;
                status.textContent = 'Overdue';
                status.className = 'compliance-indicator overdue';
            }
        }

        // Update compliance overview
        function updateComplianceOverview() {
            const overview = document.getElementById('complianceOverview');
            if (!overview) return;
            
            const today = new Date();
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">';
            
            if (complianceDates.monthly) {
                const lastDate = new Date(complianceDates.monthly);
                const nextDue = new Date(lastDate);
                nextDue.setDate(nextDue.getDate() + 30);
                const daysUntilDue = Math.floor((nextDue - today) / (1000 * 60 * 60 * 24));
                
                html += `<div class="maintenance-item">
                    <h4>Monthly Check</h4>
                    <p>Last: ${lastDate.toLocaleDateString()}</p>
                    <p>Next Due: ${nextDue.toLocaleDateString()}</p>
                    <p>Days Until Due: ${daysUntilDue}</p>
                    <span class="maintenance-priority ${daysUntilDue < 0 ? 'priority-high' : daysUntilDue < 7 ? 'priority-medium' : 'priority-low'}">
                        ${daysUntilDue < 0 ? 'Overdue' : daysUntilDue < 7 ? 'Due Soon' : 'On Track'}
                    </span>
                </div>`;
            }
            
            if (complianceDates.sixMonthly) {
                const lastDate = new Date(complianceDates.sixMonthly);
                const nextDue = new Date(lastDate);
                nextDue.setDate(nextDue.getDate() + 180);
                const daysUntilDue = Math.floor((nextDue - today) / (1000 * 60 * 60 * 24));
                
                html += `<div class="maintenance-item">
                    <h4>6 Monthly Check</h4>
                    <p>Last: ${lastDate.toLocaleDateString()}</p>
                    <p>Next Due: ${nextDue.toLocaleDateString()}</p>
                    <p>Days Until Due: ${daysUntilDue}</p>
                    <span class="maintenance-priority ${daysUntilDue < 0 ? 'priority-high' : daysUntilDue < 14 ? 'priority-medium' : 'priority-low'}">
                        ${daysUntilDue < 0 ? 'Overdue' : daysUntilDue < 14 ? 'Due Soon' : 'On Track'}
                    </span>
                </div>`;
            }
            
            if (complianceDates.annual) {
                const lastDate = new Date(complianceDates.annual);
                const nextDue = new Date(lastDate);
                nextDue.setDate(nextDue.getDate() + 365);
                const daysUntilDue = Math.floor((nextDue - today) / (1000 * 60 * 60 * 24));
                
                html += `<div class="maintenance-item">
                    <h4>Annual Check</h4>
                    <p>Last: ${lastDate.toLocaleDateString()}</p>
                    <p>Next Due: ${nextDue.toLocaleDateString()}</p>
                    <p>Days Until Due: ${daysUntilDue}</p>
                    <span class="maintenance-priority ${daysUntilDue < 0 ? 'priority-high' : daysUntilDue < 30 ? 'priority-medium' : 'priority-low'}">
                        ${daysUntilDue < 0 ? 'Overdue' : daysUntilDue < 30 ? 'Due Soon' : 'On Track'}
                    </span>
                </div>`;
            }
            
            html += '</div>';
            
            if (!complianceDates.monthly && !complianceDates.sixMonthly && !complianceDates.annual) {
                html = '<p style="text-align: center; color: #666;">No compliance dates set. Please set last completion dates above.</p>';
            }
            
            overview.innerHTML = html;
        }

        // Service type selection
        function selectServiceType(type, element) {
            currentServiceType = type;
            
            document.querySelectorAll('.service-type-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            element.classList.add('selected');
            
            document.querySelectorAll('.service-requirements').forEach(req => {
                req.classList.remove('active');
            });
            
            const selectedReq = document.getElementById(type + '-requirements');
            if (selectedReq) {
                selectedReq.classList.add('active');
                populateServiceChecklist(type);
            }
            
            saveFormData();
            updateCheckerSection();
        }

        // Populate service checklist
        function populateServiceChecklist(serviceType) {
            const checklistContainer = document.getElementById(serviceType + '-checklist');
            if (!checklistContainer) return;
            
            checklistContainer.innerHTML = '';
            
            let requirements = [...serviceRequirements[serviceType]];
            
            const season = document.getElementById('season').value;
            if (season && seasonalItems[season]) {
                requirements = requirements.concat(seasonalItems[season]);
            }
            
            requirements.forEach((task, index) => {
                const taskId = `${serviceType}-${index}`;
                const isChecked = serviceTasks[taskId] || false;
                
                const taskElement = document.createElement('div');
                taskElement.className = 'checklist-item';
                
                const isSeasonalItem = seasonalItems[season] && seasonalItems[season].includes(task);
                
                taskElement.innerHTML = `
                    <input type="checkbox" id="${taskId}" ${isChecked ? 'checked' : ''} 
                           onchange="toggleServiceTask('${taskId}')">
                    <label for="${taskId}">${task} ${isSeasonalItem ? '<span style="color: #cc5500; font-size: 12px;">(Seasonal)</span>' : ''}</label>
                `;
                
                checklistContainer.appendChild(taskElement);
            });
        }

        // Toggle service task
        function toggleServiceTask(taskId) {
            serviceTasks[taskId] = document.getElementById(taskId).checked;
            saveFormData();
        }

        // Select all service tasks
        function selectAllServiceTasks(serviceType) {
            const checkboxes = document.querySelectorAll(`#${serviceType}-checklist input[type="checkbox"]`);
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = !allChecked;
                serviceTasks[checkbox.id] = !allChecked;
            });
            
            saveFormData();
        }

        // Unit management functions
        function addUnit() {
            const nameInput = document.getElementById('newUnitName');
            const typeSelect = document.getElementById('unitType');
            
            if (nameInput.value && typeSelect.value) {
                const unit = {
                    id: Date.now(),
                    name: nameInput.value,
                    type: typeSelect.value
                };
                
                units.push(unit);
                nameInput.value = '';
                typeSelect.value = '';
                
                updateUnitDisplay();
                updateUnitsList();
                updateMaintenanceUnitOptions();
                saveFormData();
                showSuccessMessage('Unit added successfully!');
            } else {
                alert('Please enter both unit name and type.');
            }
        }

        function deleteUnit(unitId) {
            if (confirm('Are you sure you want to delete this unit?')) {
                units = units.filter(unit => unit.id !== unitId);
                selectedUnits = selectedUnits.filter(id => id !== unitId);
                delete unitComplianceData[unitId];
                updateUnitDisplay();
                updateUnitsList();
                updateMaintenanceUnitOptions();
                updateUnitsComplianceSummary();
                saveFormData();
                showSuccessMessage('Unit deleted successfully!');
            }
        }

        function deleteAllUnits() {
            if (confirm('Are you sure you want to delete all units? This cannot be undone.')) {
                units = [];
                selectedUnits = [];
                unitComplianceData = {};
                updateUnitDisplay();
                updateUnitsList();
                updateMaintenanceUnitOptions();
                updateUnitsComplianceSummary();
                saveFormData();
                showSuccessMessage('All units deleted successfully!');
            }
        }

        function updateUnitDisplay() {
            const grid = document.getElementById('accommodationGrid');
            
            if (units.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><p>No accommodation units added yet. Go to Unit Management to add units.</p></div>';
                return;
            }
            
            grid.innerHTML = '';
            
            units.forEach(unit => {
                const isSelected = selectedUnits.includes(unit.id);
                const unitData = unitComplianceData[unit.id] || {};
                const today = new Date();
                
                let complianceColor = '#f8d7da';
                let complianceText = 'No Data';
                
                if (unitData.monthlyDate || unitData.sixMonthlyDate || unitData.annualDate) {
                    let hasOverdue = false;
                    let hasUpcoming = false;
                    
                    if (unitData.monthlyDate) {
                        const daysDiff = Math.floor((today - new Date(unitData.monthlyDate)) / (1000 * 60 * 60 * 24));
                        if (daysDiff > 30) hasOverdue = true;
                        else if (daysDiff > 23) hasUpcoming = true;
                    }
                    
                    if (unitData.sixMonthlyDate) {
                        const daysDiff = Math.floor((today - new Date(unitData.sixMonthlyDate)) / (1000 * 60 * 60 * 24));
                        if (daysDiff > 180) hasOverdue = true;
                        else if (daysDiff > 173) hasUpcoming = true;
                    }
                    
                    if (unitData.annualDate) {
                        const daysDiff = Math.floor((today - new Date(unitData.annualDate)) / (1000 * 60 * 60 * 24));
                        if (daysDiff > 365) hasOverdue = true;
                        else if (daysDiff > 358) hasUpcoming = true;
                    }
                    
                    if (hasOverdue) {
                        complianceColor = '#f8d7da';
                        complianceText = 'Overdue';
                    } else if (hasUpcoming) {
                        complianceColor = '#fff3cd';
                        complianceText = 'Due Soon';
                    } else {
                        complianceColor = '#d4edda';
                        complianceText = 'Complete';
                    }
                }
                
                const unitElement = document.createElement('div');
                unitElement.className = `accommodation-unit ${isSelected ? 'selected' : ''}`;
                unitElement.innerHTML = `
                    <div class="unit-header">
                        <h4>${unit.name}</h4>
                        <input type="checkbox" class="unit-checkbox" ${isSelected ? 'checked' : ''} 
                               onchange="toggleUnitSelection(${unit.id})">
                    </div>
                    <p style="text-transform: capitalize; color: #666;">${unit.type.replace('-', ' ')}</p>
                    <div class="unit-compliance-status" style="background: ${complianceColor};">
                        <strong>Compliance: ${complianceText}</strong>
                        ${unitData.monthlyDate ? `<br>Monthly: ${new Date(unitData.monthlyDate).toLocaleDateString()}` : ''}
                        ${unitData.sixMonthlyDate ? `<br>6-Monthly: ${new Date(unitData.sixMonthlyDate).toLocaleDateString()}` : ''}
                        ${unitData.annualDate ? `<br>Annual: ${new Date(unitData.annualDate).toLocaleDateString()}` : ''}
                    </div>
                `;
                
                grid.appendChild(unitElement);
            });
            
            const selectAllCheckbox = document.getElementById('selectAllUnits');
            selectAllCheckbox.checked = selectedUnits.length === units.length && units.length > 0;
        }

        function updateUnitsList() {
            const unitsList = document.getElementById('unitsList');
            const unitCount = document.getElementById('unitCount');
            
            unitCount.textContent = units.length;
            
            if (units.length === 0) {
                unitsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;"><p>No units added yet. Use the form above to add your first unit.</p></div>';
                return;
            }
            
            unitsList.innerHTML = '';
            
            units.forEach(unit => {
                const unitCard = document.createElement('div');
                unitCard.className = 'unit-card';
                unitCard.innerHTML = `
                    <div class="unit-info">
                        <h4>${unit.name}</h4>
                        <p style="text-transform: capitalize; color: #666;">${unit.type.replace('-', ' ')}</p>
                    </div>
                    <button class="btn-3d btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteUnit(${unit.id})">Delete</button>
                `;
                
                unitsList.appendChild(unitCard);
            });
        }

        function toggleUnitSelection(unitId) {
            if (selectedUnits.includes(unitId)) {
                selectedUnits = selectedUnits.filter(id => id !== unitId);
            } else {
                selectedUnits.push(unitId);
            }
            
            updateUnitDisplay();
            updateUnitsComplianceSummary();
            saveFormData();
            updateCheckerSection();
        }

        function selectAllUnits() {
            const selectAllCheckbox = document.getElementById('selectAllUnits');
            
            if (selectAllCheckbox.checked) {
                selectedUnits = units.map(unit => unit.id);
            } else {
                selectedUnits = [];
            }
            
            updateUnitDisplay();
            updateUnitsComplianceSummary();
            saveFormData();
            updateCheckerSection();
        }

        // Maintenance functions
        function updateMaintenanceUnitOptions() {
            const select = document.getElementById('maintenanceUnit');
            select.innerHTML = '<option value="">Select Unit</option>';
            
            units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.id;
                option.textContent = unit.name;
                select.appendChild(option);
            });
        }

        function addMaintenanceItem() {
            const description = document.getElementById('maintenanceDescription').value;
            const unitId = document.getElementById('maintenanceUnit').value;
            const priority = document.getElementById('maintenancePriority').value;
            const dueDate = document.getElementById('maintenanceDueDate').value;
            
            if (!description) {
                alert('Please enter a maintenance description.');
                return;
            }
            
            const unit = units.find(u => u.id === parseInt(unitId));
            const item = {
                id: Date.now(),
                description: description,
                unit: unit ? unit.name : 'General',
                priority: priority,
                dueDate: dueDate,
                photos: [...maintenancePhotos],
                created: new Date().toISOString()
            };
            
            maintenanceItems.push(item);
            
            document.getElementById('maintenanceDescription').value = '';
            document.getElementById('maintenanceUnit').value = '';
            document.getElementById('maintenancePriority').value = 'low';
            document.getElementById('maintenanceDueDate').value = '';
            maintenancePhotos = [];
            document.getElementById('maintenancePhotos').innerHTML = '';
            
            updateMaintenanceList();
            saveFormData();
            showSuccessMessage('Maintenance item added successfully!');
        }

        function submitMaintenanceItems() {
            if (maintenanceItems.length === 0) {
                alert('No maintenance items to submit. Please add at least one maintenance item.');
                return;
            }
            
            maintenanceSubmitted = true;
            saveFormData();
            showSuccessMessage('Maintenance items submitted successfully and will be included in the report!');
        }

        function addNewMaintenanceTask() {
            document.getElementById('maintenanceDescription').value = '';
            document.getElementById('maintenanceUnit').value = '';
            document.getElementById('maintenancePriority').value = 'low';
            document.getElementById('maintenanceDueDate').value = '';
            maintenancePhotos = [];
            document.getElementById('maintenancePhotos').innerHTML = '';
            
            document.getElementById('maintenanceDescription').focus();
            showSuccessMessage('Ready for new maintenance task entry!');
        }

        function updateMaintenanceList() {
            const list = document.getElementById('maintenanceList');
            
            if (maintenanceItems.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666;">No maintenance items recorded.</p>';
                return;
            }
            
            list.innerHTML = '';
            
            maintenanceItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'maintenance-item';
                itemDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h4>${item.unit}</h4>
                            <p>${item.description}</p>
                            ${item.dueDate ? `<p><strong>Due:</strong> ${new Date(item.dueDate).toLocaleDateString()}</p>` : ''}
                            ${item.photos.length > 0 ? `<p><strong>Photos:</strong> ${item.photos.length} attached</p>` : ''}
                            ${maintenanceSubmitted ? '<p style="color: #28a745; font-weight: bold;">✔ Submitted</p>' : '<p style="color: #ffc107; font-weight: bold;">⏳ Pending Submission</p>'}
                        </div>
                        <div>
                            <span class="maintenance-priority priority-${item.priority}">${item.priority}</span>
                            <button class="btn-3d btn-danger" style="padding: 5px 10px; font-size: 12px; margin-left: 10px;" onclick="deleteMaintenanceItem(${item.id})">Delete</button>
                        </div>
                    </div>
                `;
                list.appendChild(itemDiv);
            });
        }

        function deleteMaintenanceItem(itemId) {
            if (confirm('Are you sure you want to delete this maintenance item?')) {
                maintenanceItems = maintenanceItems.filter(item => item.id !== itemId);
                updateMaintenanceList();
                saveFormData();
                showSuccessMessage('Maintenance item deleted successfully!');
            }
        }

        function handleMaintenancePhotos(files) {
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoId = Date.now() + Math.random();
                    maintenancePhotos.push({
                        id: photoId,
                        data: e.target.result,
                        name: file.name
                    });
                    updateMaintenancePhotosDisplay();
                };
                reader.readAsDataURL(file);
            });
        }

        function updateMaintenancePhotosDisplay() {
            const container = document.getElementById('maintenancePhotos');
            container.innerHTML = '';
            
            maintenancePhotos.forEach(photo => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-preview';
                photoDiv.innerHTML = `
                    <img src="${photo.data}" alt="${photo.name}">
                    <button class="remove-photo" onclick="removeMaintenancePhoto('${photo.id}')">×</button>
                `;
                container.appendChild(photoDiv);
            });
        }

        function removeMaintenancePhoto(photoId) {
            maintenancePhotos = maintenancePhotos.filter(p => p.id != photoId);
            updateMaintenancePhotosDisplay();
        }

        // File upload functions
        function handleSafetyFiles(files) {
            Array.from(files).forEach(file => {
                const fileObj = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type
                };
                safetyDocuments.push(fileObj);
            });
            
            updateSafetyFiles();
            saveFormData();
        }

        function updateSafetyFiles() {
            const container = document.getElementById('safetyFiles');
            
            if (safetyDocuments.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '<h4 style="margin-bottom: 10px;">Uploaded Safety Documents:</h4>';
            
            safetyDocuments.forEach(file => {
                const fileElement = document.createElement('div');
                fileElement.className = 'file-item';
                fileElement.innerHTML = `
                    <span>${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button class="remove-file" onclick="removeSafetyFile('${file.id}')">Remove</button>
                `;
                
                container.appendChild(fileElement);
            });
        }

        function removeSafetyFile(fileId) {
            safetyDocuments = safetyDocuments.filter(file => file.id != fileId);
            updateSafetyFiles();
            saveFormData();
        }

        function handleComplianceFiles(files) {
            Array.from(files).forEach(file => {
                const fileObj = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type
                };
                complianceDocuments.push(fileObj);
            });
            
            updateComplianceFiles();
            saveFormData();
        }

        function updateComplianceFiles() {
            const container = document.getElementById('complianceFiles');
            
            if (complianceDocuments.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '<h4 style="margin-bottom: 10px;">Uploaded Compliance Documents:</h4>';
            
            complianceDocuments.forEach(file => {
                const fileElement = document.createElement('div');
                fileElement.className = 'file-item';
                fileElement.innerHTML = `
                    <span>${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button class="remove-file" onclick="removeComplianceFile('${file.id}')">Remove</button>
                `;
                
                container.appendChild(fileElement);
            });
        }

        function removeComplianceFile(fileId) {
            complianceDocuments = complianceDocuments.filter(file => file.id != fileId);
            updateComplianceFiles();
            saveFormData();
        }

        // Modal functions
        function openSafeProcedures() {
            document.getElementById('safeProceduresModal').style.display = 'block';
        }

        function closeSafeProcedures() {
            document.getElementById('safeProceduresModal').style.display = 'none';
        }

        function closeReportModal() {
            document.getElementById('reportModal').style.display = 'none';
        }

        // Form actions
        function saveForm() {
            saveFormData();
            showSuccessMessage('Form saved successfully!');
        }

        function resetForm() {
            if (confirm('Are you sure you want to reset the entire form? This will clear all data and cannot be undone.')) {
                fullFormReset();
                localStorage.removeItem('holidayParkData');
                showSuccessMessage('Form reset successfully!');
            }
        }

        function generateReport() {
            const selectedUnitNames = units
                .filter(unit => selectedUnits.includes(unit.id))
                .map(unit => `${unit.name} (${unit.type.replace('-', ' ')})`);

            const selectedTasks = Object.entries(serviceTasks)
                .filter(([key, value]) => value)
                .map(([key]) => {
                    const serviceType = key.split('-')[0];
                    const taskIndex = parseInt(key.split('-')[1]);
                    const requirements = [...serviceRequirements[serviceType]];
                    const season = formData.season;
                    if (season && seasonalItems[season]) {
                        requirements.push(...seasonalItems[season]);
                    }
                    return requirements[taskIndex] || key;
                });

            // Generate unit-specific compliance details
            let unitComplianceDetails = '';
            if (selectedUnits.length > 0) {
                unitComplianceDetails = '\n\nUnit-Specific Compliance Status:\n';
                selectedUnits.forEach(unitId => {
                    const unit = units.find(u => u.id === unitId);
                    const unitData = unitComplianceData[unitId] || {};
                    if (unit) {
                        unitComplianceDetails += `\n${unit.name} (${unit.type.replace('-', ' ')}):\n`;
                        unitComplianceDetails += `  - Monthly: ${unitData.monthlyDate ? unitData.monthlyDate : 'Not checked'}\n`;
                        unitComplianceDetails += `  - 6-Monthly: ${unitData.sixMonthlyDate ? unitData.sixMonthlyDate : 'Not checked'}\n`;
                        unitComplianceDetails += `  - Annual: ${unitData.annualDate ? unitData.annualDate : 'Not checked'}\n`;
                    }
                });
            }

            const report = `CQR 365 ACCOMMODATION SERVICES MODULE - INSPECTION REPORT
===========================================================

FORM STATUS: ${formData.checkerConfirmation ? 'COMPLETE ✔' : 'INCOMPLETE - REQUIRES CHECKER VERIFICATION'}

Property Information:
- Park Name: ${formData.parkName || 'Not specified'}
- Location: ${formData.parkLocation || 'Not specified'}
- Inspection Date: ${formData.inspectionDate || 'Not specified'}
- Team Initials: ${formData.teamInitials || 'Not specified'}
- Season: ${formData.season || 'Not specified'}
- Service Type: ${currentServiceType.replace('6monthly', '6 Monthly') || 'Not specified'}

Overall Compliance Status:
- Monthly Check: ${complianceDates.monthly ? `Last: ${complianceDates.monthly}` : 'Not set'}
- 6 Monthly Check: ${complianceDates.sixMonthly ? `Last: ${complianceDates.sixMonthly}` : 'Not set'}
- Annual Check: ${complianceDates.annual ? `Last: ${complianceDates.annual}` : 'Not set'}

Units Inspected (${selectedUnitNames.length}):
${selectedUnitNames.map(name => `- ${name}`).join('\n') || 'No units selected'}
${unitComplianceDetails}

Service Tasks Completed (${selectedTasks.length}):
${selectedTasks.map(task => `✔ ${task}`).join('\n') || 'No tasks selected'}

Maintenance Requirements (${maintenanceItems.length}):
${maintenanceItems.map(item => `- [${item.priority.toUpperCase()}] ${item.unit}: ${item.description}${item.dueDate ? ` (Due: ${item.dueDate})` : ''}`).join('\n') || 'No maintenance items recorded'}
${maintenanceSubmitted ? '\n✔ Maintenance items have been submitted' : '\n⚠ Maintenance items pending submission'}

Documents Uploaded:
- Safety Documents: ${safetyDocuments.length}
- Compliance Documents: ${complianceDocuments.length}

Checker Verification:
- Checker Name: ${formData.checkerName || 'Not specified'}
- Verification Date: ${formData.checkerDate || 'Not specified'}
- Confirmation: ${formData.checkerConfirmation ? 'YES - All units inspected and ready for hire' : 'NO - Verification pending'}

Report Generated: ${new Date().toLocaleString()}

---
Owned by Omnibosh CQR 365
Quality management and compliance solutions`;

            document.getElementById('reportContent').textContent = report;
            document.getElementById('reportModal').style.display = 'block';
        }

        function printReport() {
            const reportContent = document.getElementById('reportContent').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>CQR 365 Accommodation Services Report</title>
                        <style>
                            body { font-family: monospace; white-space: pre-wrap; margin: 20px; }
                        </style>
                    </head>
                    <body>${reportContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function downloadReport() {
            const reportContent = document.getElementById('reportContent').textContent;
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `CQR365_Accommodation_Report_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function submitCheckerVerification() {
            if (!formData.checkerName || !formData.checkerDate) {
                alert('Please complete checker name and verification date before submitting.');
                return;
            }
            
            if (!formData.checkerConfirmation) {
                alert('The checker must confirm that all accommodation units have been inspected and are serviceable and ready for hire.');
                return;
            }
            
            updateFormStatus();
            showSuccessMessage('Checker verification completed successfully! Form is now ready for final submission.');
        }

        function showSuccessMessage(message) {
            const messageDiv = document.getElementById('successMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // Best practices and external functions
        function downloadTemplate() {
            const template = `CQR 365 ACCOMMODATION SERVICES MODULE - INSPECTION TEMPLATE
============================================================

Property Information:
- Park Name: ___________________________
- Location: ____________________________
- Inspection Date: _____________________
- Team Initials: _______________________
- Season: ______________________________

Units to Inspect:
□ Unit 1: _____________________________
□ Unit 2: _____________________________
□ Unit 3: _____________________________
□ Unit 4: _____________________________
□ Unit 5: _____________________________

Service Type:
□ Turnover
□ Maintenance Inspection
□ Monthly
□ 6 Monthly
□ Annual

General Checklist:
□ All safety equipment checked
□ Documentation up to date
□ Maintenance items logged
□ Photos taken where needed
□ Compliance dates updated

Checker Verification:
- Checker Name: ________________________
- Date: ________________________________
- Signature: ___________________________

Notes:
_________________________________________
_________________________________________
_________________________________________

---
Owned by Omnibosh CQR 365`;

            const blob = new Blob([template], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'CQR365_Inspection_Template.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showSuccessMessage('Template downloaded successfully!');
        }

        function viewLegislationSummary() {
            const summaryContent = `
<h2>Legislation Summary</h2>
<div style="text-align: left;">
    <h3>Primary Legislation</h3>
    <p><strong>Health and Safety at Work etc. Act 1974</strong><br/>
    Sets out general duties of employers to employees and to the public.</p>
    
    <h3>Gas Safety</h3>
    <p><strong>Gas Safety (Installation and Use) Regulations 1998</strong><br/>
    Requires annual gas safety checks by Gas Safe registered engineers.</p>
    
    <h3>Electrical Safety</h3>
    <p><strong>Electrical Equipment (Safety) Regulations 2016</strong><br/>
    Sets standards for electrical equipment safety and testing.</p>
    
    <h3>Fire Safety</h3>
    <p><strong>Regulatory Reform (Fire Safety) Order 2005</strong><br/>
    Requires fire risk assessments and appropriate fire safety measures.</p>
    
    <h3>Site Licensing</h3>
    <p><strong>Caravan Sites and Control of Development Act 1960</strong><br/>
    Regulates the licensing and operation of caravan sites.</p>
    
    <h3>Mobile Homes</h3>
    <p><strong>Mobile Homes Act 2013</strong><br/>
    Sets standards for mobile home sites and resident protections.</p>
    
    <h3>Water Safety</h3>
    <p><strong>Control of Substances Hazardous to Health Regulations 2002</strong><br/>
    Includes requirements for Legionella risk assessments.</p>
</div>
            `;
            
            // Create temporary modal for legislation summary
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.closest('.modal').remove()">×</span>
                    ${summaryContent}
                    <div class="footer-branding">
                        <p><strong>Owned by Omnibosh CQR 365</strong></p>
                        <p>Quality management and compliance solutions</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>


</body></html>